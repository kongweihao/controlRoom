<style>
	/* element 展开行表格默认格式 */
	.tableData-expand {
		font-size: 0;
	}
	.tableData-expand label {
		width: auto;
		font-weight:normal;
		color: #99a9bf;
	}
	.tableData-expand .el-form-item {
		margin-right: 0;
		margin-bottom: 0;
		width: 50%;
	}
	.labelStyle {
		/* font-weight:normal; */
		padding: 2px !important;
		background: #eee
	}
</style>
<div class="layui-body">
	<div id="app0" style="margin-top:-50px">
		<el-tabs
		v-show="isShowThisPage"
		type="border-card" 
		value="packUpTab"
		v-loading="tabsLoading"
		:element-loading-text="tabsLoadingTxt"
		element-loading-spinner="el-icon-loading"
		element-loading-background="rgba(0, 0, 0, 0.8)"
		style="margin:0px auto 10px">
			<el-tab-pane label="收起" name="packUpTab">
			</el-tab-pane>
			<el-tab-pane label="组合搜索" name="searchTab">
				<div style="padding: 15px;border-radius: 5px;max-height: 500px;overflow:scroll;border: 1px solid #eee;">
					<el-card class="box-card">
						<el-divider content-position="left">tips~</el-divider>
						<div>- 若置空所有搜索条件，则默认加载待跟进数据</div>
					</el-card>
					<el-form ref="formJson[now_ctrr_rsrm_id_l2]" :model="formJson[now_ctrr_rsrm_id_l2]"  
					style="margin: 10px auto;
					padding: 10px auto;">
						<template>
							<div>
								<el-divider content-position="left">【搜索方式一：关键词组合】</el-divider>
								<el-card class="box-card">
									<el-form-item 
									:label="searchKeyWords.label"
									:key="searchKeyWords.key"
									size="mini"
									style="width: auto;display: inline-block;">
										<el-tooltip>
											<div slot="content">{{searchKeyWords.tips}}</div>
											<!-- 文本类型 -->
											<el-input 
											type="text"
											autosize 
											v-model="searchKeyWords.value"></el-input >
										</el-tooltip>
									</el-form-item>
								</el-card>
								<el-divider><span style="color: orangered;">两种搜索取并集</span></el-divider>
								<div style="text-align: center;">
									<el-button type="primary" size="mini"  @click="search">开始搜索</el-button>
									<el-button type="primary" size="mini"  @click="resetSearch(now_ctrr_rsrm_id_l2)">重置</el-button>
								</div>
								<el-divider content-position="left">【搜索方式二：其他搜索（检索速度较慢）】</el-divider>
								<el-card class="box-card">
									<el-form-item 
									v-for="item in formJson[now_ctrr_rsrm_id_l2]"
									:label="item.ctrr_rsrm_name"
									:key="item.ctrr_rsrm_id"
									size="mini"
									style="width: 50%;display: inline-block;">
										<el-tooltip :disabled="item.ctrr_rsrm_tips ?  false : true">
											<div slot="content">{{item.ctrr_rsrm_tips}}</div>
											<!-- 开关类型依然使用下拉框类型，因为还需要考虑空值的状态 -->
											<el-input v-if="item.ctrr_rsrm_type == 1" 
											v-model="item.value"
											type="textarea"
											placeholder="请选择"></el-input >
											<!-- 开关类型依然使用下拉框类型，因为还需要考虑空值的状态 -->
											<el-select v-else-if="item.ctrr_rsrm_type == 2" 
											v-model="item.value"
											placeholder="请选择">
												<el-option></el-option>
												<el-option
												v-for="itemOption in item.ctrr_rsrm_valueFortype"
												:key="itemOption"
												:label="itemOption"
												:value="itemOption">
												</el-option>
											</el-select >
											<!-- 下拉框类型 -->
											<el-select v-else-if="item.ctrr_rsrm_type == 3" 
											v-model="item.value"
											placeholder="请选择">
												<el-option></el-option>
												<el-option
												v-for="itemOption in item.ctrr_rsrm_valueFortype"
												:key="itemOption"
												:label="itemOption"
												:value="itemOption">
												</el-option>
											</el-select >
											<!-- 单个时间类型：用时间范围元素承载 -->
											<el-date-picker v-else-if="item.ctrr_rsrm_type == 6"
											v-model="item.value"
											type="datetimerange"
											format="yyyy/MM/dd HH:mm:ss"
											value-format="yyyy/M/d/H/m/s"
											align="left"
											unlink-panels
											range-separator="至"
											start-placeholder="开始日期"
											end-placeholder="结束日期"
											:picker-options="pickerOptionsRange"></el-date-picker>
											<!-- 无法识别类型 -->
											<el-input v-else disabled >无法识别的搜索类型，请联系管理员</el-input disabled >
										</el-tooltip>
										<br>
									</el-form-item>
									<el-form-item 
									label="数据新增时间"
									:key="dataCreate.key"
									size="mini"
									style="width: 49%;display: inline-block;">
										<!-- 单个时间类型：用时间范围元素承载 -->
										<el-date-picker
										v-model="dataCreate.value"
										type="datetimerange"
										format="yyyy/MM/dd HH:mm:ss"
										value-format="yyyy-MM-dd HH:mm:ss"
										align="left"
										unlink-panels
										range-separator="至"
										start-placeholder="开始日期"
										end-placeholder="结束日期"
										:picker-options="pickerOptionsRange"></el-date-picker>
									</el-form-item>
									<el-form-item 
									label="数据更新时间"
									:key="dataUpdate.key"
									size="mini"
									style="width: 50%;display: inline-block;">
										<!-- 单个时间类型：用时间范围元素承载 -->
										<el-date-picker
										v-model="dataUpdate.value"
										type="datetimerange"
										format="yyyy/MM/dd HH:mm:ss"
										value-format="yyyy-MM-dd HH:mm:ss"
										align="left"
										unlink-panels
										range-separator="至"
										start-placeholder="开始日期"
										end-placeholder="结束日期"
										:picker-options="pickerOptionsRange"></el-date-picker>
									</el-form-item>
								</el-card>
							</div>
						</template>
						<el-divider><span style="color: orangered;">两种搜索取并集</span></el-divider>
						<div style="text-align: center;">
							<el-button type="primary" size="mini"  @click="search">开始搜索</el-button>
							<el-button type="primary" size="mini"  @click="resetSearch(now_ctrr_rsrm_id_l2)">重置</el-button>
						</div>
					</el-form>
				</div>
			</el-tab-pane>
		</el-tabs>

		<el-card class="box-card" v-loading="tableLoading" :show-header="isShowThisPage" style="border:none">
			<div slot="header" class="clearfix">
				<div v-show="isShowThisPage">
					<div>
						<el-tooltip>
							<div slot="content">获取当前表格待跟进数据</div>
							<el-button type="primary" size="mini" @click="handlGetincompletedData">待跟进</el-button>
						</el-tooltip>
						<el-button style="float: right;" type="success" size="mini" @click="handleGetLatelyAdd('thisMonth')">最近一月新增</el-button>
						<el-button style="float: right;" type="success" size="mini" @click="handleGetLatelyAdd('thisWeek')">最近一周新增</el-button>
						<el-button style="float: right;" type="success" size="mini" @click="handleGetLatelyAdd('today')">最近一日新增</el-button style="float: right;">
					</div>
					<el-divider></el-divider>
					<el-tooltip>
						<div slot="content">可以直接输入搜索</div>
						<div>
							<span>（切换表格将默认加载待办数据）</span>
							<el-cascader 
							v-model="cascaderDataDefault"
							:options="cascaderData" 
							:props="defaultCascaderProps"
							filterable
							:show-all-levels="false"
							@change="handleCascaderChange"
							size="mini"
							style="float: left;"></el-cascader>
						</div>
					</el-tooltip>
					<el-button v-show="isShowThisPage" style="float: right;margin-right: 15px;" type="primary" size="mini" @click="handlExportFile">导出</el-button>
				</div>
			</div>
			<template>
				{if condition="$adminInfo.admin_account == 'kwh'"}
				<el-tooltip>
					<div slot="content">点击显示/隐藏其他功能</div>
					<span @click="isShowThisPage = !isShowThisPage" style="cursor: pointer;color:#75cefd;">ITMC光缆故障</span>
				</el-tooltip>
				{/if}
				<div style="float: left;">
					<el-card class="box-card" v-show="tempDataShow">
						<div slot="header" class="clearfix">
							<span>最近一次编辑的数据</span>
							<el-button style="float: right; padding: 3px 0" type="text" @click="tempDataShow = false">不需要了，关闭</el-button>
						</div>
						<div style="height: 200px;overflow: scroll;">
							<el-alert title="刚刚您编辑的数据已被其他同事修改了，目前已帮您获取了最新数据，同时已将您刚刚编辑的数据临时保存在这里了，直接复制粘贴回去即可" :closable="false" type="warning" style="margin-bottom: 10px;"></el-alert>
							<div v-for="o in tableKey" :key="o" class="text item">
								{{ o.label + '：' + (tempData[o.key] || '')}}
							</div>
						</div>
					</el-card>
					<el-table
					ref="multipleTable"
					v-loading="tableLoading"
					:data="tableData"
					max-height="800"
					cell-style="padding:5px 0"
					border>
						<el-table-column type="expand" v-if="isShowThisPage">
							<template slot-scope="props">
								<el-form label-position="left" inline class="tableData-expand">
									<el-form-item 
										v-for="(value,index) in tableKey"
										label-class-name="labelStyle"
										:label="tableKey[index].label"
										:error="errFieldMsg[props.$index + '_' + tableKey[index].key]"
										:prop="tableKey[index].key">
										<el-tooltip :disabled="tableKey[index].ctrr_rsrm_tips ? false: true">
											<div slot="content">{{tableKey[index].ctrr_rsrm_tips}}</div>
											<!-- 文本类型 -->
											<el-input
											v-if="levelThree[tableKey[index].key].ctrr_rsrm_type == 1"
											type="textarea"
											size="mini" 
											v-model="props.row[tableKey[index].key]" 
											placeholder="请输入内容" 
											@change="handleEdit(props, tableKey[index], props.row[tableKey[index].key])"
											:show-word-limit="true"
											:rows="1"></el-input> 
											<!-- 开关类型 -->
											<el-switch
											v-else-if="levelThree[tableKey[index].key].ctrr_rsrm_type == 2"
											size="mini" 
											v-model="props.row[tableKey[index].key]" 
											:active-text="levelThree[tableKey[index].key].ctrr_rsrm_valueFortype[0]"
											:inactive-text="levelThree[tableKey[index].key].ctrr_rsrm_valueFortype[1]"
											:active-value="levelThree[tableKey[index].key].ctrr_rsrm_valueFortype[0]"
											:inactive-value="levelThree[tableKey[index].key].ctrr_rsrm_valueFortype[1]"
											@change="handleEdit(props, tableKey[index], props.row[tableKey[index].key])"></el-switch> 
											<!-- 下拉框类型 -->
											<el-select
											v-else-if="levelThree[tableKey[index].key].ctrr_rsrm_type == 3"
											v-model="props.row[tableKey[index].key]"
											placeholder="请选择"
											size="mini" 
											@change="handleEdit(props, tableKey[index], props.row[tableKey[index].key])">
												<el-option></el-option>
												<el-option
												v-for="i in levelThree[tableKey[index].key].ctrr_rsrm_valueFortype"
												:key="i"
												:label="i"
												:value="i"></el-option>
											</el-select>
											<!-- 时间选择器类型 -->
											<el-date-picker
											v-else-if="levelThree[tableKey[index].key].ctrr_rsrm_type == 6"
											type="datetime"
											format="yyyy/MM/dd HH:mm:ss"
											size="mini" 
											value-format="yyyy/MM/dd HH:mm:ss"
											placeholder="选择日期时间"
											align="left"
											:picker-options="pickerOptions"
											v-model="props.row[tableKey[index].key]"
											@change="handleEdit(props, tableKey[index], props.row[tableKey[index].key])"></el-date-picker>
											<!-- 无法识别类型 -->
											<el-input v-else disabled >无法识别的搜索类型，请联系管理员</el-input disabled >
										</el-tooltip>
									</el-form-item>
								</el-form>
							</template>
						</el-table-column>
						<el-table-column
							:resizable="false"
							label-class-name="labelStyle"
							label="标星"
							prop="star_state"
							width="50px"
							header-align="center"
							align="center"
							show-overflow-tooltip>
							<template slot-scope="props">
								<el-tooltip>
									<div slot="content">标星</div>
									<el-span
									v-if="props.row.star_state === 0"
									class="el-icon-star-off"
									style="font-size:25px;cursor: pointer;"
									@click="handleEdit(props,'star_state', 1)"></el-span>
									<el-span
									v-else class="el-icon-star-on"
									style="font-size:30px;color:#ff9900;cursor: pointer;"
									@click="handleEdit(props,'star_state', 0)"></el-span>
								</el-tooltip>
							</template>
						</el-table-column>
						<el-table-column
							:resizable="false"
							label-class-name="labelStyle"
							label="红旗"
							prop="flag_state"
							width="50px"
							header-align="center"
							align="center"
							show-overflow-tooltip>
							<template slot-scope="props">
								<el-tooltip>
									<div slot="content">红旗</div>
									<el-span
									v-if="props.row.flag_state === 0"
									class="el-icon-s-flag"
									style="font-size:25px;cursor: pointer;"
									@click="handleEdit(props,'flag_state', 1)"></el-span>
									<el-span
									v-else class="el-icon-s-flag"
									style="font-size:25px;color:#ff0c00fa;cursor: pointer;"
									@click="handleEdit(props,'flag_state', 0)"></el-span>
								</el-tooltip>
							</template>
						</el-table-column>
						<el-table-column
							v-for="i in columNum"
							:resizable="false"
							v-if="tableKey[i-1].label === '工单号'"
							label-class-name="labelStyle"
							:label="tableKey[i-1].label"
							:prop="tableKey[i-1].key"
							width="180px"
							header-align="center"
							show-overflow-tooltip>
							<template slot-scope="props">
								<el-form label-position="left"class="tableData-expand">
									<el-form-item :prop="tableKey[i-1].key"style="width:100%">
										<el-tooltip :disabled="tableKey[i-1].ctrr_rsrm_tips ? false: true">
											<div slot="content">{{tableKey[i-1].ctrr_rsrm_tips}}</div>
												<el-input
												type="textarea"
												:rows="1"
												size="mini" 
												v-model="props.row[tableKey[i-1].key]" 
												placeholder="请输入内容" 
												@change="handleEdit(props, tableKey[i-1], props.row[tableKey[i-1].key])"
												:show-word-limit="true"
												></el-input> 
										</el-tooltip>
									</el-form-item>
								</el-form>
							</template>
						</el-table-column>
						<el-table-column
							v-for="i in columNum"
							:resizable="false"
							v-if="tableKey[i-1].label === '结束时间（督办获取）'"
							label-class-name="labelStyle"
							:label="tableKey[i-1].label"
							:prop="tableKey[i-1].key"
							width="170px"
							header-align="center"
							show-overflow-tooltip>
							<template slot-scope="props">						
								<el-form label-position="left"class="tableData-expand">
									<el-form-item 
										:prop="tableKey[i-1].key"style="width:100%">
										<el-tooltip :disabled="tableKey[i-1].ctrr_rsrm_tips ? false: true">
											<div slot="content">{{tableKey[i-1].ctrr_rsrm_tips}}</div>
											<el-date-picker
											type="datetime"
											format="M月d日 H:mm"											size="mini" 
											value-format="yyyy/MM/dd HH:mm:ss"
											placeholder="选择日期时间"
											align="left"
											:picker-options="pickerOptions"
											v-model="props.row[tableKey[i-1].key]"
											@change="handleEdit(props, tableKey[i-1], props.row[tableKey[i-1].key])"
											style="width:100%"></el-date-picker>
										</el-tooltip>
									</el-form-item>
								</el-form>
							</template>
						</el-table-column>
						<el-table-column
							v-for="i in columNum"
							:resizable="false"
							v-if="tableKey[i-1].label === '开始时间'"
							label-class-name="labelStyle"
							:label="tableKey[i-1].label"
							:prop="tableKey[i-1].key"
							width="170px"
							header-align="center"
							show-overflow-tooltip>
							<template slot-scope="props">
								<el-form label-position="left"class="tableData-expand">
									<el-form-item 
										:prop="tableKey[i-1].key"style="width:100%">
										<el-tooltip :disabled="tableKey[i-1].ctrr_rsrm_tips ? false: true">
											<div slot="content">{{tableKey[i-1].ctrr_rsrm_tips}}</div>
											<el-date-picker
											type="datetime"
											format="M月d日 H:mm"											size="mini" 
											value-format="yyyy/MM/dd HH:mm:ss"
											placeholder="选择日期时间"
											align="left"
											:picker-options="pickerOptions"
											v-model="props.row[tableKey[i-1].key]"
											@change="handleEdit(props, tableKey[i-1], props.row[tableKey[i-1].key])"
											style="width:100%"></el-date-picker>
										</el-tooltip>
									</el-form-item>
								</el-form>
							</template>
						</el-table-column>
						<el-table-column
							v-for="i in columNum"
							:resizable="false"
							v-if="tableKey[i-1].label === '故障描述'"
							label-class-name="labelStyle"
							:label="tableKey[i-1].label"
							:prop="tableKey[i-1].key"
							width="240px"
							header-align="center"
							show-overflow-tooltip>
							<template slot-scope="props">
								<el-form label-position="left"class="tableData-expand">
									<el-form-item :prop="tableKey[i-1].key"style="width:100%">
										<el-tooltip :disabled="tableKey[i-1].ctrr_rsrm_tips ? false: true">
											<div slot="content">{{tableKey[i-1].ctrr_rsrm_tips}}</div>
												<el-input
												type="textarea"
												:rows="3"
												size="mini" 
												v-model="props.row[tableKey[i-1].key]" 
												placeholder="请输入内容" 
												@change="handleEdit(props, tableKey[i-1], props.row[tableKey[i-1].key])"
												:show-word-limit="true"
												></el-input> 
										</el-tooltip>
									</el-form-item>
								</el-form>
							</template>
						</el-table-column>
						<el-table-column
							v-for="i in columNum"
							:resizable="false"
							v-if="tableKey[i-1].label === '故障原因（督办获取）'"
							label-class-name="labelStyle"
							:label="tableKey[i-1].label"
							:prop="tableKey[i-1].key"
							width="200排序"
							header-align="center"
							show-overflow-tooltip>
							<template slot-scope="props">
								<el-form label-position="left"class="tableData-expand">
									<el-form-item 
										:prop="tableKey[i-1].key"style="width:100%">
										<el-tooltip :disabled="tableKey[i-1].ctrr_rsrm_tips ? false: true">
											<div slot="content">{{tableKey[i-1].ctrr_rsrm_tips}}</div>
												<el-input
												type="textarea"
												:rows="3"
												size="mini" 
												v-model="props.row[tableKey[i-1].key]" 
												placeholder="请输入内容" 
												@change="handleEdit(props, tableKey[i-1], props.row[tableKey[i-1].key])"
												:show-word-limit="true"
												></el-input> 
										</el-tooltip>
									</el-form-item>
								</el-form>
							</template>
						</el-table-column>
						<el-table-column
							v-for="i in columNum"
							:resizable="false"
							v-if="tableKey[i-1].label === '处理进展（督办获取）'"
							label-class-name="labelStyle"
							:label="tableKey[i-1].label"
							:prop="tableKey[i-1].key"
							width="240px"
							header-align="center"
							show-overflow-tooltip>
							<template slot-scope="props">
								<el-form label-position="left"class="tableData-expand">
									<el-form-item 
										:prop="tableKey[i-1].key"style="width:100%">
										<el-tooltip :disabled="tableKey[i-1].ctrr_rsrm_tips ? false: true">
											<div slot="content">{{tableKey[i-1].ctrr_rsrm_tips}}</div>
												<el-input
												type="textarea"
												:rows="3"
												size="mini" 
												v-model="props.row[tableKey[i-1].key]" 
												placeholder="请输入内容" 
												@change="handleEdit(props, tableKey[i-1], props.row[tableKey[i-1].key])"
												:show-word-limit="true"
												></el-input> 
										</el-tooltip>
									</el-form-item>
								</el-form>
							</template>
						</el-table-column>
					</el-table>
					<div v-show="isShowThisPage" class="block" style="padding-top: 20px;">
						<el-pagination
						@size-change="handleSizeChange"
						@current-change="handleCurrentChange"
						:current-page="pagination.currentPage"
						:page-sizes="pagination.pageSizeArr"
						:page-size="pagination.pageSize"
						layout="total, sizes, prev, pager, next, jumper"
						:total="pagination.total">
						</el-pagination>
					</div>
				</div>
			</template>
		</el-card>
	</div>
	
	<div id="app1">
		<el-tabs
		v-show="isShowThisPage"
		type="border-card" 
		value="packUpTab"
		v-loading="tabsLoading"
		:element-loading-text="tabsLoadingTxt"
		element-loading-spinner="el-icon-loading"
		element-loading-background="rgba(0, 0, 0, 0.8)"
		style="margin:100px auto 10px">
			<el-tab-pane label="收起" name="packUpTab">
			</el-tab-pane>
			<el-tab-pane label="组合搜索" name="searchTab">
				<div style="padding: 15px;border-radius: 5px;max-height: 500px;overflow:scroll;border: 1px solid #eee;">
					<el-card class="box-card">
						<el-divider content-position="left">tips~</el-divider>
						<div>- 若置空所有搜索条件，则默认加载待跟进数据</div>
					</el-card>
					<el-form ref="formJson[now_ctrr_rsrm_id_l2]" :model="formJson[now_ctrr_rsrm_id_l2]"  
					style="margin: 10px auto;
					padding: 10px auto;">
						<template>
							<div>
								<el-divider content-position="left">【搜索方式一：关键词组合】</el-divider>
								<el-card class="box-card">
									<el-form-item 
									:label="searchKeyWords.label"
									:key="searchKeyWords.key"
									size="mini"
									style="width: auto;display: inline-block;">
										<el-tooltip>
											<div slot="content">{{searchKeyWords.tips}}</div>
											<!-- 文本类型 -->
											<el-input 
											type="text"
											autosize 
											v-model="searchKeyWords.value"></el-input >
										</el-tooltip>
									</el-form-item>
								</el-card>
								<el-divider><span style="color: orangered;">两种搜索取并集</span></el-divider>
								<div style="text-align: center;">
									<el-button type="primary" size="mini"  @click="search">开始搜索</el-button>
									<el-button type="primary" size="mini"  @click="resetSearch(now_ctrr_rsrm_id_l2)">重置</el-button>
								</div>
								<el-divider content-position="left">【搜索方式二：其他搜索（检索速度较慢）】</el-divider>
								<el-card class="box-card">
									<el-form-item 
									v-for="item in formJson[now_ctrr_rsrm_id_l2]"
									:label="item.ctrr_rsrm_name"
									:key="item.ctrr_rsrm_id"
									size="mini"
									style="width: 50%;display: inline-block;">
										<el-tooltip :disabled="item.ctrr_rsrm_tips ?  false : true">
											<div slot="content">{{item.ctrr_rsrm_tips}}</div>
											<!-- 开关类型依然使用下拉框类型，因为还需要考虑空值的状态 -->
											<el-input v-if="item.ctrr_rsrm_type == 1" 
											v-model="item.value"
											type="textarea"
											placeholder="请选择"></el-input >
											<!-- 开关类型依然使用下拉框类型，因为还需要考虑空值的状态 -->
											<el-select v-else-if="item.ctrr_rsrm_type == 2" 
											v-model="item.value"
											placeholder="请选择">
												<el-option></el-option>
												<el-option
												v-for="itemOption in item.ctrr_rsrm_valueFortype"
												:key="itemOption"
												:label="itemOption"
												:value="itemOption">
												</el-option>
											</el-select >
											<!-- 下拉框类型 -->
											<el-select v-else-if="item.ctrr_rsrm_type == 3" 
											v-model="item.value"
											placeholder="请选择">
												<el-option></el-option>
												<el-option
												v-for="itemOption in item.ctrr_rsrm_valueFortype"
												:key="itemOption"
												:label="itemOption"
												:value="itemOption">
												</el-option>
											</el-select >
											<!-- 单个时间类型：用时间范围元素承载 -->
											<el-date-picker v-else-if="item.ctrr_rsrm_type == 6"
											v-model="item.value"
											type="datetimerange"
											format="yyyy/MM/dd HH:mm:ss"
											value-format="yyyy/M/d/H/m/s"
											align="left"
											unlink-panels
											range-separator="至"
											start-placeholder="开始日期"
											end-placeholder="结束日期"
											:picker-options="pickerOptionsRange"></el-date-picker>
											<!-- 无法识别类型 -->
											<el-input v-else disabled >无法识别的搜索类型，请联系管理员</el-input disabled >
										</el-tooltip>
										<br>
									</el-form-item>
									<el-form-item 
									label="数据新增时间"
									:key="dataCreate.key"
									size="mini"
									style="width: 49%;display: inline-block;">
										<!-- 单个时间类型：用时间范围元素承载 -->
										<el-date-picker
										v-model="dataCreate.value"
										type="datetimerange"
										format="yyyy/MM/dd HH:mm:ss"
										value-format="yyyy-MM-dd HH:mm:ss"
										align="left"
										unlink-panels
										range-separator="至"
										start-placeholder="开始日期"
										end-placeholder="结束日期"
										:picker-options="pickerOptionsRange"></el-date-picker>
									</el-form-item>
									<el-form-item 
									label="数据更新时间"
									:key="dataUpdate.key"
									size="mini"
									style="width: 50%;display: inline-block;">
										<!-- 单个时间类型：用时间范围元素承载 -->
										<el-date-picker
										v-model="dataUpdate.value"
										type="datetimerange"
										format="yyyy/MM/dd HH:mm:ss"
										value-format="yyyy-MM-dd HH:mm:ss"
										align="left"
										unlink-panels
										range-separator="至"
										start-placeholder="开始日期"
										end-placeholder="结束日期"
										:picker-options="pickerOptionsRange"></el-date-picker>
									</el-form-item>
								</el-card>
							</div>
						</template>
						<el-divider><span style="color: orangered;">两种搜索取并集</span></el-divider>
						<div style="text-align: center;">
							<el-button type="primary" size="mini"  @click="search">开始搜索</el-button>
							<el-button type="primary" size="mini"  @click="resetSearch(now_ctrr_rsrm_id_l2)">重置</el-button>
						</div>
					</el-form>
				</div>
			</el-tab-pane>
		</el-tabs>

		<el-card class="box-card" v-loading="tableLoading" :show-header="isShowThisPage" style="border:none">
			<div style="float: left;">
				{if condition="$adminInfo.admin_account == 'kwh'"}
				<el-tooltip>
					<div slot="content">点击显示/隐藏其他功能</div>
					<span @click="isShowThisPage = !isShowThisPage" style="cursor: pointer;color:#75cefd;">ITMC其他故障</span>
				</el-tooltip>
				{/if}
				<div slot="header" class="clearfix">
					<div v-show="isShowThisPage">
						<div>
							<el-tooltip>
								<div slot="content">获取当前表格待跟进数据</div>
								<el-button type="primary" size="mini" @click="handlGetincompletedData">待跟进</el-button>
							</el-tooltip>
							<el-button style="float: right;" type="success" size="mini" @click="handleGetLatelyAdd('thisMonth')">最近一月新增</el-button>
							<el-button style="float: right;" type="success" size="mini" @click="handleGetLatelyAdd('thisWeek')">最近一周新增</el-button>
							<el-button style="float: right;" type="success" size="mini" @click="handleGetLatelyAdd('today')">最近一日新增</el-button style="float: right;">
						</div>
						<el-divider></el-divider>
						<el-tooltip>
							<div slot="content">可以直接输入搜索</div>
							<div>
								<span>（切换表格将默认加载待办数据）</span>
								<el-cascader 
								v-model="cascaderDataDefault"
								:options="cascaderData" 
								:props="defaultCascaderProps"
								filterable
								:show-all-levels="false"
								@change="handleCascaderChange"
								size="mini"
								style="float: left;"></el-cascader>
							</div>
						</el-tooltip>
						<el-button v-show="isShowThisPage" style="float: right;margin-right: 15px;" type="primary" size="mini" @click="handlExportFile">导出</el-button>
					</div>
				</div>
				<template>
					<el-card class="box-card" v-show="tempDataShow">
						<div slot="header" class="clearfix">
							<span>最近一次编辑的数据</span>
							<el-button style="float: right; padding: 3px 0" type="text" @click="tempDataShow = false">不需要了，关闭</el-button>
						</div>
						<div style="height: 200px;overflow: scroll;">
							<el-alert title="刚刚您编辑的数据已被其他同事修改了，目前已帮您获取了最新数据，同时已将您刚刚编辑的数据临时保存在这里了，直接复制粘贴回去即可" :closable="false" type="warning" style="margin-bottom: 10px;"></el-alert>
							<div v-for="o in tableKey" :key="o" class="text item">
								{{ o.label + '：' + (tempData[o.key] || '')}}
							</div>
						</div>
					</el-card>
					<el-table
					ref="multipleTable"
					v-loading="tableLoading"
					:show-header="isShowThisPage"
					:data="tableData"
					max-height="800"
					cell-style="padding:5px 0;background: #fafafa;"
					border>
						<el-table-column type="expand" v-if="isShowThisPage">
							<template slot-scope="props">
								<el-form label-position="left" inline class="tableData-expand">
									<el-form-item 
										v-for="(value,index) in tableKey"
										label-class-name="labelStyle"
										:label="tableKey[index].label"
										:error="errFieldMsg[props.$index + '_' + tableKey[index].key]"
										:prop="tableKey[index].key">
										<el-tooltip :disabled="tableKey[index].ctrr_rsrm_tips ? false: true">
											<div slot="content">{{tableKey[index].ctrr_rsrm_tips}}</div>
											<!-- 文本类型 -->
											<el-input
											v-if="levelThree[tableKey[index].key].ctrr_rsrm_type == 1"
											type="textarea"
											size="mini" 
											v-model="props.row[tableKey[index].key]" 
											placeholder="请输入内容" 
											@change="handleEdit(props, tableKey[index], props.row[tableKey[index].key])"
											:show-word-limit="true"
											:rows="1"></el-input> 
											<!-- 开关类型 -->
											<el-switch
											v-else-if="levelThree[tableKey[index].key].ctrr_rsrm_type == 2"
											size="mini" 
											v-model="props.row[tableKey[index].key]" 
											:active-text="levelThree[tableKey[index].key].ctrr_rsrm_valueFortype[0]"
											:inactive-text="levelThree[tableKey[index].key].ctrr_rsrm_valueFortype[1]"
											:active-value="levelThree[tableKey[index].key].ctrr_rsrm_valueFortype[0]"
											:inactive-value="levelThree[tableKey[index].key].ctrr_rsrm_valueFortype[1]"
											@change="handleEdit(props, tableKey[index], props.row[tableKey[index].key])"></el-switch> 
											<!-- 下拉框类型 -->
											<el-select
											v-else-if="levelThree[tableKey[index].key].ctrr_rsrm_type == 3"
											v-model="props.row[tableKey[index].key]"
											placeholder="请选择"
											size="mini" 
											@change="handleEdit(props, tableKey[index], props.row[tableKey[index].key])">
												<el-option></el-option>
												<el-option
												v-for="i in levelThree[tableKey[index].key].ctrr_rsrm_valueFortype"
												:key="i"
												:label="i"
												:value="i"></el-option>
											</el-select>
											<!-- 时间选择器类型 -->
											<el-date-picker
											v-else-if="levelThree[tableKey[index].key].ctrr_rsrm_type == 6"
											type="datetime"
											format="yyyy/MM/dd HH:mm:ss"
											size="mini" 
											value-format="yyyy/MM/dd HH:mm:ss"
											placeholder="选择日期时间"
											align="left"
											:picker-options="pickerOptions"
											v-model="props.row[tableKey[index].key]"
											@change="handleEdit(props, tableKey[index], props.row[tableKey[index].key])"></el-date-picker>
											<!-- 无法识别类型 -->
											<el-input v-else disabled >无法识别的搜索类型，请联系管理员</el-input disabled >
										</el-tooltip>
									</el-form-item>
								</el-form>
							</template>
						</el-table-column>
						<el-table-column
							:resizable="false"
							label-class-name="labelStyle"
							label="标星"
							prop="star_state"
							width="50px"
							header-align="center"
							align="center"
							show-overflow-tooltip>
							<template slot-scope="props">
								<el-tooltip>
									<div slot="content">标星</div>
									<el-span
									v-if="props.row.star_state === 0"
									class="el-icon-star-off"
									style="font-size:25px;cursor: pointer;"
									@click="handleEdit(props,'star_state', 1)"></el-span>
									<el-span
									v-else class="el-icon-star-on"
									style="font-size:30px;color:#ff9900;cursor: pointer;"
									@click="handleEdit(props,'star_state', 0)"></el-span>
								</el-tooltip>
							</template>
						</el-table-column>
						<el-table-column
							:resizable="false"
							label-class-name="labelStyle"
							label="红旗"
							prop="flag_state"
							width="50px"
							header-align="center"
							align="center"
							show-overflow-tooltip>
							<template slot-scope="props">
								<el-tooltip>
									<div slot="content">红旗</div>
									<el-span
									v-if="props.row.flag_state === 0"
									class="el-icon-s-flag"
									style="font-size:25px;cursor: pointer;"
									@click="handleEdit(props,'flag_state', 1)"></el-span>
									<el-span
									v-else class="el-icon-s-flag"
									style="font-size:25px;color:#ff0c00fa;cursor: pointer;"
									@click="handleEdit(props,'flag_state', 0)"></el-span>
								</el-tooltip>
							</template>
						</el-table-column>
						<el-table-column
							v-for="i in columNum"
							:resizable="false"
							v-if="tableKey[i-1].label === '工单号'"
							label-class-name="labelStyle"
							:label="tableKey[i-1].label"
							:prop="tableKey[i-1].key"
							width="180px"
							header-align="center"
							show-overflow-tooltip>
							<template slot-scope="props">
								<el-form label-position="left"class="tableData-expand">
									<el-form-item :prop="tableKey[i-1].key"style="width:100%">
										<el-tooltip :disabled="tableKey[i-1].ctrr_rsrm_tips ? false: true">
											<div slot="content">{{tableKey[i-1].ctrr_rsrm_tips}}</div>
												<el-input
												type="textarea"
												:rows="1"
												size="mini" 
												v-model="props.row[tableKey[i-1].key]" 
												placeholder="请输入内容" 
												@change="handleEdit(props, tableKey[i-1], props.row[tableKey[i-1].key])"
												:show-word-limit="true"
												></el-input> 
										</el-tooltip>
									</el-form-item>
								</el-form>
							</template>
						</el-table-column>
						<el-table-column
							v-for="i in columNum"
							:resizable="false"
							v-if="tableKey[i-1].label === '结束时间（督办获取）'"
							label-class-name="labelStyle"
							:label="tableKey[i-1].label"
							:prop="tableKey[i-1].key"
							width="170px"
							header-align="center"
							show-overflow-tooltip>
							<template slot-scope="props">						
								<el-form label-position="left"class="tableData-expand">
									<el-form-item 
										:prop="tableKey[i-1].key"style="width:100%">
										<el-tooltip :disabled="tableKey[i-1].ctrr_rsrm_tips ? false: true">
											<div slot="content">{{tableKey[i-1].ctrr_rsrm_tips}}</div>
											<el-date-picker
											type="datetime"
											format="M月d日 H:mm"											size="mini" 
											value-format="yyyy/MM/dd HH:mm:ss"
											placeholder="选择日期时间"
											align="left"
											:picker-options="pickerOptions"
											v-model="props.row[tableKey[i-1].key]"
											@change="handleEdit(props, tableKey[i-1], props.row[tableKey[i-1].key])"
											style="width:100%"></el-date-picker>
										</el-tooltip>
									</el-form-item>
								</el-form>
							</template>
						</el-table-column>
						<el-table-column
							v-for="i in columNum"
							:resizable="false"
							v-if="tableKey[i-1].label === '开始时间'"
							label-class-name="labelStyle"
							:label="tableKey[i-1].label"
							:prop="tableKey[i-1].key"
							width="170px"
							header-align="center"
							show-overflow-tooltip>
							<template slot-scope="props">
								<el-form label-position="left"class="tableData-expand">
									<el-form-item 
										:prop="tableKey[i-1].key"style="width:100%">
										<el-tooltip :disabled="tableKey[i-1].ctrr_rsrm_tips ? false: true">
											<div slot="content">{{tableKey[i-1].ctrr_rsrm_tips}}</div>
											<el-date-picker
											type="datetime"
											format="M月d日 H:mm"											size="mini" 
											value-format="yyyy/MM/dd HH:mm:ss"
											placeholder="选择日期时间"
											align="left"
											:picker-options="pickerOptions"
											v-model="props.row[tableKey[i-1].key]"
											@change="handleEdit(props, tableKey[i-1], props.row[tableKey[i-1].key])"
											style="width:100%"></el-date-picker>
										</el-tooltip>
									</el-form-item>
								</el-form>
							</template>
						</el-table-column>
						<el-table-column
							v-for="i in columNum"
							:resizable="false"
							v-if="tableKey[i-1].label === '故障描述'"
							label-class-name="labelStyle"
							:label="tableKey[i-1].label"
							:prop="tableKey[i-1].key"
							width="240px"
							header-align="center"
							show-overflow-tooltip>
							<template slot-scope="props">
								<el-form label-position="left"class="tableData-expand">
									<el-form-item 
										:prop="tableKey[i-1].key"style="width:100%">
										<el-tooltip :disabled="tableKey[i-1].ctrr_rsrm_tips ? false: true">
											<div slot="content">{{tableKey[i-1].ctrr_rsrm_tips}}</div>
												<el-input
												type="textarea"
												:rows="3"
												size="mini" 
												v-model="props.row[tableKey[i-1].key]" 
												placeholder="请输入内容" 
												@change="handleEdit(props, tableKey[i-1], props.row[tableKey[i-1].key])"
												:show-word-limit="true"
												></el-input> 
										</el-tooltip>
									</el-form-item>
								</el-form>
							</template>
						</el-table-column>
						<el-table-column
							v-for="i in columNum"
							:resizable="false"
							v-if="tableKey[i-1].label === '故障原因（督办获取）'"
							:rows="3"
							:prop="tableKey[i-1].key"
							width="240px"
							header-align="center"
							show-overflow-tooltip>
							<template slot-scope="props">
								<el-form label-position="left"class="tableData-expand">
									<el-form-item 
										:prop="tableKey[i-1].key"style="width:100%">
										<el-tooltip :disabled="tableKey[i-1].ctrr_rsrm_tips ? false: true">
											<div slot="content">{{tableKey[i-1].ctrr_rsrm_tips}}</div>
												<el-input
												type="textarea"
												:rows="3"
												size="mini" 
												v-model="props.row[tableKey[i-1].key]" 
												placeholder="请输入内容" 
												@change="handleEdit(props, tableKey[i-1], props.row[tableKey[i-1].key])"
												:show-word-limit="true"
												></el-input> 
										</el-tooltip>
									</el-form-item>
								</el-form>
							</template>
						</el-table-column>
						<el-table-column
							v-for="i in columNum"
							:resizable="false"
							v-if="tableKey[i-1].label === '处理进展（督办获取）'"
							label-class-name="labelStyle"
							:label="tableKey[i-1].label"
							:prop="tableKey[i-1].key"
							width="240px"
							header-align="center"
							show-overflow-tooltip>
							<template slot-scope="props">
								<el-form label-position="left"class="tableData-expand">
									<el-form-item 
										:prop="tableKey[i-1].key"style="width:100%">
										<el-tooltip :disabled="tableKey[i-1].ctrr_rsrm_tips ? false: true">
											<div slot="content">{{tableKey[i-1].ctrr_rsrm_tips}}</div>
												<el-input
												type="textarea"
												:rows="3"
												size="mini" 
												v-model="props.row[tableKey[i-1].key]" 
												placeholder="请输入内容" 
												@change="handleEdit(props, tableKey[i-1], props.row[tableKey[i-1].key])"
												:show-word-limit="true"
												></el-input> 
										</el-tooltip>
									</el-form-item>
								</el-form>
							</template>
						</el-table-column>
					</el-table>
					<div v-show="isShowThisPage" class="block" style="padding-top: 20px;">
						<el-pagination
						@size-change="handleSizeChange"
						@current-change="handleCurrentChange"
						:current-page="pagination.currentPage"
						:page-sizes="pagination.pageSizeArr"
						:page-size="pagination.pageSize"
						layout="total, sizes, prev, pager, next, jumper"
						:total="pagination.total">
						</el-pagination>
					</div>
				</template>
			</div>	
		</el-card>
	</div>
	
	<div id="app2">
		<el-tabs
		v-show="isShowThisPage"
		type="border-card" 
		value="packUpTab"
		v-loading="tabsLoading"
		:element-loading-text="tabsLoadingTxt"
		element-loading-spinner="el-icon-loading"
		element-loading-background="rgba(0, 0, 0, 0.8)"
		style="margin:100px auto 10px">
			<el-tab-pane label="收起" name="packUpTab">
			</el-tab-pane>
			<el-tab-pane label="组合搜索" name="searchTab">
				<div style="padding: 15px;border-radius: 5px;max-height: 500px;overflow:scroll;border: 1px solid #eee;">
					<el-card class="box-card">
						<el-divider content-position="left">tips~</el-divider>
						<div>- 若置空所有搜索条件，则默认加载待跟进数据</div>
					</el-card>
					<el-form ref="formJson[now_ctrr_rsrm_id_l2]" :model="formJson[now_ctrr_rsrm_id_l2]"  
					style="margin: 10px auto;
					padding: 10px auto;">
						<template>
							<div>
								<el-divider content-position="left">【搜索方式一：关键词组合】</el-divider>
								<el-card class="box-card">
									<el-form-item 
									:label="searchKeyWords.label"
									:key="searchKeyWords.key"
									size="mini"
									style="width: auto;display: inline-block;">
										<el-tooltip>
											<div slot="content">{{searchKeyWords.tips}}</div>
											<!-- 文本类型 -->
											<el-input 
											type="text"
											autosize 
											v-model="searchKeyWords.value"></el-input >
										</el-tooltip>
									</el-form-item>
								</el-card>
								<el-divider><span style="color: orangered;">两种搜索取并集</span></el-divider>
								<div style="text-align: center;">
									<el-button type="primary" size="mini"  @click="search">开始搜索</el-button>
									<el-button type="primary" size="mini"  @click="resetSearch(now_ctrr_rsrm_id_l2)">重置</el-button>
								</div>
								<el-divider content-position="left">【搜索方式二：其他搜索（检索速度较慢）】</el-divider>
								<el-card class="box-card">
									<el-form-item 
									v-for="item in formJson[now_ctrr_rsrm_id_l2]"
									:label="item.ctrr_rsrm_name"
									:key="item.ctrr_rsrm_id"
									size="mini"
									style="width: 50%;display: inline-block;">
										<el-tooltip :disabled="item.ctrr_rsrm_tips ?  false : true">
											<div slot="content">{{item.ctrr_rsrm_tips}}</div>
											<!-- 开关类型依然使用下拉框类型，因为还需要考虑空值的状态 -->
											<el-input v-if="item.ctrr_rsrm_type == 1" 
											v-model="item.value"
											type="textarea"
											placeholder="请选择"></el-input >
											<!-- 开关类型依然使用下拉框类型，因为还需要考虑空值的状态 -->
											<el-select v-else-if="item.ctrr_rsrm_type == 2" 
											v-model="item.value"
											placeholder="请选择">
												<el-option></el-option>
												<el-option
												v-for="itemOption in item.ctrr_rsrm_valueFortype"
												:key="itemOption"
												:label="itemOption"
												:value="itemOption">
												</el-option>
											</el-select >
											<!-- 下拉框类型 -->
											<el-select v-else-if="item.ctrr_rsrm_type == 3" 
											v-model="item.value"
											placeholder="请选择">
												<el-option></el-option>
												<el-option
												v-for="itemOption in item.ctrr_rsrm_valueFortype"
												:key="itemOption"
												:label="itemOption"
												:value="itemOption">
												</el-option>
											</el-select >
											<!-- 单个时间类型：用时间范围元素承载 -->
											<el-date-picker v-else-if="item.ctrr_rsrm_type == 6"
											v-model="item.value"
											type="datetimerange"
											format="yyyy/MM/dd HH:mm:ss"
											value-format="yyyy/M/d/H/m/s"
											align="left"
											unlink-panels
											range-separator="至"
											start-placeholder="开始日期"
											end-placeholder="结束日期"
											:picker-options="pickerOptionsRange"></el-date-picker>
											<!-- 无法识别类型 -->
											<el-input v-else disabled >无法识别的搜索类型，请联系管理员</el-input disabled >
										</el-tooltip>
										<br>
									</el-form-item>
									<el-form-item 
									label="数据新增时间"
									:key="dataCreate.key"
									size="mini"
									style="width: 49%;display: inline-block;">
										<!-- 单个时间类型：用时间范围元素承载 -->
										<el-date-picker
										v-model="dataCreate.value"
										type="datetimerange"
										format="yyyy/MM/dd HH:mm:ss"
										value-format="yyyy-MM-dd HH:mm:ss"
										align="left"
										unlink-panels
										range-separator="至"
										start-placeholder="开始日期"
										end-placeholder="结束日期"
										:picker-options="pickerOptionsRange"></el-date-picker>
									</el-form-item>
									<el-form-item 
									label="数据更新时间"
									:key="dataUpdate.key"
									size="mini"
									style="width: 50%;display: inline-block;">
										<!-- 单个时间类型：用时间范围元素承载 -->
										<el-date-picker
										v-model="dataUpdate.value"
										type="datetimerange"
										format="yyyy/MM/dd HH:mm:ss"
										value-format="yyyy-MM-dd HH:mm:ss"
										align="left"
										unlink-panels
										range-separator="至"
										start-placeholder="开始日期"
										end-placeholder="结束日期"
										:picker-options="pickerOptionsRange"></el-date-picker>
									</el-form-item>
								</el-card>
							</div>
						</template>
						<el-divider><span style="color: orangered;">两种搜索取并集</span></el-divider>
						<div style="text-align: center;">
							<el-button type="primary" size="mini"  @click="search">开始搜索</el-button>
							<el-button type="primary" size="mini"  @click="resetSearch(now_ctrr_rsrm_id_l2)">重置</el-button>
						</div>
					</el-form>
				</div>
			</el-tab-pane>
		</el-tabs>

		<el-card class="box-card" v-loading="tableLoading" :show-header="isShowThisPage" style="border:none">
			<div style="float: left;">
				<div slot="header" class="clearfix">
					<div v-show="isShowThisPage">
						<div>
							<el-tooltip>
								<div slot="content">获取当前表格待跟进数据</div>
								<el-button type="primary" size="mini" @click="handlGetincompletedData">待跟进</el-button>
							</el-tooltip>
							<el-button style="float: right;" type="success" size="mini" @click="handleGetLatelyAdd('thisMonth')">最近一月新增</el-button>
							<el-button style="float: right;" type="success" size="mini" @click="handleGetLatelyAdd('thisWeek')">最近一周新增</el-button>
							<el-button style="float: right;" type="success" size="mini" @click="handleGetLatelyAdd('today')">最近一日新增</el-button style="float: right;">
						</div>
						<el-divider></el-divider>
						<el-tooltip>
							<div slot="content">可以直接输入搜索</div>
							<div>
								<span>（切换表格将默认加载待办数据）</span>
								<el-cascader 
								v-model="cascaderDataDefault"
								:options="cascaderData" 
								:props="defaultCascaderProps"
								filterable
								:show-all-levels="false"
								@change="handleCascaderChange"
								size="mini"
								style="float: left;"></el-cascader>
							</div>
						</el-tooltip>
						<el-button v-show="isShowThisPage" style="float: right;margin-right: 15px;" type="primary" size="mini" @click="handlExportFile">导出</el-button>
					</div>
				</div>
				<template>
					{if condition="$adminInfo.admin_account == 'kwh'"}
					<el-tooltip>
						<div slot="content">点击显示/隐藏其他功能</div>
						<span @click="isShowThisPage = !isShowThisPage" style="cursor: pointer;color:#75cefd;">政企光缆故障</span>
					</el-tooltip>
					{/if}
					<el-card class="box-card" v-show="tempDataShow">
						<div slot="header" class="clearfix">
							<span>最近一次编辑的数据</span>
							<el-button style="float: right; padding: 3px 0" type="text" @click="tempDataShow = false">不需要了，关闭</el-button>
						</div>
						<div style="height: 200px;overflow: scroll;">
							<el-alert title="刚刚您编辑的数据已被其他同事修改了，目前已帮您获取了最新数据，同时已将您刚刚编辑的数据临时保存在这里了，直接复制粘贴回去即可" :closable="false" type="warning" style="margin-bottom: 10px;"></el-alert>
							<div v-for="o in tableKey" :key="o" class="text item">
								{{ o.label + '：' + (tempData[o.key] || '')}}
							</div>
						</div>
					</el-card>
					<el-table
					ref="multipleTable"
					v-loading="tableLoading"
					:show-header="isShowThisPage"
					:data="tableData"
					max-height="800"
					cell-style="padding:5px 0"
					border>
						<el-table-column type="expand" v-if="isShowThisPage">
							<template slot-scope="props">
								<el-form label-position="left" inline class="tableData-expand">
									<el-form-item 
										v-for="(value,index) in tableKey"
										label-class-name="labelStyle"
										:label="tableKey[index].label"
										:error="errFieldMsg[props.$index + '_' + tableKey[index].key]"
										:prop="tableKey[index].key">
										<el-tooltip :disabled="tableKey[index].ctrr_rsrm_tips ? false: true">
											<div slot="content">{{tableKey[index].ctrr_rsrm_tips}}</div>
											<!-- 文本类型 -->
											<el-input
											v-if="levelThree[tableKey[index].key].ctrr_rsrm_type == 1"
											type="textarea"
											size="mini" 
											v-model="props.row[tableKey[index].key]" 
											placeholder="请输入内容" 
											@change="handleEdit(props, tableKey[index], props.row[tableKey[index].key])"
											:show-word-limit="true"
											:rows="1"></el-input> 
											<!-- 开关类型 -->
											<el-switch
											v-else-if="levelThree[tableKey[index].key].ctrr_rsrm_type == 2"
											size="mini" 
											v-model="props.row[tableKey[index].key]" 
											:active-text="levelThree[tableKey[index].key].ctrr_rsrm_valueFortype[0]"
											:inactive-text="levelThree[tableKey[index].key].ctrr_rsrm_valueFortype[1]"
											:active-value="levelThree[tableKey[index].key].ctrr_rsrm_valueFortype[0]"
											:inactive-value="levelThree[tableKey[index].key].ctrr_rsrm_valueFortype[1]"
											@change="handleEdit(props, tableKey[index], props.row[tableKey[index].key])"></el-switch> 
											<!-- 下拉框类型 -->
											<el-select
											v-else-if="levelThree[tableKey[index].key].ctrr_rsrm_type == 3"
											v-model="props.row[tableKey[index].key]"
											placeholder="请选择"
											size="mini" 
											@change="handleEdit(props, tableKey[index], props.row[tableKey[index].key])">
												<el-option></el-option>
												<el-option
												v-for="i in levelThree[tableKey[index].key].ctrr_rsrm_valueFortype"
												:key="i"
												:label="i"
												:value="i"></el-option>
											</el-select>
											<!-- 时间选择器类型 -->
											<el-date-picker
											v-else-if="levelThree[tableKey[index].key].ctrr_rsrm_type == 6"
											type="datetime"
											format="yyyy/MM/dd HH:mm:ss"
											size="mini" 
											value-format="yyyy/MM/dd HH:mm:ss"
											placeholder="选择日期时间"
											align="left"
											:picker-options="pickerOptions"
											v-model="props.row[tableKey[index].key]"
											@change="handleEdit(props, tableKey[index], props.row[tableKey[index].key])"></el-date-picker>
											<!-- 无法识别类型 -->
											<el-input v-else disabled >无法识别的搜索类型，请联系管理员</el-input disabled >
										</el-tooltip>
									</el-form-item>
								</el-form>
							</template>
						</el-table-column>
						<el-table-column
							:resizable="false"
							label-class-name="labelStyle"
							label="标星"
							prop="star_state"
							width="50px"
							header-align="center"
							align="center"
							show-overflow-tooltip>
							<template slot-scope="props">
								<el-tooltip>
									<div slot="content">标星</div>
									<el-span
									v-if="props.row.star_state === 0"
									class="el-icon-star-off"
									style="font-size:25px;cursor: pointer;"
									@click="handleEdit(props,'star_state', 1)"></el-span>
									<el-span
									v-else class="el-icon-star-on"
									style="font-size:30px;color:#ff9900;cursor: pointer;"
									@click="handleEdit(props,'star_state', 0)"></el-span>
								</el-tooltip>
							</template>
						</el-table-column>
						<el-table-column
							:resizable="false"
							label-class-name="labelStyle"
							label="红旗"
							prop="flag_state"
							width="50px"
							header-align="center"
							align="center"
							show-overflow-tooltip>
							<template slot-scope="props">
								<el-tooltip>
									<div slot="content">红旗</div>
									<el-span
									v-if="props.row.flag_state === 0"
									class="el-icon-s-flag"
									style="font-size:25px;cursor: pointer;"
									@click="handleEdit(props,'flag_state', 1)"></el-span>
									<el-span
									v-else class="el-icon-s-flag"
									style="font-size:25px;color:#ff0c00fa;cursor: pointer;"
									@click="handleEdit(props,'flag_state', 0)"></el-span>
								</el-tooltip>
							</template>
						</el-table-column>
						<el-table-column
							v-for="i in columNum"
							:resizable="false"
							v-if="tableKey[i-1].label === '工单号'"
							label-class-name="labelStyle"
							:label="tableKey[i-1].label"
							:prop="tableKey[i-1].key"
							width="180px"
							header-align="center"
							show-overflow-tooltip>
							<template slot-scope="props">
								<el-form label-position="left"class="tableData-expand">
									<el-form-item :prop="tableKey[i-1].key"style="width:100%">
										<el-tooltip :disabled="tableKey[i-1].ctrr_rsrm_tips ? false: true">
											<div slot="content">{{tableKey[i-1].ctrr_rsrm_tips}}</div>
												<el-input
												type="textarea"
												:rows="1"
												size="mini" 
												v-model="props.row[tableKey[i-1].key]" 
												placeholder="请输入内容" 
												@change="handleEdit(props, tableKey[i-1], props.row[tableKey[i-1].key])"
												:show-word-limit="true"
												></el-input> 
										</el-tooltip>
									</el-form-item>
								</el-form>
							</template>
						</el-table-column>
						<el-table-column
							v-for="i in columNum"
							:resizable="false"
							v-if="tableKey[i-1].label === '结束时间（督办获取）'"
							label-class-name="labelStyle"
							:label="tableKey[i-1].label"
							:prop="tableKey[i-1].key"
							width="170px"
							header-align="center"
							show-overflow-tooltip>
							<template slot-scope="props">						
								<el-form label-position="left"class="tableData-expand">
									<el-form-item 
										:prop="tableKey[i-1].key"style="width:100%">
										<el-tooltip :disabled="tableKey[i-1].ctrr_rsrm_tips ? false: true">
											<div slot="content">{{tableKey[i-1].ctrr_rsrm_tips}}</div>
											<el-date-picker
											type="datetime"
											format="M月d日 H:mm"											size="mini" 
											value-format="yyyy/MM/dd HH:mm:ss"
											placeholder="选择日期时间"
											align="left"
											:picker-options="pickerOptions"
											v-model="props.row[tableKey[i-1].key]"
											@change="handleEdit(props, tableKey[i-1], props.row[tableKey[i-1].key])"
											style="width:100%"></el-date-picker>
										</el-tooltip>
									</el-form-item>
								</el-form>
							</template>
						</el-table-column>
						<el-table-column
							v-for="i in columNum"
							:resizable="false"
							v-if="tableKey[i-1].label === '开始时间'"
							label-class-name="labelStyle"
							:label="tableKey[i-1].label"
							:prop="tableKey[i-1].key"
							width="170px"
							header-align="center"
							show-overflow-tooltip>
							<template slot-scope="props">
								<el-form label-position="left"class="tableData-expand">
									<el-form-item 
										:prop="tableKey[i-1].key"style="width:100%">
										<el-tooltip :disabled="tableKey[i-1].ctrr_rsrm_tips ? false: true">
											<div slot="content">{{tableKey[i-1].ctrr_rsrm_tips}}</div>
											<el-date-picker
											type="datetime"
											format="M月d日 H:mm"											size="mini" 
											value-format="yyyy/MM/dd HH:mm:ss"
											placeholder="选择日期时间"
											align="left"
											:picker-options="pickerOptions"
											v-model="props.row[tableKey[i-1].key]"
											@change="handleEdit(props, tableKey[i-1], props.row[tableKey[i-1].key])"
											style="width:100%"></el-date-picker>
										</el-tooltip>
									</el-form-item>
								</el-form>
							</template>
						</el-table-column>
						<el-table-column
							v-for="i in columNum"
							:resizable="false"
							v-if="tableKey[i-1].label === '故障描述'"
							label-class-name="labelStyle"
							:label="tableKey[i-1].label"
							:prop="tableKey[i-1].key"
							width="240px"
							header-align="center"
							show-overflow-tooltip>
							<template slot-scope="props">
								<el-form label-position="left"class="tableData-expand">
									<el-form-item 
										:prop="tableKey[i-1].key"style="width:100%">
										<el-tooltip :disabled="tableKey[i-1].ctrr_rsrm_tips ? false: true">
											<div slot="content">{{tableKey[i-1].ctrr_rsrm_tips}}</div>
												<el-input
												type="textarea"
												:rows="3"
												size="mini" 
												v-model="props.row[tableKey[i-1].key]" 
												placeholder="请输入内容" 
												@change="handleEdit(props, tableKey[i-1], props.row[tableKey[i-1].key])"
												:show-word-limit="true"
												></el-input> 
										</el-tooltip>
									</el-form-item>
								</el-form>
							</template>
						</el-table-column>
						<el-table-column
							v-for="i in columNum"
							:resizable="false"
							v-if="tableKey[i-1].label === '故障原因（督办获取）'"
							label-class-name="labelStyle"
							:label="tableKey[i-1].label"
							:prop="tableKey[i-1].key"
							width="240px"
							header-align="center"
							show-overflow-tooltip>
							<template slot-scope="props">
								<el-form label-position="left"class="tableData-expand">
									<el-form-item 
										:prop="tableKey[i-1].key"style="width:100%">
										<el-tooltip :disabled="tableKey[i-1].ctrr_rsrm_tips ? false: true">
											<div slot="content">{{tableKey[i-1].ctrr_rsrm_tips}}</div>
												<el-input
												type="textarea"
												:rows="3"
												size="mini" 
												v-model="props.row[tableKey[i-1].key]" 
												placeholder="请输入内容" 
												@change="handleEdit(props, tableKey[i-1], props.row[tableKey[i-1].key])"
												:show-word-limit="true"
												></el-input> 
										</el-tooltip>
									</el-form-item>
								</el-form>
							</template>
						</el-table-column>
						<el-table-column
							v-for="i in columNum"
							:resizable="false"
							v-if="tableKey[i-1].label === '处理进展（督办获取）'"
							label-class-name="labelStyle"
							:label="tableKey[i-1].label"
							:prop="tableKey[i-1].key"
							width="240px"
							header-align="center"
							show-overflow-tooltip>
							<template slot-scope="props">
								<el-form label-position="left"class="tableData-expand">
									<el-form-item 
										:prop="tableKey[i-1].key"style="width:100%">
										<el-tooltip :disabled="tableKey[i-1].ctrr_rsrm_tips ? false: true">
											<div slot="content">{{tableKey[i-1].ctrr_rsrm_tips}}</div>
												<el-input
												type="textarea"
												:rows="3"
												size="mini" 
												v-model="props.row[tableKey[i-1].key]" 
												placeholder="请输入内容" 
												@change="handleEdit(props, tableKey[i-1], props.row[tableKey[i-1].key])"
												:show-word-limit="true"
												></el-input> 
										</el-tooltip>
									</el-form-item>
								</el-form>
							</template>
						</el-table-column>
					</el-table>
					<div v-show="isShowThisPage" class="block" style="padding-top: 20px;">
						<el-pagination
						@size-change="handleSizeChange"
						@current-change="handleCurrentChange"
						:current-page="pagination.currentPage"
						:page-sizes="pagination.pageSizeArr"
						:page-size="pagination.pageSize"
						layout="total, sizes, prev, pager, next, jumper"
						:total="pagination.total">
						</el-pagination>
					</div>
				</template>
			</div>
		</el-card>
	</div>
	
	<div id="app3">
		<el-tabs
		v-show="isShowThisPage"
		type="border-card" 
		value="packUpTab"
		v-loading="tabsLoading"
		:element-loading-text="tabsLoadingTxt"
		element-loading-spinner="el-icon-loading"
		element-loading-background="rgba(0, 0, 0, 0.8)"
		style="margin:100px auto 10px">
			<el-tab-pane label="收起" name="packUpTab">
			</el-tab-pane>
			<el-tab-pane label="组合搜索" name="searchTab">
				<div style="padding: 15px;border-radius: 5px;max-height: 500px;overflow:scroll;border: 1px solid #eee;">
					<el-card class="box-card">
						<el-divider content-position="left">tips~</el-divider>
						<div>- 若置空所有搜索条件，则默认加载待跟进数据</div>
					</el-card>
					<el-form ref="formJson[now_ctrr_rsrm_id_l2]" :model="formJson[now_ctrr_rsrm_id_l2]"  
					style="margin: 10px auto;
					padding: 10px auto;">
						<template>
							<div>
								<el-divider content-position="left">【搜索方式一：关键词组合】</el-divider>
								<el-card class="box-card">
									<el-form-item 
									:label="searchKeyWords.label"
									:key="searchKeyWords.key"
									size="mini"
									style="width: auto;display: inline-block;">
										<el-tooltip>
											<div slot="content">{{searchKeyWords.tips}}</div>
											<!-- 文本类型 -->
											<el-input 
											type="text"
											autosize 
											v-model="searchKeyWords.value"></el-input >
										</el-tooltip>
									</el-form-item>
								</el-card>
								<el-divider><span style="color: orangered;">两种搜索取并集</span></el-divider>
								<div style="text-align: center;">
									<el-button type="primary" size="mini"  @click="search">开始搜索</el-button>
									<el-button type="primary" size="mini"  @click="resetSearch(now_ctrr_rsrm_id_l2)">重置</el-button>
								</div>
								<el-divider content-position="left">【搜索方式二：其他搜索（检索速度较慢）】</el-divider>
								<el-card class="box-card">
									<el-form-item 
									v-for="item in formJson[now_ctrr_rsrm_id_l2]"
									:label="item.ctrr_rsrm_name"
									:key="item.ctrr_rsrm_id"
									size="mini"
									style="width: 50%;display: inline-block;">
										<el-tooltip :disabled="item.ctrr_rsrm_tips ?  false : true">
											<div slot="content">{{item.ctrr_rsrm_tips}}</div>
											<!-- 开关类型依然使用下拉框类型，因为还需要考虑空值的状态 -->
											<el-input v-if="item.ctrr_rsrm_type == 1" 
											v-model="item.value"
											type="textarea"
											placeholder="请选择"></el-input >
											<!-- 开关类型依然使用下拉框类型，因为还需要考虑空值的状态 -->
											<el-select v-else-if="item.ctrr_rsrm_type == 2" 
											v-model="item.value"
											placeholder="请选择">
												<el-option></el-option>
												<el-option
												v-for="itemOption in item.ctrr_rsrm_valueFortype"
												:key="itemOption"
												:label="itemOption"
												:value="itemOption">
												</el-option>
											</el-select >
											<!-- 下拉框类型 -->
											<el-select v-else-if="item.ctrr_rsrm_type == 3" 
											v-model="item.value"
											placeholder="请选择">
												<el-option></el-option>
												<el-option
												v-for="itemOption in item.ctrr_rsrm_valueFortype"
												:key="itemOption"
												:label="itemOption"
												:value="itemOption">
												</el-option>
											</el-select >
											<!-- 单个时间类型：用时间范围元素承载 -->
											<el-date-picker v-else-if="item.ctrr_rsrm_type == 6"
											v-model="item.value"
											type="datetimerange"
											format="yyyy/MM/dd HH:mm:ss"
											value-format="yyyy/M/d/H/m/s"
											align="left"
											unlink-panels
											range-separator="至"
											start-placeholder="开始日期"
											end-placeholder="结束日期"
											:picker-options="pickerOptionsRange"></el-date-picker>
											<!-- 无法识别类型 -->
											<el-input v-else disabled >无法识别的搜索类型，请联系管理员</el-input disabled >
										</el-tooltip>
										<br>
									</el-form-item>
									<el-form-item 
									label="数据新增时间"
									:key="dataCreate.key"
									size="mini"
									style="width: 49%;display: inline-block;">
										<!-- 单个时间类型：用时间范围元素承载 -->
										<el-date-picker
										v-model="dataCreate.value"
										type="datetimerange"
										format="yyyy/MM/dd HH:mm:ss"
										value-format="yyyy-MM-dd HH:mm:ss"
										align="left"
										unlink-panels
										range-separator="至"
										start-placeholder="开始日期"
										end-placeholder="结束日期"
										:picker-options="pickerOptionsRange"></el-date-picker>
									</el-form-item>
									<el-form-item 
									label="数据更新时间"
									:key="dataUpdate.key"
									size="mini"
									style="width: 50%;display: inline-block;">
										<!-- 单个时间类型：用时间范围元素承载 -->
										<el-date-picker
										v-model="dataUpdate.value"
										type="datetimerange"
										format="yyyy/MM/dd HH:mm:ss"
										value-format="yyyy-MM-dd HH:mm:ss"
										align="left"
										unlink-panels
										range-separator="至"
										start-placeholder="开始日期"
										end-placeholder="结束日期"
										:picker-options="pickerOptionsRange"></el-date-picker>
									</el-form-item>
								</el-card>
							</div>
						</template>
						<el-divider><span style="color: orangered;">两种搜索取并集</span></el-divider>
						<div style="text-align: center;">
							<el-button type="primary" size="mini"  @click="search">开始搜索</el-button>
							<el-button type="primary" size="mini"  @click="resetSearch(now_ctrr_rsrm_id_l2)">重置</el-button>
						</div>
					</el-form>
				</div>
			</el-tab-pane>
		</el-tabs>

		<el-card class="box-card" v-loading="tableLoading" :show-header="isShowThisPage" style="border:none">
			<div style="float: left;">
				<div slot="header" class="clearfix">
					<div v-show="isShowThisPage">
						<div>
							<el-tooltip>
								<div slot="content">获取当前表格待跟进数据</div>
								<el-button type="primary" size="mini" @click="handlGetincompletedData">待跟进</el-button>
							</el-tooltip>
							<el-button style="float: right;" type="success" size="mini" @click="handleGetLatelyAdd('thisMonth')">最近一月新增</el-button>
							<el-button style="float: right;" type="success" size="mini" @click="handleGetLatelyAdd('thisWeek')">最近一周新增</el-button>
							<el-button style="float: right;" type="success" size="mini" @click="handleGetLatelyAdd('today')">最近一日新增</el-button style="float: right;">
						</div>
						<el-divider></el-divider>
						<el-tooltip>
							<div slot="content">可以直接输入搜索</div>
							<div>
								<span>（切换表格将默认加载待办数据）</span>
								<el-cascader 
								v-model="cascaderDataDefault"
								:options="cascaderData" 
								:props="defaultCascaderProps"
								filterable
								:show-all-levels="false"
								@change="handleCascaderChange"
								size="mini"
								style="float: left;"></el-cascader>
							</div>
						</el-tooltip>
						<el-button v-show="isShowThisPage" style="float: right;margin-right: 15px;" type="primary" size="mini" @click="handlExportFile">导出</el-button>
					</div>
				</div>
				<template>
					{if condition="$adminInfo.admin_account == 'kwh'"}
					<el-tooltip>
						<div slot="content">点击显示/隐藏其他功能</div>
						<span @click="isShowThisPage = !isShowThisPage" style="cursor: pointer;color:#75cefd;">政企其他故障</span>
					</el-tooltip>
					{/if}
					<el-card class="box-card" v-show="tempDataShow">
						<div slot="header" class="clearfix">
							<span>最近一次编辑的数据</span>
							<el-button style="float: right; padding: 3px 0" type="text" @click="tempDataShow = false">不需要了，关闭</el-button>
						</div>
						<div style="height: 200px;overflow: scroll;">
							<el-alert title="刚刚您编辑的数据已被其他同事修改了，目前已帮您获取了最新数据，同时已将您刚刚编辑的数据临时保存在这里了，直接复制粘贴回去即可" :closable="false" type="warning" style="margin-bottom: 10px;"></el-alert>
							<div v-for="o in tableKey" :key="o" class="text item">
								{{ o.label + '：' + (tempData[o.key] || '')}}
							</div>
						</div>
					</el-card>
					<el-table
					ref="multipleTable"
					v-loading="tableLoading"
					:show-header="isShowThisPage"
					:data="tableData"
					max-height="800"
					cell-style="padding:5px 0;background: #fafafa;"
					border>
						<el-table-column type="expand" v-if="isShowThisPage">
							<template slot-scope="props">
								<el-form label-position="left" inline class="tableData-expand">
									<el-form-item 
										v-for="(value,index) in tableKey"
										label-class-name="labelStyle"
										:label="tableKey[index].label"
										:error="errFieldMsg[props.$index + '_' + tableKey[index].key]"
										:prop="tableKey[index].key">
										<el-tooltip :disabled="tableKey[index].ctrr_rsrm_tips ? false: true">
											<div slot="content">{{tableKey[index].ctrr_rsrm_tips}}</div>
											<!-- 文本类型 -->
											<el-input
											v-if="levelThree[tableKey[index].key].ctrr_rsrm_type == 1"
											type="textarea"
											size="mini" 
											v-model="props.row[tableKey[index].key]" 
											placeholder="请输入内容" 
											@change="handleEdit(props, tableKey[index], props.row[tableKey[index].key])"
											:show-word-limit="true"
											:rows="1"></el-input> 
											<!-- 开关类型 -->
											<el-switch
											v-else-if="levelThree[tableKey[index].key].ctrr_rsrm_type == 2"
											size="mini" 
											v-model="props.row[tableKey[index].key]" 
											:active-text="levelThree[tableKey[index].key].ctrr_rsrm_valueFortype[0]"
											:inactive-text="levelThree[tableKey[index].key].ctrr_rsrm_valueFortype[1]"
											:active-value="levelThree[tableKey[index].key].ctrr_rsrm_valueFortype[0]"
											:inactive-value="levelThree[tableKey[index].key].ctrr_rsrm_valueFortype[1]"
											@change="handleEdit(props, tableKey[index], props.row[tableKey[index].key])"></el-switch> 
											<!-- 下拉框类型 -->
											<el-select
											v-else-if="levelThree[tableKey[index].key].ctrr_rsrm_type == 3"
											v-model="props.row[tableKey[index].key]"
											placeholder="请选择"
											size="mini" 
											@change="handleEdit(props, tableKey[index], props.row[tableKey[index].key])">
												<el-option></el-option>
												<el-option
												v-for="i in levelThree[tableKey[index].key].ctrr_rsrm_valueFortype"
												:key="i"
												:label="i"
												:value="i"></el-option>
											</el-select>
											<!-- 时间选择器类型 -->
											<el-date-picker
											v-else-if="levelThree[tableKey[index].key].ctrr_rsrm_type == 6"
											type="datetime"
											format="yyyy/MM/dd HH:mm:ss"
											size="mini" 
											value-format="yyyy/MM/dd HH:mm:ss"
											placeholder="选择日期时间"
											align="left"
											:picker-options="pickerOptions"
											v-model="props.row[tableKey[index].key]"
											@change="handleEdit(props, tableKey[index], props.row[tableKey[index].key])"></el-date-picker>
											<!-- 无法识别类型 -->
											<el-input v-else disabled >无法识别的搜索类型，请联系管理员</el-input disabled >
										</el-tooltip>
									</el-form-item>
								</el-form>
							</template>
						</el-table-column>
						<el-table-column
							:resizable="false"
							label-class-name="labelStyle"
							label="标星"
							prop="star_state"
							width="50px"
							header-align="center"
							align="center"
							show-overflow-tooltip>
							<template slot-scope="props">
								<el-tooltip>
									<div slot="content">标星</div>
									<el-span
									v-if="props.row.star_state === 0"
									class="el-icon-star-off"
									style="font-size:25px;cursor: pointer;"
									@click="handleEdit(props,'star_state', 1)"></el-span>
									<el-span
									v-else class="el-icon-star-on"
									style="font-size:30px;color:#ff9900;cursor: pointer;"
									@click="handleEdit(props,'star_state', 0)"></el-span>
								</el-tooltip>
							</template>
						</el-table-column>
						<el-table-column
							:resizable="false"
							label-class-name="labelStyle"
							label="红旗"
							prop="flag_state"
							width="50px"
							header-align="center"
							align="center"
							show-overflow-tooltip>
							<template slot-scope="props">
								<el-tooltip>
									<div slot="content">红旗</div>
									<el-span
									v-if="props.row.flag_state === 0"
									class="el-icon-s-flag"
									style="font-size:25px;cursor: pointer;"
									@click="handleEdit(props,'flag_state', 1)"></el-span>
									<el-span
									v-else class="el-icon-s-flag"
									style="font-size:25px;color:#ff0c00fa;cursor: pointer;"
									@click="handleEdit(props,'flag_state', 0)"></el-span>
								</el-tooltip>
							</template>
						</el-table-column>
						<el-table-column
							v-for="i in columNum"
							:resizable="false"
							v-if="tableKey[i-1].label === '工单号'"
							label-class-name="labelStyle"
							:label="tableKey[i-1].label"
							:prop="tableKey[i-1].key"
							width="180px"
							header-align="center"
							show-overflow-tooltip>
							<template slot-scope="props">
								<el-form label-position="left"class="tableData-expand">
									<el-form-item :prop="tableKey[i-1].key"style="width:100%">
										<el-tooltip :disabled="tableKey[i-1].ctrr_rsrm_tips ? false: true">
											<div slot="content">{{tableKey[i-1].ctrr_rsrm_tips}}</div>
												<el-input
												type="textarea"
												:rows="1"
												size="mini" 
												v-model="props.row[tableKey[i-1].key]" 
												placeholder="请输入内容" 
												@change="handleEdit(props, tableKey[i-1], props.row[tableKey[i-1].key])"
												:show-word-limit="true"
												></el-input> 
										</el-tooltip>
									</el-form-item>
								</el-form>
							</template>
						</el-table-column>
						<el-table-column
							v-for="i in columNum"
							:resizable="false"
							v-if="tableKey[i-1].label === '结束时间（督办获取）'"
							label-class-name="labelStyle"
							:label="tableKey[i-1].label"
							:prop="tableKey[i-1].key"
							width="170px"
							header-align="center"
							show-overflow-tooltip>
							<template slot-scope="props">						
								<el-form label-position="left"class="tableData-expand">
									<el-form-item 
										:prop="tableKey[i-1].key"style="width:100%">
										<el-tooltip :disabled="tableKey[i-1].ctrr_rsrm_tips ? false: true">
											<div slot="content">{{tableKey[i-1].ctrr_rsrm_tips}}</div>
											<el-date-picker
											type="datetime"
											format="M月d日 H:mm"											size="mini" 
											value-format="yyyy/MM/dd HH:mm:ss"
											placeholder="选择日期时间"
											align="left"
											:picker-options="pickerOptions"
											v-model="props.row[tableKey[i-1].key]"
											@change="handleEdit(props, tableKey[i-1], props.row[tableKey[i-1].key])"
											style="width:100%"></el-date-picker>
										</el-tooltip>
									</el-form-item>
								</el-form>
							</template>
						</el-table-column>
						<el-table-column
							v-for="i in columNum"
							:resizable="false"
							v-if="tableKey[i-1].label === '开始时间'"
							label-class-name="labelStyle"
							:label="tableKey[i-1].label"
							:prop="tableKey[i-1].key"
							width="170px"
							header-align="center"
							show-overflow-tooltip>
							<template slot-scope="props">
								<el-form label-position="left"class="tableData-expand">
									<el-form-item 
										:prop="tableKey[i-1].key"style="width:100%">
										<el-tooltip :disabled="tableKey[i-1].ctrr_rsrm_tips ? false: true">
											<div slot="content">{{tableKey[i-1].ctrr_rsrm_tips}}</div>
											<el-date-picker
											type="datetime"
											format="M月d日 H:mm"											size="mini" 
											value-format="yyyy/MM/dd HH:mm:ss"
											placeholder="选择日期时间"
											align="left"
											:picker-options="pickerOptions"
											v-model="props.row[tableKey[i-1].key]"
											@change="handleEdit(props, tableKey[i-1], props.row[tableKey[i-1].key])"
											style="width:100%"></el-date-picker>
										</el-tooltip>
									</el-form-item>
								</el-form>
							</template>
						</el-table-column>
						<el-table-column
							v-for="i in columNum"
							:resizable="false"
							v-if="tableKey[i-1].label === '故障描述'"
							label-class-name="labelStyle"
							:label="tableKey[i-1].label"
							:prop="tableKey[i-1].key"
							width="240px"
							header-align="center"
							show-overflow-tooltip>
							<template slot-scope="props">
								<el-form label-position="left"class="tableData-expand">
									<el-form-item 
										:prop="tableKey[i-1].key"style="width:100%">
										<el-tooltip :disabled="tableKey[i-1].ctrr_rsrm_tips ? false: true">
											<div slot="content">{{tableKey[i-1].ctrr_rsrm_tips}}</div>
												<el-input
												type="textarea"
												:rows="3"
												size="mini" 
												v-model="props.row[tableKey[i-1].key]" 
												placeholder="请输入内容" 
												@change="handleEdit(props, tableKey[i-1], props.row[tableKey[i-1].key])"
												:show-word-limit="true"
												></el-input> 
										</el-tooltip>
									</el-form-item>
								</el-form>
							</template>
						</el-table-column>
						<el-table-column
							v-for="i in columNum"
							:resizable="false"
							v-if="tableKey[i-1].label === '故障原因（督办获取）'"							
							label-class-name="labelStyle"
							:label="tableKey[i-1].label"
							:prop="tableKey[i-1].key"
							width="240px"
							header-align="center"
							show-overflow-tooltip>
							<template slot-scope="props">
								<el-form label-position="left" class="tableData-expand">
									<el-form-item 
										:prop="tableKey[i-1].key"style="width:100%">
										<el-tooltip :disabled="tableKey[i-1].ctrr_rsrm_tips ? false: true">
											<div slot="content">{{tableKey[i-1].ctrr_rsrm_tips}}</div>
												<el-input
												type="textarea"
												:rows="3"
												size="mini" 
												v-model="props.row[tableKey[i-1].key]" 
												placeholder="请输入内容" 
												@change="handleEdit(props, tableKey[i-1], props.row[tableKey[i-1].key])"
												:show-word-limit="true"
												></el-input> 
										</el-tooltip>
									</el-form-item>
								</el-form>
							</template>
						</el-table-column>
						<el-table-column
							v-for="i in columNum"
							:resizable="false"
							v-if="tableKey[i-1].label === '处理进展（督办获取）'"							
							label-class-name="labelStyle"
							:label="tableKey[i-1].label"
							:prop="tableKey[i-1].key"
							width="240px"
							header-align="center"
							show-overflow-tooltip>
							<template slot-scope="props">
								<el-form label-position="left"class="tableData-expand">
									<el-form-item 
										:prop="tableKey[i-1].key"style="width:100%">
										<el-tooltip :disabled="tableKey[i-1].ctrr_rsrm_tips ? false: true">
											<div slot="content">{{tableKey[i-1].ctrr_rsrm_tips}}</div>
												<el-input
												type="textarea"
												:rows="3"
												size="mini" 
												v-model="props.row[tableKey[i-1].key]" 
												placeholder="请输入内容" 
												@change="handleEdit(props, tableKey[i-1], props.row[tableKey[i-1].key])"
												:show-word-limit="true"
												></el-input> 
										</el-tooltip>
									</el-form-item>
								</el-form>
							</template>
						</el-table-column>
					</el-table>
					<div v-show="isShowThisPage" class="block" style="padding-top: 20px;">
						<el-pagination
						@size-change="handleSizeChange"
						@current-change="handleCurrentChange"
						:current-page="pagination.currentPage"
						:page-sizes="pagination.pageSizeArr"
						:page-size="pagination.pageSize"
						layout="total, sizes, prev, pager, next, jumper"
						:total="pagination.total">
						</el-pagination>
					</div>
				</template>
			</div>
		</el-card>
	</div>

	<blockquote class="layui-elem-quote" style="margin:15px">
		<p>- 本看板作为当班次所跟进故障的统一管理模块，直观呈现当班故障最关键的信息、实时向班组全员公布跟进到的最新进展、作为故障管控信息的记录依据、故障关键信息可反向同步至工单登记信息；</p>
	</blockquote>
</div>
<script>
	{
		/**
		 * ITMC光缆故障 
		**/
		// 对于已经创建的实例，Vue 不允许动态添加根级别的响应式 property。
		// 所以所有响应式的数据最好是提前加载出来，否则后面要新增一个相应级别的数据会有点麻烦
		let levelOneList = {:json_encode($levelOneList)}; // 构造1级分类json数据
		// 本次即将获得处理的初始表格
		let levelOneListItem = levelOneList[0].children[0]
		let levelTwoList = {}; // 构造2级表格json数据
		let levelThree = {} // 构造3级字段json数据
		let tableDataBySQL = {:json_encode($tableDataBySQL)};
		let pagination = {:json_encode($pagination)};
		for(let i=0; i<levelOneList.length; i++){
			for(let j=0; j<levelOneList[i].children.length; j++){
				levelTwoList[levelOneList[i].children[j].ctrr_rsrm_id] = levelOneList[i].children[j]
				for(let z=0; z<levelOneList[i].children[j].children.length; z++){
					levelThree[levelOneList[i].children[j].children[z].ctrr_rsrm_id] = levelOneList[i].children[j].children[z]
				}
			}
		}
		// 初始化tableData数据
		// 默认加载第一张二级表的数据
		// lastTableData 保存上一次table数据，用于冲突检测
		// errFieldMsg 构造字段检测错误信息，用于返回字段校验信息
		let tableData = []
		let lastTableData = []
		let errFieldMsg = {}
		for(let i = 0; i < tableDataBySQL.length; i++){
			tableDataBySQL[i].ctrr_rsrmD_data = tableDataBySQL[i].ctrr_rsrmD_data.replace(/\n/g,"\\\\n").replace(/\r/g,"\\r")
			tableData.push(JSON.parse(tableDataBySQL[i].ctrr_rsrmD_data))
			lastTableData.push(JSON.parse(tableDataBySQL[i].ctrr_rsrmD_data))
			// 将缺失的三级字段补充回去
			for(let j = 0; j < levelOneListItem.children.length; j++){
				let ctrr_rsrm_idForKey = levelOneListItem.children[j].ctrr_rsrm_id
				if(!tableData[i].hasOwnProperty(ctrr_rsrm_idForKey)){
					tableData[i][ctrr_rsrm_idForKey] = ''
				}
				// 格式为：i：数据处于第几行  ctrr_rsrm_idForKey：字段id
				errFieldMsg[i + '_' + ctrr_rsrm_idForKey] = ''
			}
			tableData[i]['ctrr_rsrmD_id'] = tableDataBySQL[i].ctrr_rsrmD_id
			tableData[i]['star_state'] = tableDataBySQL[i].star_state
			tableData[i]['flag_state'] = tableDataBySQL[i].flag_state
		}
		let treeForImportData = [] // 导入excel的树形组件选择器
		// 初始化动态加载每一张二级表用于搜索的form数据
		// 注：为了减少http请求，table表格中的字段是根据formJson进行动态加载的，
		// 因此如果后续要减少搜索项，只需要在显示的时候隐藏搜索项即可，以避免影响table表格的价值
		let l2_to_l3_allFiled = {}//保存1~3级所有字段数据
		let formJson = {
						// 格式
						// L2的ctrr_rsrm_id:{
						// 	L3的ctrr_rsrm_id: L3字段的value
						// }
					}
		// 构造 l2_to_l3_allFiled 与 formJson 
		for(let i = 0; i < levelOneList.length; i++){
			const levelTwoList = levelOneList[i].children;
			const treeForImportData_item = {
				ctrr_rsrm_id: levelOneList[i].ctrr_rsrm_id,
				ctrr_rsrm_name: levelOneList[i].ctrr_rsrm_name,
				children:[],
				index:i
			}
			for(let j = 0; j < levelTwoList.length; j++){
				const levelThreeList = levelTwoList[j].children;
				let l2_to_l3_allFiled_item = {}
				let formJson_item = {}
				const treeForImportData_item_item = {
					ctrr_rsrm_id: levelTwoList[j].ctrr_rsrm_id,
					ctrr_rsrm_name: levelTwoList[j].ctrr_rsrm_name,
					index:j
				}
				treeForImportData_item['children'].push(treeForImportData_item_item)
				for(let z = 0; z < levelThreeList.length; z++){
					if(levelThreeList[z].ctrr_rsrm_type !== 1){
						formJson_item[levelThreeList[z].ctrr_rsrm_id] = levelThreeList[z]
						formJson_item[levelThreeList[z].ctrr_rsrm_id]['value'] = ''
					}
					l2_to_l3_allFiled_item[levelThreeList[z].ctrr_rsrm_id] = levelThreeList[z]
					l2_to_l3_allFiled_item[levelThreeList[z].ctrr_rsrm_id]['value'] = ''
					l2_to_l3_allFiled_item[levelThreeList[z].ctrr_rsrm_id]['errMsg'] = '' // 字段错误提示
				}
				l2_to_l3_allFiled[levelTwoList[j].ctrr_rsrm_id] = l2_to_l3_allFiled_item
				formJson[levelTwoList[j].ctrr_rsrm_id] = formJson_item
				// formJson[levelTwoList[j].ctrr_rsrm_id]['searchKeyWords'] = ''
			}
			treeForImportData.push(treeForImportData_item)
		}
		// 初始化加载tableKey，用于构造table表格列的结构
		let tableKey = []
		for(let i = 0; i < levelOneListItem.children.length; i++){
			tableKey.push({
				key:levelOneListItem.children[i].ctrr_rsrm_id.toString(),
				label:levelOneListItem.children[i].ctrr_rsrm_name,
				ctrr_rsrm_tips:levelOneListItem.children[i].ctrr_rsrm_tips,
				ctrr_rsrm_is_needed:levelOneListItem.children[i].ctrr_rsrm_is_needed,
				ctrr_rsrm_is_key: levelOneListItem.children[i].ctrr_rsrm_is_key
			})
		}
		let app = new Vue({
			el: '#app0',
			data() {
				return {
					/**
					 * 为便于快速开发以及后期维护，本模块直接采用连续复刻值班信息模块的方式实现，
					 * 既将值班信息模块复制四次，所有代码尽量保留，前端不要的功能只需隐藏，不做过多变动
					 **/
					isShowThisPage: false, 

					levelOneList: levelOneList,
					levelTwoList: levelTwoList,
					levelThree: levelThree,
					columNum: levelOneListItem.children.length, // 既三级字段个数
					SearchPanelBtn: false,
					AddBtn: false,
					tabsLoading: false, // 切换标签的loading
					dateFormatReg: /^\d{2,4}\/\d{2}\/\d{2}\s\d{2}\:\d{2}\:\d{2}/, // 匹配时间格式： yyyy/MM/dd HH:mm:ss
					tabsLoadingTxt: 'loading...',// 使用切换标签loading时候的文字提示
					tableLoading: false, // 数据表格面板loading
					l2_to_l3_allFiled: l2_to_l3_allFiled,// 1~3级字段所有数据
					formJson: formJson,
					formAddJson: JSON.parse(JSON.stringify(l2_to_l3_allFiled)),//由于js本身的拷贝机制，导致如果直接给this.formAddJson赋值formJson会使得this.formJson与this.formAddJson底层数据相互影响，因此这里用深拷贝的方式将数据拷贝一份
					// DateTimePicker 日期时间选择器数据
					// 单个时间
					pickerOptions: {
						shortcuts: [{
							text: '今天',
							onClick(picker) {
							picker.$emit('pick', new Date());
							}
						}, {
							text: '昨天',
							onClick(picker) {
							const date = new Date();
							date.setTime(date.getTime() - 3600 * 1000 * 24);
							picker.$emit('pick', date);
							}
						}, {
							text: '一周前',
							onClick(picker) {
							const date = new Date();
							date.setTime(date.getTime() - 3600 * 1000 * 24 * 7);
							picker.$emit('pick', date);
							}
						}]
					},
					// 时间范围
					pickerOptionsRange: {
						shortcuts: [{
							text: '最近一周',
							onClick(picker) {
								const end = new Date();
								const start = new Date();
								start.setTime(start.getTime() - 3600 * 1000 * 24 * 7);
								picker.$emit('pick', [start, end]);
							}
						}, {
							text: '最近一个月',
							onClick(picker) {
								const end = new Date();
								const start = new Date();
								start.setTime(start.getTime() - 3600 * 1000 * 24 * 30);
								picker.$emit('pick', [start, end]);
							}
						}, {
							text: '最近三个月',
							onClick(picker) {
								const end = new Date();
								const start = new Date();
								start.setTime(start.getTime() - 3600 * 1000 * 24 * 90);
								picker.$emit('pick', [start, end]);
							}
						}]
					},
					// 字段校验规则的错误信息
					errFieldMsg: errFieldMsg,
					tableKey: tableKey,
					tableData: tableData,
					// 用于search()方法
					searchKeyWords: {
						label: '多个关键词请用“@”符号隔开，如：张三@广西，无需考虑顺序',
						tips: '关键词搜索会对全表进行全量搜索，无需区分字段',
						key: 'searchKeyWords',
						value: ''// 搜索关键词字符串
					}, 
					dataCreate:{
						key: 'create_time',
						value: ''
					},
					dataUpdate:{
						key: 'update_time',
						value: ''
					},
					levelOneList_index: 0,// 当前显示数据的一级表数据索引
					levelTwoList_index: 0,// 当前显示数据的二级表数据索引
					now_ctrr_rsrm_id_l2: levelOneListItem.ctrr_rsrm_id,// 当前显示数据的二级表id
					pagination: pagination,
					
					lastTableData:JSON.parse(JSON.stringify(lastTableData)),//保留上一次table数据，用于冲突检测
					// 临时保存用户最近一次编辑的数据，一般用于在冲突检测发生冲突之后，将用户数据保存在一个临时容器中
					tempDataShow: false,
					tempData: '', 
					treeForImportData: treeForImportData, // 树形组件数据
					cascaderData: treeForImportData, // 级联组件数据
					cascaderDataDefault: [treeForImportData[0].index, treeForImportData[0].children[0].index], // 级联组件数据第一次加载时的默认值
					defaultImportTreeProps: { // 树形组件属性自定义
						// children: 'children',
						label: 'ctrr_rsrm_name',
						disabled: 'disableTreeCheckout'
					},
					defaultCascaderProps: { // 级联组件属性自定义
						// children: 'children',
						label: 'ctrr_rsrm_name',
						value: 'index'
					},
					keyForImport:[], //保存导入excel的key

					// 用于生成大值班
					dutySummaryTimeRange:'', // 大值班总结时间范围搜索条件
					dutySummary:{
						head:'', // 总结信息
						incompletedData:'', // 待跟进故障
						completedData:'', // 已消除故障
					}, 
					// 大值班总结数据
					// 错误报告——初步设计为仅含不可忽略错误
					errorReport: {},
					isShowErrorReportDrawer: false, // 错误报告抽屉显示
				}
			},
			methods: {
				// 切换级联菜单时触发加载数据
				handleCascaderChange(indexArr){
					const _this = this
					_this.levelOneList_index = indexArr[0]
					_this.levelTwoList_index = indexArr[1]	
					// 切换页面的时候要将原搜索数据置空
					_this.resetSearch(_this.now_ctrr_rsrm_id_l2)
					_this.now_ctrr_rsrm_id_l2 = levelOneList[indexArr[0]].children[indexArr[1]].ctrr_rsrm_id
					_this.search()
				},
				search() {
					const _this = this
					_this.tabsLoading = true;
					// 深拷贝
					let searchFormPre = JSON.parse(JSON.stringify(_this.formJson[_this.now_ctrr_rsrm_id_l2]));

					let searchKeyWordsJson = {
						// 'AND'  用于交集搜索
						// 'OR'   用于并集搜索（目前不仅适用于其他的搜索内容还可以用于解决ctrr_rsrmD_data字段的时间范围搜索的问题）
						// 'other'   用于搜索 create_time 与 update_time
					}
					searchKeyWordsJson.ADN = _this.searchKeyWords.value.split('@')
					searchKeyWordsJson.OR = []
					searchKeyWordsJson.other = {
						create_time: _this.dataCreate.value,
						update_time: _this.dataUpdate.value
					}
					// 删除数组中的空元素
					for(let i = 0; i < searchKeyWordsJson.ADN.length; i++){
						if(searchKeyWordsJson.ADN[i] == ''){
							searchKeyWordsJson.ADN.splice(i, 1)
							i--;
						}
					}

					for(let key in searchFormPre){
						if(searchFormPre[key].value != '' && searchFormPre[key].value != undefined){
							if(searchFormPre[key].ctrr_rsrm_type == 6){
								/*  
									对时间类型字段进行进一步处理
									date-picker 中已将value-format格式设置为"yyyy/M/d/H/m/s"
									因此，处理该字符串变得十分简单，规则为：
									1.由于数据表的数据结构特殊因此无法用常规的时间比对方式进行时间条件搜索，因此只能将时间范围按年、月、天、时、分秒拆开进行一个个的模糊搜索
									2.数据格式规定为2020/6/1 
									注：十年之内的搜索条件最多不会超过225个
								*/
								let arr = _this.hangdleStart_end_time(searchFormPre[key].value[0], searchFormPre[key].value[1], searchFormPre[key].ctrr_rsrm_id)
								searchKeyWordsJson.OR = searchKeyWordsJson.OR.concat(arr)
							}else{
								searchKeyWordsJson.ADN.push(searchFormPre[key].ctrr_rsrm_id+'":"'+ searchFormPre[key].value)
							}
						}
					}
					const data = {
						ctrr_rsrm_id_l2: _this.now_ctrr_rsrm_id_l2,
						getNextLevelData: 1,
						searchKeyWordsJson: searchKeyWordsJson,
						pagination: _this.pagination
						// get有长度限制，所以下面用post请求，有趣的是居然可以接收多级json的请求参数
					}
					$.ajax({
						type:'POST'
						,data:data
						,url:'cmccFaultPanel'
						,success:function(res){
							// 搜索成功
							_this.tabsLoading = false;
							let tableData = res.tableData;
							_this.pagination = res.pagination;
							// 将返回数据处理成tableData所需的数据格式
							_this.tableData = []
							_this.errFieldMsg = {}
							// 加载table
							const levelThreeList = levelOneList[_this.levelOneList_index].children[_this.levelTwoList_index].children
							_this.lastTableData = []
							for(let i = 0; i < tableData.length; i++){
								// JSON.parse 解析json字符串时，遇换行符报错用.replace(/\n/g,"\\\\n").replace(/\r/g,"\\r")将换行符替代掉
								_this.tableData.push(JSON.parse(tableData[i].ctrr_rsrmD_data.replace(/\n/g,"\\\\n").replace(/\r/g,"\\r")))
								// 刷新用于冲突检测的 lasttabledata 数据
								_this.lastTableData.push(JSON.parse(tableData[i].ctrr_rsrmD_data.replace(/\n/g,"\\\\n").replace(/\r/g,"\\r")))
								// 补充缺失的三级字段
								// 将缺失的三级字段补充回去
								let levelOneList = _this.levelOneList
								for(let j = 0; j < levelThreeList.length; j++){
									const ctrr_rsrm_idForKey = levelThreeList[j].ctrr_rsrm_id
									if(!_this.tableData[i].hasOwnProperty(ctrr_rsrm_idForKey)){
										// 重设tableData数组响应式
										_this.$set(_this.tableData[i], ctrr_rsrm_idForKey, '')
									}
									// 重设errFieldMsg对象响应式
									_this.$set(_this.errFieldMsg, i + '_' + ctrr_rsrm_idForKey, '')
								}
								_this.tableData[i]['ctrr_rsrmD_id'] = tableData[i].ctrr_rsrmD_id
								_this.tableData[i]['star_state'] = tableData[i].star_state
								_this.tableData[i]['flag_state'] = tableData[i].flag_state
							}
							
							// _this.$refs.multipleTable.doLayout();
							// 加载tableKey，用于构造table表格列的结构
							let tableKey = []
							let levelTwoList = levelOneList[_this.levelOneList_index].children[_this.levelTwoList_index].children

							for(let i = 0; i < levelTwoList.length; i++){
								tableKey.push({
									key:levelTwoList[i].ctrr_rsrm_id.toString(),
									label:levelTwoList[i].ctrr_rsrm_name,
									ctrr_rsrm_tips:levelTwoList[i].ctrr_rsrm_tips,
									ctrr_rsrm_is_needed:levelTwoList[i].ctrr_rsrm_is_needed,
									ctrr_rsrm_is_key: levelTwoList[i].ctrr_rsrm_is_key
								})
							}
							// 列数不足时会报错，这里做一下处理，列数不足初始设计时，将列数等于所获取的数据的列数
							(_this.columNum <= tableKey.length) || (_this.columNum = tableKey.length)
							_this.tableKey = tableKey
							if(tableData.length === 0){
								// 此处才判断是否存在数据的原因是希望无论是否有无数据都至少把table的表格model先加载出来
								// 这样在第一次新增数据的时候才能正常实现数据响应式
								showTs(1,'暂无数据',500)
							} else {
								showTs(1,'加载成功',500)
							}
						},
						error:function(e){
							showTs(0, '服务器错误，请联系管理查看控制台报错信息', 5000)
							console.log('【服务器错误】：' + e)
						}
					})
				},
				// 快捷搜索，获取最近新增数据
				handleGetLatelyAdd(timeRange){
					const _this = this
					const end = new Date();
					const start = new Date();
					switch(timeRange){
						case 'today':
							start.setTime(start.getTime() - 3600 * 1000 * 24 );
							break
						case 'thisWeek':
							start.setTime(start.getTime() - 3600 * 1000 * 24 * 7);
							break
						case 'thisMonth':
							start.setTime(start.getTime() - 3600 * 1000 * 24 * 30);
							break
						default:
							break
					}
					let sy = start.getFullYear()
					let sm = ( start.getMonth() + 1 > 9 ? start.getMonth() + 1 : '0' + (start.getMonth() + 1) )
					let sd = ( start.getDate()  > 9 ? start.getDate()  : '0' + (start.getDate() ) )
					let sh = ( start.getHours()  > 9 ? start.getHours()  : '0' + (start.getHours() ) )
					let smin = ( start.getMinutes()  > 9 ? start.getMinutes()  : '0' + (start.getMinutes() ) )
					let ss =  ( start.getSeconds()  > 9 ? start.getSeconds()  : '0' + (start.getSeconds() ) )
					let startStr = sy + '-' + sm + '-' + sd + ' ' + sh + ':' + smin + ':' + ss
					let ey = end.getFullYear()
					let em = ( end.getMonth() + 1 > 9 ? end.getMonth() + 1 : '0' + (end.getMonth() + 1) )
					let ed = ( end.getDate()  > 9 ? end.getDate()  : '0' + (end.getDate() ) )
					let eh = ( end.getHours()  > 9 ? end.getHours()  : '0' + (end.getHours() ) )
					let emin = ( end.getMinutes()  > 9 ? end.getMinutes()  : '0' + (end.getMinutes() ) )
					let es =  ( end.getSeconds()  > 9 ? end.getSeconds()  : '0' + (end.getSeconds() ) )
					let endStr = ey + '-' + em + '-' + ed + ' ' + eh + ':' + emin + ':' + es
					_this.dataCreate.value = [startStr, endStr]
					_this.search()
				},
				resetSearch(ctrr_rsrm_id_l2){
					const _this = this;
					// 重置formJson
					for(let key in _this.formJson[ctrr_rsrm_id_l2]){
						_this.formJson[ctrr_rsrm_id_l2][key].value = ''
					}
					// 重置searchKeyWords
					_this.searchKeyWords.value = '';
					// 重置dataCreate
					_this.dataCreate.value = '';
					// 重置dataUpdate
					_this.dataUpdate.value = '';
				},
				handleEdit(props, fieldConstructure, fieldVal){
					// fieldConstructure 字段结构
					// fieldVal 字段值
					const _this = this;
					const row = JSON.parse(JSON.stringify(props.row)) // 行数据 如果这里不深拷贝一下，下面【去掉空格】的处理将会影响表格的数据响应式效果
					const index = props.$index // 行数据索引
					let keyData = ''
					let star_state = ''
					let flag_state = ''
					let data = {}
					let isNeededKey; // 保存必填字段的id
					let jsonData = JSON.parse(JSON.stringify(row)) // 暂存行数据
					if (fieldConstructure !== 'star_state' && fieldConstructure !== 'flag_state') {
						this.errFieldMsg[index + '_' + fieldConstructure.key] = ""
						// 检测用户是否还存在未处理的错误字段
						for (const k in this.errFieldMsg) {
							if (this.errFieldMsg[k] !== '') {
								app.$notify({
									title: '操作失败',
									message: '请先修改已存在的错误提示',
									type: 'error',
									duration: 3000
								})
								return
							}
						}

						// 禁止字段传入特殊值
						if (fieldVal === false 
							|| (typeof(fieldVal) === "number" && isNaN(fieldVal))) {
							this.errFieldMsg[index + '_' + fieldConstructure.key] = "请勿输入特殊值字符！"
							showTs(0, '请勿输入特殊值字符', 3000)
							return
						}
						// 传入值与null/undefined有关系的时候
						if (
							fieldVal === undefined || fieldVal === null ||
							// 输入字符串时候，判断字符串中是否包含特殊字段
							(typeof(fieldVal) === "string" && 
							(fieldVal.indexOf('undefined') !== -1 || fieldVal.indexOf('null') !== -1))
						) 
						{
							/** 数据响应 **/
							fieldVal = ''
							props.row[fieldConstructure.key] = fieldVal
							row[fieldConstructure.key] = fieldVal
							/** 数据响应 **/
							this.errFieldMsg[index + '_' + fieldConstructure.key] = "undefined与null被转化为空值"
							showTs(0, 'undefined与null被转化为空值', 3000)
						}
						// 校验必填字段规则：trim()函数用于去掉字符串的头尾空格，除了可以判断一个空值的情况，还可用于判断多个纯空格的情况
						if (fieldVal.trim() === '' && fieldConstructure.ctrr_rsrm_is_needed) {
							showTs(0, '['+fieldConstructure.label + ']为必填字段，请重新编辑', 3000)
							this.errFieldMsg[index + '_' + fieldConstructure.key] = "必填字段不能为空"
							return
						}
						// 构造主键字段数据
						if (fieldConstructure.ctrr_rsrm_is_key !== 1) {
							// 如果当前编辑的不是主键字段，则遍历检测出数据中的主键字段
							for (let i = 0; i < _this.tableKey.length; i++) {
								if (_this.tableKey[i].ctrr_rsrm_is_key === 1) {
									isNeededKey = _this.tableKey[i].key
									if ( row[_this.tableKey[i].key] !== '' ) {
										keyData = '"'+ _this.tableKey[i].key+'":"' + row[_this.tableKey[i].key] + '"'
									}
									break //主键只有一个，if进入一次即可跳出整个循环
								}
							}
						} else if (fieldVal !== '') {
							// 如果当前编辑的就是主键字段且不为空，则直接构造参数
							isNeededKey = fieldConstructure.key
							keyData = '"'+fieldConstructure.key+'":"' + fieldVal + '"'
						}
						// 去掉所有空值
						for(let key in row){
							if(row[key] === ''){
								delete row[key]
							}
						}
						star_state = jsonData.star_state
						flag_state = jsonData.flag_state
					} else {
						if (fieldConstructure === 'star_state') {
							star_state = fieldVal
							props.row.star_state = star_state
							flag_state = props.row.flag_state
						} else if (fieldConstructure === 'flag_state') {
							flag_state = fieldVal
							props.row.flag_state = flag_state
							star_state = props.row.star_state
						}
					}
					
					const ctrr_rsrmD_id = jsonData.ctrr_rsrmD_id 
					//删掉ctrr_rsrmD_id，并构造json字符串用于数据库保存
					delete jsonData.ctrr_rsrmD_id;
					const ctrr_rsrmD_data = JSON.stringify(jsonData)
					//删掉ctrr_rsrmD_id，并构造json字符串用于冲突检测
					let jsonLastData = JSON.parse(JSON.stringify(_this.lastTableData[index])) // 暂存行数据
					// 临时保存用户最近一次编辑的数据
					_this.tempData = JSON.parse(ctrr_rsrmD_data)
					delete jsonLastData.ctrr_rsrmD_id;
					const last_ctrr_rsrmD_data = JSON.stringify(jsonLastData)
					data = {
						ctrr_rsrmD_id: ctrr_rsrmD_id,
						ctrr_rsrmD_data: ctrr_rsrmD_data,
						star_state: star_state,
						flag_state: flag_state,
						last_ctrr_rsrmD_data: last_ctrr_rsrmD_data,
						// 主键字段
						keyData: keyData
					}
					$.ajax({
						type:"POST"
						,data: data
						,url:'editRotaSituationRecord'
						,success:function(res){
							const code = res.code
							const msg = res.msg
							if(code === 1){
								_this.$notify({
									title: '操作成功',
									message: msg,
									type: 'success',
									duration: 500
								})
								_this.lastTableData[index] = JSON.parse(JSON.stringify(row))
								_this.tempDataShow = false;
							} else if(code === -1){
								// 主键检测发现重复
								_this.$notify({
									title: '操作失败',
									message: msg,
									type: 'error'
								})
								_this.errFieldMsg[index + '_' + isNeededKey] = msg
							} else if(code === 0){
								_this.$notify({
									title: '操作失败，请刷新页面',
									message: msg,
									type: 'error'
								})
							} else{
								_this.$notify({
									title: '操作失败',
									message: '发生未知错误，请联系管理员',
									type: 'error',
									duration: 0
								})
								_this.tempDataShow = false;
							}
						}
					})
				},
				getTreeCheckedNodes(){
					const _this = this
					let keyForImport = []  // 导入excel时所需的key，分为两级第一级表名（对应excel中的sheet），第二级字段
					const checkedNodes = _this.$refs.treeForImportExcel.getCheckedNodes(true) // 选中的表格
					for(let i = 0; i < checkedNodes.length; i++){
						checkedNodes[i].children = _this.l2_to_l3_allFiled[checkedNodes[i].ctrr_rsrm_id]
						keyForImport.push(checkedNodes[i])
					}
					return keyForImport;
				},
				handlExportFile(tableData){
					// 导出excel
					const _this = this
					const excelKey = []
					const excelData = []
					for(let i = 0; i < _this.tableKey.length; i++ ){
						excelKey.push(_this.tableKey[i].label)
					}
					for(let i = 0; i < _this.tableData.length; i++ ){
						let arr = []
						for(let j = 0; j < _this.tableKey.length; j++ ){
							arr.push(_this.tableData[i][_this.tableKey[j].key] || '')
						}
						excelData.push(arr)
					}
					layui.use(['table'], function(){
						const table = layui.table
						let name = new Date()
						table.exportFile(excelKey, excelData, 'xls', name.toDateString()); //默认导出 xls
					})
				},
				handlImportFile(){
					const _this = this
					_this.$confirm('即将开始导入，请确保导入文件 < 1M 且数据不要与现有数据重复，数据比较多时，处理时间会比较久', '提示', {
						confirmButtonText: '确定',
						cancelButtonText: '取消',
						type: 'warning'
					}).then(() => {
						const keyForImport = _this.getTreeCheckedNodes()
						if(keyForImport.length === 0){
							showTs(0, '请选择需要导入的表格', 1000)
							return
						}
						_this.keyForImport = keyForImport
						$('#importdOneExcel').click()					
					}).catch(() => {
						showTs(1,'已取消',500)
					});
				},
				// 我要待跟进数据
				handlGetincompletedData(){
					const _this = this;
					_this.resetSearch(_this.now_ctrr_rsrm_id_l2)
					_this.search()
				},
				// 切换页签时
				handleSizeChange(pageSize) {
					const _this = this
					_this.pagination.pageSize = pageSize
					_this.search()
				},
				handleCurrentChange(currentPage) {
					const _this = this
					_this.pagination.currentPage = currentPage
					_this.search()
				},
				// 将开始时间和结束时间进行切割用于区间搜索
				hangdleStart_end_time(startdate, enddate, ctrr_rsrm_id=''){
					// startdate yyyy/M/d/H/m/s
					// enddate yyyy/M/d/H/m/s
					// ctrr_rsrm_id 字段id
					let arr = []
					startdate = startdate.split('/')
					enddate = enddate.split('/')

					// startdateStr,enddateStr用于拼接字符串
					let startdateStr = []
					let enddateStr = []
					// 字符串转数字类型
					for(let i = 0; i < startdate.length; i++){
						startdate[i] = Number(startdate[i])
						enddate[i] = Number(enddate[i])
						startdateStr[i] = startdate[i]
						enddateStr[i] = enddate[i]
						startdateStr[i] = startdate[i] > 9 ? startdate[i] : '0' + startdate[i]
						enddateStr[i] = enddate[i] > 9 ? enddate[i] : '0' + enddate[i]
					}
					function getYRange(startdate, enddate){
						if(startdate[0] != enddate[0]){
							for(let i = (startdate[0] + 1) ; i < enddate[0]; i++){
								arr.push(i)
							}
						}
					}
					function getMRange(startdate, enddate){
						if(startdate[0] == enddate[0]){
							for(let i = (startdate[1] + 1) ; i < enddate[1]; i++){
								const M = i > 9 ? i : '0' + i
								arr.push(ctrr_rsrm_id + '":"' + startdateStr[0] + '/' + M)
							}
						}else{
							for( let i = (startdate[1] + 1) ; i <= 12; i++ ){
								const M = i > 9 ? i : '0' + i
								arr.push(ctrr_rsrm_id + '":"' + startdateStr[0] + '/' + M)
							}
							for(let i = (enddate[1] - 1); i >= 1; i--){
								const M = i > 9 ? i : '0' + i
								arr.push(ctrr_rsrm_id + '":"' + enddateStr[0] + '/' + M)
							}
						}
					}
					function getDRange(startdate, enddate){
						if(startdate[0] == enddate[0] && startdate[1] == enddate[1]){
							for(let i = (startdate[2] + 1); i < enddate[2]; i++){
								const D = i > 9 ? i : '0' + i
								arr.push(ctrr_rsrm_id + '":"' + startdateStr[0] + '/' + startdateStr[1] + '/' + D)
							}
						}else{
							for(let i = (startdate[2]+1); i <= 31; i++){
								const D = i > 9 ? i : '0' + i
								arr.push(ctrr_rsrm_id + '":"' + startdateStr[0] + '/' + startdateStr[1] + '/' + D)
							}
							for(let i = 1; i < enddate[2]; i++){
								const D = i > 9 ? i : '0' + i
								arr.push(ctrr_rsrm_id + '":"' + enddateStr[0] + '/' + enddateStr[1] + '/' + D)
							}
						}
					}
					function getHRange(startdate, enddate){
						if(startdate[0] == enddate[0] && startdate[1] == enddate[1] && startdate[2] == enddate[2]){
							for(let i = (startdate[3] + 1); i < enddate[3]; i++){
								let H = i > 9 ? i : '0' + i.toString();
								arr.push(ctrr_rsrm_id + '":"' + startdateStr[0] + '/' + startdateStr[1] + '/' + startdateStr[2] + ' ' + H)
							}
						}else{
							for(let i = (startdate[3]+1); i <= 24; i++){
								let H = i > 9 ? i : '0' + i.toString();
								arr.push(ctrr_rsrm_id + '":"' + startdateStr[0] + '/' + startdateStr[1] + '/' + startdateStr[2] + ' ' + H)
							}
							for(let i = 1; i < enddate[3]; i++){
								let H = i > 9 ? i : '0' + i.toString();
								arr.push(ctrr_rsrm_id + '":"' + enddateStr[0] + '/' + enddateStr[1] + '/' + enddateStr[2] + ' ' + H)
							}
						}
					}
					function getminRange(startdate, enddate){
						if(startdate[0] == enddate[0] && startdate[1] == enddate[1] && startdate[2] == enddate[2] && startdate[3] == enddate[3]){
							for(let i = (startdate[4] + 1); i < enddate[4]; i++){
								let min = i > 9 ? i : '0' + i;
								arr.push(ctrr_rsrm_id + '":"' + startdateStr[0] + '/' + startdateStr[1] + '/' + startdateStr[2] + ' ' + startdateStr[3] + ':' + min)
							}
						}else{
							for(let i = (startdate[4]+1); i < 60; i++){
								let min = i > 9 ? i : '0' + i;
								arr.push(ctrr_rsrm_id + '":"' + startdateStr[0] + '/' + startdateStr[1] + '/' + startdateStr[2] + ' ' + startdateStr[3] + ':' + min)
							}
							for(let i = 1; i < enddate[4]; i++){
								let min = i > 9 ? i : '0' + i;
								arr.push(ctrr_rsrm_id + '":"' + enddateStr[0] + '/' + enddateStr[1] + '/' + enddateStr[2] + ' ' + enddateStr[3] + ':' + min)
							}
							
						}
					}
					function getSRange(startdate, enddate){
						if(startdate[0] == enddate[0] && startdate[1] == enddate[1] && startdate[2] == enddate[2] && startdate[3] == enddate[3] && startdate[4] == enddate[4]){
							for(let i = (startdate[5] + 1); i < enddate[5]; i++){
								let S = i > 9 ? i : '0' + i;
								arr.push(ctrr_rsrm_id + '":"' + startdateStr[0] + '/' + startdateStr[1] + '/' + startdateStr[2] + ' ' + startdateStr[3] + ':' + startdateStr[4] + ':' + S)
							}
						}else{
							for(let i = (startdate[5]+1); i < 60; i++){
								let S = i > 9 ? i : '0' + i;
								arr.push(ctrr_rsrm_id + '":"' + startdateStr[0] + '/' + startdateStr[1] + '/' + startdateStr[2] + ' ' + startdateStr[3] + ':' + startdateStr[4] + ':' + S)
							}
							for(let i = 1; i < enddate[5]; i++){
								let S = i > 9 ? i : '0' + i;
								arr.push(ctrr_rsrm_id + '":"' + enddateStr[0] + '/' + enddateStr[1] + '/' + enddateStr[2] + ' ' + enddateStr[3] + ':' + enddateStr[4] + ':' + S)
							}
							
						}
					}
					// 构造年份
					getYRange(startdate, enddate)
					// 构造月份
					getMRange(startdate, enddate)
					// 构造日份
					getDRange(startdate, enddate)
					// 构造小时
					getHRange(startdate, enddate)
					// 构造分钟
					getminRange(startdate, enddate)
					// 构造秒钟
					getSRange(startdate, enddate)
					// 最后包括区间的两端点
					arr.push(ctrr_rsrm_id + '":"' + startdateStr[0] + '/' + startdateStr[1] + '/' + startdateStr[2] + ' ' + startdateStr[3] + ':' + startdateStr[4] + ':' + startdateStr[5])
					arr.push(ctrr_rsrm_id + '":"' + enddateStr[0] + '/' + enddateStr[1] + '/' + enddateStr[2] + ' ' + enddateStr[3] + ':' + enddateStr[4] + ':' + enddateStr[5])
					return arr;
				},
				// 不可关闭错误报告
				handleCloseDrawer(){
					// 不用写任何代码，当drawer调用这个函数的时候，只要不做任何处理，就不会关闭drawer
					const _this = this
					_this.$notify({
						title: "提示",
						type: 'warning',
						message: '请按错误报告内容修改并刷新页面缓存后，重新提交',
						position: 'bottom-right',
						duration: 2000
					})
				}
			},
			computed: {
				// 对于任何复杂逻辑，你都应当使用计算属性
			},
			// 不要在选项 property 或回调上使用箭头函数，
			// 比如 created: () => console.log(this.a) 或 vm.$watch('a', newValue => this.myMethod())。
			// 因为箭头函数并没有 this，this 会作为变量一直向上级词法作用域查找，直至找到为止，
			// 经常导致 
			// Uncaught TypeError: Cannot read property of undefined 
			// 或 Uncaught TypeError: this.myMethod is not a function 之类的错误。
			beforeCreate:function(){
				// 初始化：事件&生命周期
			},
			created:function(){
				// 初始化：注入&校验
				const _this = this;
			},
			beforeMount:function(){
			},
			mounted:function(){
				// 创建vm.$el 并用其替换"el" 
				// 挂载完毕
				const _this = this;
			},
			beforeUpdate:function(){
				// 当data被修改时
			},
			updated: function () {
				// 虚拟dom重新渲染并应用更新
				const _this = this;
			},
			beforeDestroy:function(){
				// 当调用vm.$destroy()函数时
			},
			destroy:function(){
				// 解除绑定销毁子组件以及事件监听器
				// 销毁完毕 
			}
		})

		function exportRaw(name, excelKey, excelData) {
			// excelData -> array
			layui.use(['table'], function(){
				const table = layui.table
				table.exportFile(excelKey, excelData, 'xls', name); //默认导出 xls
			})
		}
		/**
		 * 管理内存 —— （手工）解除引用
		 * 确保占用最少的内存可以让页面获得更好的性能
		 * 而优化内存占用的最佳方式，就是为执行中的代码只保存必要的数据，
		 * 一旦数据不再有用，最好通过将其值设置为null来释放其引用 —— 这个做法叫做接触引用
		 * 不过解除引用并不意味着自动回收该值所占用的内存。
		 * 解除引用的真正作用是让值脱离执行环境，以便垃圾收集器下次运行时将其回收
		 * 不过下面有一些还是会继续用到，比如换页的时候还会用到一些变量，所以暂时就不用接触引用了
		 */
		// levelOneList = null
		// tableDataBySQL = null
		// pagination = null
		// levelThree = null
		// tableData = null
		// lastTableData = null
		// treeForImportData = null
		// l2_to_l3_allFiled = null
		// formJson = null
		// tableKey = null
		// app = null
	}
</script>

<script>
	{
		/**
		 * ITMC其他故障 
		**/
		// 对于已经创建的实例，Vue 不允许动态添加根级别的响应式 property。
		// 所以所有响应式的数据最好是提前加载出来，否则后面要新增一个相应级别的数据会有点麻烦
		let levelOneList = {:json_encode($levelOneList)}; // 构造1级分类json数据
		// 本次即将获得处理的初始表格
		let levelOneListItem = levelOneList[0].children[1]
		let levelTwoList = {}; // 构造2级表格json数据
		let levelThree = {} // 构造3级字段json数据
		let tableDataBySQL = {:json_encode($tableDataBySQL)};
		let pagination = {:json_encode($pagination)};
		for(let i=0; i<levelOneList.length; i++){
			for(let j=0; j<levelOneList[i].children.length; j++){
				levelTwoList[levelOneList[i].children[j].ctrr_rsrm_id] = levelOneList[i].children[j]
				for(let z=0; z<levelOneList[i].children[j].children.length; z++){
					levelThree[levelOneList[i].children[j].children[z].ctrr_rsrm_id] = levelOneList[i].children[j].children[z]
				}
			}
		}
		// 初始化tableData数据
		// 默认加载第一张二级表的数据
		// lastTableData 保存上一次table数据，用于冲突检测
		// errFieldMsg 构造字段检测错误信息，用于返回字段校验信息
		let tableData = []
		let lastTableData = []
		let errFieldMsg = {}
		for(let i = 0; i < tableDataBySQL.length; i++){
			tableDataBySQL[i].ctrr_rsrmD_data = tableDataBySQL[i].ctrr_rsrmD_data.replace(/\n/g,"\\\\n").replace(/\r/g,"\\r")
			tableData.push(JSON.parse(tableDataBySQL[i].ctrr_rsrmD_data))
			lastTableData.push(JSON.parse(tableDataBySQL[i].ctrr_rsrmD_data))
			// 将缺失的三级字段补充回去
			for(let j = 0; j < levelOneListItem.children.length; j++){
				let ctrr_rsrm_idForKey = levelOneListItem.children[j].ctrr_rsrm_id
				if(!tableData[i].hasOwnProperty(ctrr_rsrm_idForKey)){
					tableData[i][ctrr_rsrm_idForKey] = ''
				}
				// 格式为：i：数据处于第几行  ctrr_rsrm_idForKey：字段id
				errFieldMsg[i + '_' + ctrr_rsrm_idForKey] = ''
			}
			tableData[i]['ctrr_rsrmD_id'] = tableDataBySQL[i].ctrr_rsrmD_id
			tableData[i]['star_state'] = tableDataBySQL[i].star_state
			tableData[i]['flag_state'] = tableDataBySQL[i].flag_state
		}
		let treeForImportData = [] // 导入excel的树形组件选择器
		// 初始化动态加载每一张二级表用于搜索的form数据
		// 注：为了减少http请求，table表格中的字段是根据formJson进行动态加载的，
		// 因此如果后续要减少搜索项，只需要在显示的时候隐藏搜索项即可，以避免影响table表格的价值
		let l2_to_l3_allFiled = {}//保存1~3级所有字段数据
		let formJson = {
						// 格式
						// L2的ctrr_rsrm_id:{
						// 	L3的ctrr_rsrm_id: L3字段的value
						// }
					}
		// 构造 l2_to_l3_allFiled 与 formJson 
		for(let i = 0; i < levelOneList.length; i++){
			const levelTwoList = levelOneList[i].children;
			const treeForImportData_item = {
				ctrr_rsrm_id: levelOneList[i].ctrr_rsrm_id,
				ctrr_rsrm_name: levelOneList[i].ctrr_rsrm_name,
				children:[],
				index:i
			}
			for(let j = 0; j < levelTwoList.length; j++){
				const levelThreeList = levelTwoList[j].children;
				let l2_to_l3_allFiled_item = {}
				let formJson_item = {}
				const treeForImportData_item_item = {
					ctrr_rsrm_id: levelTwoList[j].ctrr_rsrm_id,
					ctrr_rsrm_name: levelTwoList[j].ctrr_rsrm_name,
					index:j
				}
				treeForImportData_item['children'].push(treeForImportData_item_item)
				for(let z = 0; z < levelThreeList.length; z++){
					if(levelThreeList[z].ctrr_rsrm_type !== 1){
						formJson_item[levelThreeList[z].ctrr_rsrm_id] = levelThreeList[z]
						formJson_item[levelThreeList[z].ctrr_rsrm_id]['value'] = ''
					}
					l2_to_l3_allFiled_item[levelThreeList[z].ctrr_rsrm_id] = levelThreeList[z]
					l2_to_l3_allFiled_item[levelThreeList[z].ctrr_rsrm_id]['value'] = ''
					l2_to_l3_allFiled_item[levelThreeList[z].ctrr_rsrm_id]['errMsg'] = '' // 字段错误提示
				}
				l2_to_l3_allFiled[levelTwoList[j].ctrr_rsrm_id] = l2_to_l3_allFiled_item
				formJson[levelTwoList[j].ctrr_rsrm_id] = formJson_item
				// formJson[levelTwoList[j].ctrr_rsrm_id]['searchKeyWords'] = ''
			}
			treeForImportData.push(treeForImportData_item)
		}
		// 初始化加载tableKey，用于构造table表格列的结构
		let tableKey = []
		for(let i = 0; i < levelOneListItem.children.length; i++){
			tableKey.push({
				key:levelOneListItem.children[i].ctrr_rsrm_id.toString(),
				label:levelOneListItem.children[i].ctrr_rsrm_name,
				ctrr_rsrm_tips:levelOneListItem.children[i].ctrr_rsrm_tips,
				ctrr_rsrm_is_needed:levelOneListItem.children[i].ctrr_rsrm_is_needed,
				ctrr_rsrm_is_key: levelOneListItem.children[i].ctrr_rsrm_is_key
			})
		}
		let app = new Vue({
			el: '#app1',
			data() {
				return {
					/**
					 * 为便于快速开发以及后期维护，本模块直接采用连续复刻值班信息模块的方式实现，
					 * 既将值班信息模块复制四次，所有代码尽量保留，前端不要的功能只需隐藏，不做过多变动
					 **/
					isShowThisPage: false, 

					levelOneList: levelOneList,
					levelTwoList: levelTwoList,
					levelThree: levelThree,
					columNum: levelOneListItem.children.length, // 既三级字段个数
					SearchPanelBtn: false,
					AddBtn: false,
					tabsLoading: false, // 切换标签的loading
					dateFormatReg: /^\d{2,4}\/\d{2}\/\d{2}\s\d{2}\:\d{2}\:\d{2}/, // 匹配时间格式： yyyy/MM/dd HH:mm:ss
					tabsLoadingTxt: 'loading...',// 使用切换标签loading时候的文字提示
					tableLoading: false, // 数据表格面板loading
					l2_to_l3_allFiled: l2_to_l3_allFiled,// 1~3级字段所有数据
					formJson: formJson,
					formAddJson: JSON.parse(JSON.stringify(l2_to_l3_allFiled)),//由于js本身的拷贝机制，导致如果直接给this.formAddJson赋值formJson会使得this.formJson与this.formAddJson底层数据相互影响，因此这里用深拷贝的方式将数据拷贝一份
					// DateTimePicker 日期时间选择器数据
					// 单个时间
					pickerOptions: {
						shortcuts: [{
							text: '今天',
							onClick(picker) {
							picker.$emit('pick', new Date());
							}
						}, {
							text: '昨天',
							onClick(picker) {
							const date = new Date();
							date.setTime(date.getTime() - 3600 * 1000 * 24);
							picker.$emit('pick', date);
							}
						}, {
							text: '一周前',
							onClick(picker) {
							const date = new Date();
							date.setTime(date.getTime() - 3600 * 1000 * 24 * 7);
							picker.$emit('pick', date);
							}
						}]
					},
					// 时间范围
					pickerOptionsRange: {
						shortcuts: [{
							text: '最近一周',
							onClick(picker) {
								const end = new Date();
								const start = new Date();
								start.setTime(start.getTime() - 3600 * 1000 * 24 * 7);
								picker.$emit('pick', [start, end]);
							}
						}, {
							text: '最近一个月',
							onClick(picker) {
								const end = new Date();
								const start = new Date();
								start.setTime(start.getTime() - 3600 * 1000 * 24 * 30);
								picker.$emit('pick', [start, end]);
							}
						}, {
							text: '最近三个月',
							onClick(picker) {
								const end = new Date();
								const start = new Date();
								start.setTime(start.getTime() - 3600 * 1000 * 24 * 90);
								picker.$emit('pick', [start, end]);
							}
						}]
					},
					// 字段校验规则的错误信息
					errFieldMsg: errFieldMsg,
					tableKey: tableKey,
					tableData: tableData,
					// 用于search()方法
					searchKeyWords: {
						label: '多个关键词请用“@”符号隔开，如：张三@广西，无需考虑顺序',
						tips: '关键词搜索会对全表进行全量搜索，无需区分字段',
						key: 'searchKeyWords',
						value: ''// 搜索关键词字符串
					}, 
					dataCreate:{
						key: 'create_time',
						value: ''
					},
					dataUpdate:{
						key: 'update_time',
						value: ''
					},
					levelOneList_index: 0,// 当前显示数据的一级表数据索引
					levelTwoList_index: 0,// 当前显示数据的二级表数据索引
					now_ctrr_rsrm_id_l2: levelOneListItem.ctrr_rsrm_id,// 当前显示数据的二级表id
					pagination: pagination,
					
					lastTableData:JSON.parse(JSON.stringify(lastTableData)),//保留上一次table数据，用于冲突检测
					// 临时保存用户最近一次编辑的数据，一般用于在冲突检测发生冲突之后，将用户数据保存在一个临时容器中
					tempDataShow: false,
					tempData: '', 
					treeForImportData: treeForImportData, // 树形组件数据
					cascaderData: treeForImportData, // 级联组件数据
					cascaderDataDefault: [treeForImportData[0].index, treeForImportData[0].children[0].index], // 级联组件数据第一次加载时的默认值
					defaultImportTreeProps: { // 树形组件属性自定义
						// children: 'children',
						label: 'ctrr_rsrm_name',
						disabled: 'disableTreeCheckout'
					},
					defaultCascaderProps: { // 级联组件属性自定义
						// children: 'children',
						label: 'ctrr_rsrm_name',
						value: 'index'
					},
					keyForImport:[], //保存导入excel的key

					// 用于生成大值班
					dutySummaryTimeRange:'', // 大值班总结时间范围搜索条件
					dutySummary:{
						head:'', // 总结信息
						incompletedData:'', // 待跟进故障
						completedData:'', // 已消除故障
					}, 
					// 大值班总结数据
					// 错误报告——初步设计为仅含不可忽略错误
					errorReport: {},
					isShowErrorReportDrawer: false, // 错误报告抽屉显示
				}
			},
			methods: {
				// 切换级联菜单时触发加载数据
				handleCascaderChange(indexArr){
					const _this = this
					_this.levelOneList_index = indexArr[0]
					_this.levelTwoList_index = indexArr[1]	
					// 切换页面的时候要将原搜索数据置空
					_this.resetSearch(_this.now_ctrr_rsrm_id_l2)
					_this.now_ctrr_rsrm_id_l2 = levelOneList[indexArr[0]].children[indexArr[1]].ctrr_rsrm_id
					_this.search()
				},
				search() {
					const _this = this
					_this.tabsLoading = true;
					// 深拷贝
					let searchFormPre = JSON.parse(JSON.stringify(_this.formJson[_this.now_ctrr_rsrm_id_l2]));

					let searchKeyWordsJson = {
						// 'AND'  用于交集搜索
						// 'OR'   用于并集搜索（目前不仅适用于其他的搜索内容还可以用于解决ctrr_rsrmD_data字段的时间范围搜索的问题）
						// 'other'   用于搜索 create_time 与 update_time
					}
					searchKeyWordsJson.ADN = _this.searchKeyWords.value.split('@')
					searchKeyWordsJson.OR = []
					searchKeyWordsJson.other = {
						create_time: _this.dataCreate.value,
						update_time: _this.dataUpdate.value
					}
					// 删除数组中的空元素
					for(let i = 0; i < searchKeyWordsJson.ADN.length; i++){
						if(searchKeyWordsJson.ADN[i] == ''){
							searchKeyWordsJson.ADN.splice(i, 1)
							i--;
						}
					}

					for(let key in searchFormPre){
						if(searchFormPre[key].value != '' && searchFormPre[key].value != undefined){
							if(searchFormPre[key].ctrr_rsrm_type == 6){
								/*  
									对时间类型字段进行进一步处理
									date-picker 中已将value-format格式设置为"yyyy/M/d/H/m/s"
									因此，处理该字符串变得十分简单，规则为：
									1.由于数据表的数据结构特殊因此无法用常规的时间比对方式进行时间条件搜索，因此只能将时间范围按年、月、天、时、分秒拆开进行一个个的模糊搜索
									2.数据格式规定为2020/6/1 
									注：十年之内的搜索条件最多不会超过225个
								*/
								let arr = _this.hangdleStart_end_time(searchFormPre[key].value[0], searchFormPre[key].value[1], searchFormPre[key].ctrr_rsrm_id)
								searchKeyWordsJson.OR = searchKeyWordsJson.OR.concat(arr)
							}else{
								searchKeyWordsJson.ADN.push(searchFormPre[key].ctrr_rsrm_id+'":"'+ searchFormPre[key].value)
							}
						}
					}
					const data = {
						ctrr_rsrm_id_l2: _this.now_ctrr_rsrm_id_l2,
						getNextLevelData: 1,
						searchKeyWordsJson: searchKeyWordsJson,
						pagination: _this.pagination
						// get有长度限制，所以下面用post请求，有趣的是居然可以接收多级json的请求参数
					}
					$.ajax({
						type:'POST'
						,data:data
						,url:'cmccFaultPanel'
						,success:function(res){
							// 搜索成功
							_this.tabsLoading = false;
							let tableData = res.tableData;
							_this.pagination = res.pagination;
							// 将返回数据处理成tableData所需的数据格式
							_this.tableData = []
							_this.errFieldMsg = {}
							// 加载table
							const levelThreeList = levelOneList[_this.levelOneList_index].children[_this.levelTwoList_index].children
							_this.lastTableData = []
							for(let i = 0; i < tableData.length; i++){
								// JSON.parse 解析json字符串时，遇换行符报错用.replace(/\n/g,"\\\\n").replace(/\r/g,"\\r")将换行符替代掉
								_this.tableData.push(JSON.parse(tableData[i].ctrr_rsrmD_data.replace(/\n/g,"\\\\n").replace(/\r/g,"\\r")))
								// 刷新用于冲突检测的 lasttabledata 数据
								_this.lastTableData.push(JSON.parse(tableData[i].ctrr_rsrmD_data.replace(/\n/g,"\\\\n").replace(/\r/g,"\\r")))
								// 补充缺失的三级字段
								// 将缺失的三级字段补充回去
								let levelOneList = _this.levelOneList
								for(let j = 0; j < levelThreeList.length; j++){
									const ctrr_rsrm_idForKey = levelThreeList[j].ctrr_rsrm_id
									if(!_this.tableData[i].hasOwnProperty(ctrr_rsrm_idForKey)){
										// 重设tableData数组响应式
										_this.$set(_this.tableData[i], ctrr_rsrm_idForKey, '')
									}
									// 重设errFieldMsg对象响应式
									_this.$set(_this.errFieldMsg, i + '_' + ctrr_rsrm_idForKey, '')
								}
								_this.tableData[i]['ctrr_rsrmD_id'] = tableData[i].ctrr_rsrmD_id
								_this.tableData[i]['star_state'] = tableData[i].star_state
								_this.tableData[i]['flag_state'] = tableData[i].flag_state
							}
							
							// _this.$refs.multipleTable.doLayout();
							// 加载tableKey，用于构造table表格列的结构
							let tableKey = []
							let levelTwoList = levelOneList[_this.levelOneList_index].children[_this.levelTwoList_index].children

							for(let i = 0; i < levelTwoList.length; i++){
								tableKey.push({
									key:levelTwoList[i].ctrr_rsrm_id.toString(),
									label:levelTwoList[i].ctrr_rsrm_name,
									ctrr_rsrm_tips:levelTwoList[i].ctrr_rsrm_tips,
									ctrr_rsrm_is_needed:levelTwoList[i].ctrr_rsrm_is_needed,
									ctrr_rsrm_is_key: levelTwoList[i].ctrr_rsrm_is_key
								})
							}
							// 列数不足时会报错，这里做一下处理，列数不足初始设计时，将列数等于所获取的数据的列数
							(_this.columNum <= tableKey.length) || (_this.columNum = tableKey.length)
							_this.tableKey = tableKey
							if(tableData.length === 0){
								// 此处才判断是否存在数据的原因是希望无论是否有无数据都至少把table的表格model先加载出来
								// 这样在第一次新增数据的时候才能正常实现数据响应式
								showTs(1,'暂无数据',500)
							} else {
								showTs(1,'加载成功',500)
							}
						},
						error:function(e){
							showTs(0, '服务器错误，请联系管理查看控制台报错信息', 5000)
							console.log('【服务器错误】：' + e)
						}
					})
				},
				// 快捷搜索，获取最近新增数据
				handleGetLatelyAdd(timeRange){
					const _this = this
					const end = new Date();
					const start = new Date();
					switch(timeRange){
						case 'today':
							start.setTime(start.getTime() - 3600 * 1000 * 24 );
							break
						case 'thisWeek':
							start.setTime(start.getTime() - 3600 * 1000 * 24 * 7);
							break
						case 'thisMonth':
							start.setTime(start.getTime() - 3600 * 1000 * 24 * 30);
							break
						default:
							break
					}
					let sy = start.getFullYear()
					let sm = ( start.getMonth() + 1 > 9 ? start.getMonth() + 1 : '0' + (start.getMonth() + 1) )
					let sd = ( start.getDate()  > 9 ? start.getDate()  : '0' + (start.getDate() ) )
					let sh = ( start.getHours()  > 9 ? start.getHours()  : '0' + (start.getHours() ) )
					let smin = ( start.getMinutes()  > 9 ? start.getMinutes()  : '0' + (start.getMinutes() ) )
					let ss =  ( start.getSeconds()  > 9 ? start.getSeconds()  : '0' + (start.getSeconds() ) )
					let startStr = sy + '-' + sm + '-' + sd + ' ' + sh + ':' + smin + ':' + ss
					let ey = end.getFullYear()
					let em = ( end.getMonth() + 1 > 9 ? end.getMonth() + 1 : '0' + (end.getMonth() + 1) )
					let ed = ( end.getDate()  > 9 ? end.getDate()  : '0' + (end.getDate() ) )
					let eh = ( end.getHours()  > 9 ? end.getHours()  : '0' + (end.getHours() ) )
					let emin = ( end.getMinutes()  > 9 ? end.getMinutes()  : '0' + (end.getMinutes() ) )
					let es =  ( end.getSeconds()  > 9 ? end.getSeconds()  : '0' + (end.getSeconds() ) )
					let endStr = ey + '-' + em + '-' + ed + ' ' + eh + ':' + emin + ':' + es
					_this.dataCreate.value = [startStr, endStr]
					_this.search()
				},
				resetSearch(ctrr_rsrm_id_l2){
					const _this = this;
					// 重置formJson
					for(let key in _this.formJson[ctrr_rsrm_id_l2]){
						_this.formJson[ctrr_rsrm_id_l2][key].value = ''
					}
					// 重置searchKeyWords
					_this.searchKeyWords.value = '';
					// 重置dataCreate
					_this.dataCreate.value = '';
					// 重置dataUpdate
					_this.dataUpdate.value = '';
				},
				handleEdit(props, fieldConstructure, fieldVal){
					
					// fieldConstructure 字段结构
					// fieldVal 字段值
					const _this = this;
					const row = JSON.parse(JSON.stringify(props.row)) // 行数据 如果这里不深拷贝一下，下面【去掉空格】的处理将会影响表格的数据响应式效果
					const index = props.$index // 行数据索引
					let keyData = ''
					let star_state = ''
					let flag_state = ''
					let data = {}
					let isNeededKey; // 保存必填字段的id
					let jsonData = JSON.parse(JSON.stringify(row)) // 暂存行数据
					if (fieldConstructure !== 'star_state' && fieldConstructure !== 'flag_state') {
						this.errFieldMsg[index + '_' + fieldConstructure.key] = ""
						// 检测用户是否还存在未处理的错误字段
						for (const k in this.errFieldMsg) {
							if (this.errFieldMsg[k] !== '') {
								app.$notify({
									title: '操作失败',
									message: '请先修改已存在的错误提示',
									type: 'error',
									duration: 3000
								})
								return
							}
						}

						// 禁止字段传入特殊值
						if (fieldVal === false 
							|| (typeof(fieldVal) === "number" && isNaN(fieldVal))) {
							this.errFieldMsg[index + '_' + fieldConstructure.key] = "请勿输入特殊值字符！"
							showTs(0, '请勿输入特殊值字符', 3000)
							return
						}
						// 传入值与null/undefined有关系的时候
						if (
							fieldVal === undefined || fieldVal === null ||
							// 输入字符串时候，判断字符串中是否包含特殊字段
							(typeof(fieldVal) === "string" && 
							(fieldVal.indexOf('undefined') !== -1 || fieldVal.indexOf('null') !== -1))
						) 
						{
							/** 数据响应 **/
							fieldVal = ''
							props.row[fieldConstructure.key] = fieldVal
							row[fieldConstructure.key] = fieldVal
							/** 数据响应 **/
							this.errFieldMsg[index + '_' + fieldConstructure.key] = "undefined与null被转化为空值"
							showTs(0, 'undefined与null被转化为空值', 3000)
						}
						// 校验必填字段规则：trim()函数用于去掉字符串的头尾空格，除了可以判断一个空值的情况，还可用于判断多个纯空格的情况
						if (fieldVal.trim() === '' && fieldConstructure.ctrr_rsrm_is_needed) {
							showTs(0, '['+fieldConstructure.label + ']为必填字段，请重新编辑', 3000)
							this.errFieldMsg[index + '_' + fieldConstructure.key] = "必填字段不能为空"
							return
						}
						// 构造主键字段数据
						if (fieldConstructure.ctrr_rsrm_is_key !== 1) {
							// 如果当前编辑的不是主键字段，则遍历检测出数据中的主键字段
							for (let i = 0; i < _this.tableKey.length; i++) {
								if (_this.tableKey[i].ctrr_rsrm_is_key === 1) {
									isNeededKey = _this.tableKey[i].key
									if ( row[_this.tableKey[i].key] !== '' ) {
										keyData = '"'+ _this.tableKey[i].key+'":"' + row[_this.tableKey[i].key] + '"'
									}
									break //主键只有一个，if进入一次即可跳出整个循环
								}
							}
						} else if (fieldVal !== '') {
							// 如果当前编辑的就是主键字段且不为空，则直接构造参数
							isNeededKey = fieldConstructure.key
							keyData = '"'+fieldConstructure.key+'":"' + fieldVal + '"'
						}
						// 去掉所有空值
						for(let key in row){
							if(row[key] === ''){
								delete row[key]
							}
						}
						star_state = jsonData.star_state
						flag_state = jsonData.flag_state
					} else {
						if (fieldConstructure === 'star_state') {
							star_state = fieldVal
							props.row.star_state = star_state
							flag_state = props.row.flag_state
						} else if (fieldConstructure === 'flag_state') {
							flag_state = fieldVal
							props.row.flag_state = flag_state
							star_state = props.row.star_state
						}
					}
					const ctrr_rsrmD_id = jsonData.ctrr_rsrmD_id 
					//删掉ctrr_rsrmD_id，并构造json字符串用于数据库保存
					delete jsonData.ctrr_rsrmD_id;
					const ctrr_rsrmD_data = JSON.stringify(jsonData)
					//删掉ctrr_rsrmD_id，并构造json字符串用于冲突检测
					let jsonLastData = JSON.parse(JSON.stringify(_this.lastTableData[index])) // 暂存行数据
					// 临时保存用户最近一次编辑的数据
					_this.tempData = JSON.parse(ctrr_rsrmD_data)
					delete jsonLastData.ctrr_rsrmD_id;
					const last_ctrr_rsrmD_data = JSON.stringify(jsonLastData)
					data = {
						ctrr_rsrmD_id: ctrr_rsrmD_id,
						ctrr_rsrmD_data: ctrr_rsrmD_data,
						star_state: star_state,
						flag_state: flag_state,
						last_ctrr_rsrmD_data: last_ctrr_rsrmD_data,
						// 主键字段
						keyData: keyData
					}
					$.ajax({
						type:"POST"
						,data: data
						,url:'editRotaSituationRecord'
						,success:function(res){
							const code = res.code
							const msg = res.msg
							if(code === 1){
								_this.$notify({
									title: '操作成功',
									message: msg,
									type: 'success',
									duration: 500
								})
								_this.lastTableData[index] = JSON.parse(JSON.stringify(row))
								_this.tempDataShow = false;
							} else if(code === -1){
								// 主键检测发现重复
								_this.$notify({
									title: '操作失败',
									message: msg,
									type: 'error'
								})
								_this.errFieldMsg[index + '_' + isNeededKey] = msg
							} else if(code === 0){
								_this.$notify({
									title: '操作失败，请刷新页面',
									message: msg,
									type: 'error'
								})
							} else{
								_this.$notify({
									title: '操作失败',
									message: '发生未知错误，请联系管理员',
									type: 'error',
									duration: 0
								})
								_this.tempDataShow = false;
							}
						}
					})
				},
				getTreeCheckedNodes(){
					const _this = this
					let keyForImport = []  // 导入excel时所需的key，分为两级第一级表名（对应excel中的sheet），第二级字段
					const checkedNodes = _this.$refs.treeForImportExcel.getCheckedNodes(true) // 选中的表格
					for(let i = 0; i < checkedNodes.length; i++){
						checkedNodes[i].children = _this.l2_to_l3_allFiled[checkedNodes[i].ctrr_rsrm_id]
						keyForImport.push(checkedNodes[i])
					}
					return keyForImport;
				},
				handlExportFile(tableData){
					// 导出excel
					const _this = this
					const excelKey = []
					const excelData = []
					for(let i = 0; i < _this.tableKey.length; i++ ){
						excelKey.push(_this.tableKey[i].label)
					}
					for(let i = 0; i < _this.tableData.length; i++ ){
						let arr = []
						for(let j = 0; j < _this.tableKey.length; j++ ){
							arr.push(_this.tableData[i][_this.tableKey[j].key] || '')
						}
						excelData.push(arr)
					}
					layui.use(['table'], function(){
						const table = layui.table
						let name = new Date()
						table.exportFile(excelKey, excelData, 'xls', name.toDateString()); //默认导出 xls
					})
				},
				handlImportFile(){
					const _this = this
					_this.$confirm('即将开始导入，请确保导入文件 < 1M 且数据不要与现有数据重复，数据比较多时，处理时间会比较久', '提示', {
						confirmButtonText: '确定',
						cancelButtonText: '取消',
						type: 'warning'
					}).then(() => {
						const keyForImport = _this.getTreeCheckedNodes()
						if(keyForImport.length === 0){
							showTs(0, '请选择需要导入的表格', 1000)
							return
						}
						_this.keyForImport = keyForImport
						$('#importdOneExcel').click()					
					}).catch(() => {
						showTs(1,'已取消',500)
					});
				},
				// 我要待跟进数据
				handlGetincompletedData(){
					const _this = this;
					_this.resetSearch(_this.now_ctrr_rsrm_id_l2)
					_this.search()
				},
				// 切换页签时
				handleSizeChange(pageSize) {
					const _this = this
					_this.pagination.pageSize = pageSize
					_this.search()
				},
				handleCurrentChange(currentPage) {
					const _this = this
					_this.pagination.currentPage = currentPage
					_this.search()
				},
				// 将开始时间和结束时间进行切割用于区间搜索
				hangdleStart_end_time(startdate, enddate, ctrr_rsrm_id=''){
					// startdate yyyy/M/d/H/m/s
					// enddate yyyy/M/d/H/m/s
					// ctrr_rsrm_id 字段id
					let arr = []
					startdate = startdate.split('/')
					enddate = enddate.split('/')

					// startdateStr,enddateStr用于拼接字符串
					let startdateStr = []
					let enddateStr = []
					// 字符串转数字类型
					for(let i = 0; i < startdate.length; i++){
						startdate[i] = Number(startdate[i])
						enddate[i] = Number(enddate[i])
						startdateStr[i] = startdate[i]
						enddateStr[i] = enddate[i]
						startdateStr[i] = startdate[i] > 9 ? startdate[i] : '0' + startdate[i]
						enddateStr[i] = enddate[i] > 9 ? enddate[i] : '0' + enddate[i]
					}
					function getYRange(startdate, enddate){
						if(startdate[0] != enddate[0]){
							for(let i = (startdate[0] + 1) ; i < enddate[0]; i++){
								arr.push(i)
							}
						}
					}
					function getMRange(startdate, enddate){
						if(startdate[0] == enddate[0]){
							for(let i = (startdate[1] + 1) ; i < enddate[1]; i++){
								const M = i > 9 ? i : '0' + i
								arr.push(ctrr_rsrm_id + '":"' + startdateStr[0] + '/' + M)
							}
						}else{
							for( let i = (startdate[1] + 1) ; i <= 12; i++ ){
								const M = i > 9 ? i : '0' + i
								arr.push(ctrr_rsrm_id + '":"' + startdateStr[0] + '/' + M)
							}
							for(let i = (enddate[1] - 1); i >= 1; i--){
								const M = i > 9 ? i : '0' + i
								arr.push(ctrr_rsrm_id + '":"' + enddateStr[0] + '/' + M)
							}
						}
					}
					function getDRange(startdate, enddate){
						if(startdate[0] == enddate[0] && startdate[1] == enddate[1]){
							for(let i = (startdate[2] + 1); i < enddate[2]; i++){
								const D = i > 9 ? i : '0' + i
								arr.push(ctrr_rsrm_id + '":"' + startdateStr[0] + '/' + startdateStr[1] + '/' + D)
							}
						}else{
							for(let i = (startdate[2]+1); i <= 31; i++){
								const D = i > 9 ? i : '0' + i
								arr.push(ctrr_rsrm_id + '":"' + startdateStr[0] + '/' + startdateStr[1] + '/' + D)
							}
							for(let i = 1; i < enddate[2]; i++){
								const D = i > 9 ? i : '0' + i
								arr.push(ctrr_rsrm_id + '":"' + enddateStr[0] + '/' + enddateStr[1] + '/' + D)
							}
						}
					}
					function getHRange(startdate, enddate){
						if(startdate[0] == enddate[0] && startdate[1] == enddate[1] && startdate[2] == enddate[2]){
							for(let i = (startdate[3] + 1); i < enddate[3]; i++){
								let H = i > 9 ? i : '0' + i.toString();
								arr.push(ctrr_rsrm_id + '":"' + startdateStr[0] + '/' + startdateStr[1] + '/' + startdateStr[2] + ' ' + H)
							}
						}else{
							for(let i = (startdate[3]+1); i <= 24; i++){
								let H = i > 9 ? i : '0' + i.toString();
								arr.push(ctrr_rsrm_id + '":"' + startdateStr[0] + '/' + startdateStr[1] + '/' + startdateStr[2] + ' ' + H)
							}
							for(let i = 1; i < enddate[3]; i++){
								let H = i > 9 ? i : '0' + i.toString();
								arr.push(ctrr_rsrm_id + '":"' + enddateStr[0] + '/' + enddateStr[1] + '/' + enddateStr[2] + ' ' + H)
							}
						}
					}
					function getminRange(startdate, enddate){
						if(startdate[0] == enddate[0] && startdate[1] == enddate[1] && startdate[2] == enddate[2] && startdate[3] == enddate[3]){
							for(let i = (startdate[4] + 1); i < enddate[4]; i++){
								let min = i > 9 ? i : '0' + i;
								arr.push(ctrr_rsrm_id + '":"' + startdateStr[0] + '/' + startdateStr[1] + '/' + startdateStr[2] + ' ' + startdateStr[3] + ':' + min)
							}
						}else{
							for(let i = (startdate[4]+1); i < 60; i++){
								let min = i > 9 ? i : '0' + i;
								arr.push(ctrr_rsrm_id + '":"' + startdateStr[0] + '/' + startdateStr[1] + '/' + startdateStr[2] + ' ' + startdateStr[3] + ':' + min)
							}
							for(let i = 1; i < enddate[4]; i++){
								let min = i > 9 ? i : '0' + i;
								arr.push(ctrr_rsrm_id + '":"' + enddateStr[0] + '/' + enddateStr[1] + '/' + enddateStr[2] + ' ' + enddateStr[3] + ':' + min)
							}
							
						}
					}
					function getSRange(startdate, enddate){
						if(startdate[0] == enddate[0] && startdate[1] == enddate[1] && startdate[2] == enddate[2] && startdate[3] == enddate[3] && startdate[4] == enddate[4]){
							for(let i = (startdate[5] + 1); i < enddate[5]; i++){
								let S = i > 9 ? i : '0' + i;
								arr.push(ctrr_rsrm_id + '":"' + startdateStr[0] + '/' + startdateStr[1] + '/' + startdateStr[2] + ' ' + startdateStr[3] + ':' + startdateStr[4] + ':' + S)
							}
						}else{
							for(let i = (startdate[5]+1); i < 60; i++){
								let S = i > 9 ? i : '0' + i;
								arr.push(ctrr_rsrm_id + '":"' + startdateStr[0] + '/' + startdateStr[1] + '/' + startdateStr[2] + ' ' + startdateStr[3] + ':' + startdateStr[4] + ':' + S)
							}
							for(let i = 1; i < enddate[5]; i++){
								let S = i > 9 ? i : '0' + i;
								arr.push(ctrr_rsrm_id + '":"' + enddateStr[0] + '/' + enddateStr[1] + '/' + enddateStr[2] + ' ' + enddateStr[3] + ':' + enddateStr[4] + ':' + S)
							}
							
						}
					}
					// 构造年份
					getYRange(startdate, enddate)
					// 构造月份
					getMRange(startdate, enddate)
					// 构造日份
					getDRange(startdate, enddate)
					// 构造小时
					getHRange(startdate, enddate)
					// 构造分钟
					getminRange(startdate, enddate)
					// 构造秒钟
					getSRange(startdate, enddate)
					// 最后包括区间的两端点
					arr.push(ctrr_rsrm_id + '":"' + startdateStr[0] + '/' + startdateStr[1] + '/' + startdateStr[2] + ' ' + startdateStr[3] + ':' + startdateStr[4] + ':' + startdateStr[5])
					arr.push(ctrr_rsrm_id + '":"' + enddateStr[0] + '/' + enddateStr[1] + '/' + enddateStr[2] + ' ' + enddateStr[3] + ':' + enddateStr[4] + ':' + enddateStr[5])
					return arr;
				},
				// 不可关闭错误报告
				handleCloseDrawer(){
					// 不用写任何代码，当drawer调用这个函数的时候，只要不做任何处理，就不会关闭drawer
					const _this = this
					_this.$notify({
						title: "提示",
						type: 'warning',
						message: '请按错误报告内容修改并刷新页面缓存后，重新提交',
						position: 'bottom-right',
						duration: 2000
					})
				}
			},
			computed: {
				// 对于任何复杂逻辑，你都应当使用计算属性
			},
			// 不要在选项 property 或回调上使用箭头函数，
			// 比如 created: () => console.log(this.a) 或 vm.$watch('a', newValue => this.myMethod())。
			// 因为箭头函数并没有 this，this 会作为变量一直向上级词法作用域查找，直至找到为止，
			// 经常导致 
			// Uncaught TypeError: Cannot read property of undefined 
			// 或 Uncaught TypeError: this.myMethod is not a function 之类的错误。
			beforeCreate:function(){
				// 初始化：事件&生命周期
			},
			created:function(){
				// 初始化：注入&校验
				const _this = this;
			},
			beforeMount:function(){
			},
			mounted:function(){
				// 创建vm.$el 并用其替换"el" 
				// 挂载完毕
				const _this = this;
			},
			beforeUpdate:function(){
				// 当data被修改时
			},
			updated: function () {
				// 虚拟dom重新渲染并应用更新
				const _this = this;
			},
			beforeDestroy:function(){
				// 当调用vm.$destroy()函数时
			},
			destroy:function(){
				// 解除绑定销毁子组件以及事件监听器
				// 销毁完毕 
			}
		})
		// 加载级联组件第一级的第二张表，既【ITMC其他故障】
		app.handleCascaderChange([0,1])
		function exportRaw(name, excelKey, excelData) {
			// excelData -> array
			layui.use(['table'], function(){
				const table = layui.table
				table.exportFile(excelKey, excelData, 'xls', name); //默认导出 xls
			})
		}
		/**
		 * 管理内存 —— （手工）解除引用
		 * 确保占用最少的内存可以让页面获得更好的性能
		 * 而优化内存占用的最佳方式，就是为执行中的代码只保存必要的数据，
		 * 一旦数据不再有用，最好通过将其值设置为null来释放其引用 —— 这个做法叫做接触引用
		 * 不过解除引用并不意味着自动回收该值所占用的内存。
		 * 解除引用的真正作用是让值脱离执行环境，以便垃圾收集器下次运行时将其回收
		 * 不过下面有一些还是会继续用到，比如换页的时候还会用到一些变量，所以暂时就不用接触引用了
		 */
		// levelOneList = null
		// tableDataBySQL = null
		// pagination = null
		// levelThree = null
		// tableData = null
		// lastTableData = null
		// treeForImportData = null
		// l2_to_l3_allFiled = null
		// formJson = null
		// tableKey = null
		// app = null
	}
</script>

<script>
	{
		/**
		 * 政企光缆故障
		**/
		// 对于已经创建的实例，Vue 不允许动态添加根级别的响应式 property。
		// 所以所有响应式的数据最好是提前加载出来，否则后面要新增一个相应级别的数据会有点麻烦
		let levelOneList = {:json_encode($levelOneList)}; // 构造1级分类json数据
		// 本次即将获得处理的初始表格
		let levelOneListItem = levelOneList[0].children[3]
		let levelTwoList = {}; // 构造2级表格json数据
		let levelThree = {} // 构造3级字段json数据
		let tableDataBySQL = {:json_encode($tableDataBySQL)};
		let pagination = {:json_encode($pagination)};
		for(let i=0; i<levelOneList.length; i++){
			for(let j=0; j<levelOneList[i].children.length; j++){
				levelTwoList[levelOneList[i].children[j].ctrr_rsrm_id] = levelOneList[i].children[j]
				for(let z=0; z<levelOneList[i].children[j].children.length; z++){
					levelThree[levelOneList[i].children[j].children[z].ctrr_rsrm_id] = levelOneList[i].children[j].children[z]
				}
			}
		}
		// 初始化tableData数据
		// 默认加载第一张二级表的数据
		// lastTableData 保存上一次table数据，用于冲突检测
		// errFieldMsg 构造字段检测错误信息，用于返回字段校验信息
		let tableData = []
		let lastTableData = []
		let errFieldMsg = {}
		for(let i = 0; i < tableDataBySQL.length; i++){
			tableDataBySQL[i].ctrr_rsrmD_data = tableDataBySQL[i].ctrr_rsrmD_data.replace(/\n/g,"\\\\n").replace(/\r/g,"\\r")
			tableData.push(JSON.parse(tableDataBySQL[i].ctrr_rsrmD_data))
			lastTableData.push(JSON.parse(tableDataBySQL[i].ctrr_rsrmD_data))
			// 将缺失的三级字段补充回去
			for(let j = 0; j < levelOneListItem.children.length; j++){
				let ctrr_rsrm_idForKey = levelOneListItem.children[j].ctrr_rsrm_id
				if(!tableData[i].hasOwnProperty(ctrr_rsrm_idForKey)){
					tableData[i][ctrr_rsrm_idForKey] = ''
				}
				// 格式为：i：数据处于第几行  ctrr_rsrm_idForKey：字段id
				errFieldMsg[i + '_' + ctrr_rsrm_idForKey] = ''
			}
			tableData[i]['ctrr_rsrmD_id'] = tableDataBySQL[i].ctrr_rsrmD_id
			tableData[i]['star_state'] = tableDataBySQL[i].star_state
			tableData[i]['flag_state'] = tableDataBySQL[i].flag_state
		}
		let treeForImportData = [] // 导入excel的树形组件选择器
		// 初始化动态加载每一张二级表用于搜索的form数据
		// 注：为了减少http请求，table表格中的字段是根据formJson进行动态加载的，
		// 因此如果后续要减少搜索项，只需要在显示的时候隐藏搜索项即可，以避免影响table表格的价值
		let l2_to_l3_allFiled = {}//保存1~3级所有字段数据
		let formJson = {
						// 格式
						// L2的ctrr_rsrm_id:{
						// 	L3的ctrr_rsrm_id: L3字段的value
						// }
					}
		// 构造 l2_to_l3_allFiled 与 formJson 
		for(let i = 0; i < levelOneList.length; i++){
			const levelTwoList = levelOneList[i].children;
			const treeForImportData_item = {
				ctrr_rsrm_id: levelOneList[i].ctrr_rsrm_id,
				ctrr_rsrm_name: levelOneList[i].ctrr_rsrm_name,
				children:[],
				index:i
			}
			for(let j = 0; j < levelTwoList.length; j++){
				const levelThreeList = levelTwoList[j].children;
				let l2_to_l3_allFiled_item = {}
				let formJson_item = {}
				const treeForImportData_item_item = {
					ctrr_rsrm_id: levelTwoList[j].ctrr_rsrm_id,
					ctrr_rsrm_name: levelTwoList[j].ctrr_rsrm_name,
					index:j
				}
				treeForImportData_item['children'].push(treeForImportData_item_item)
				for(let z = 0; z < levelThreeList.length; z++){
					if(levelThreeList[z].ctrr_rsrm_type !== 1){
						formJson_item[levelThreeList[z].ctrr_rsrm_id] = levelThreeList[z]
						formJson_item[levelThreeList[z].ctrr_rsrm_id]['value'] = ''
					}
					l2_to_l3_allFiled_item[levelThreeList[z].ctrr_rsrm_id] = levelThreeList[z]
					l2_to_l3_allFiled_item[levelThreeList[z].ctrr_rsrm_id]['value'] = ''
					l2_to_l3_allFiled_item[levelThreeList[z].ctrr_rsrm_id]['errMsg'] = '' // 字段错误提示
				}
				l2_to_l3_allFiled[levelTwoList[j].ctrr_rsrm_id] = l2_to_l3_allFiled_item
				formJson[levelTwoList[j].ctrr_rsrm_id] = formJson_item
				// formJson[levelTwoList[j].ctrr_rsrm_id]['searchKeyWords'] = ''
			}
			treeForImportData.push(treeForImportData_item)
		}
		// 初始化加载tableKey，用于构造table表格列的结构
		let tableKey = []
		for(let i = 0; i < levelOneListItem.children.length; i++){
			tableKey.push({
				key:levelOneListItem.children[i].ctrr_rsrm_id.toString(),
				label:levelOneListItem.children[i].ctrr_rsrm_name,
				ctrr_rsrm_tips:levelOneListItem.children[i].ctrr_rsrm_tips,
				ctrr_rsrm_is_needed:levelOneListItem.children[i].ctrr_rsrm_is_needed,
				ctrr_rsrm_is_key: levelOneListItem.children[i].ctrr_rsrm_is_key
			})
		}
		let app = new Vue({
			el: '#app2',
			data() {
				return {
					/**
					 * 为便于快速开发以及后期维护，本模块直接采用连续复刻值班信息模块的方式实现，
					 * 既将值班信息模块复制四次，所有代码尽量保留，前端不要的功能只需隐藏，不做过多变动
					 **/
					isShowThisPage: false, 

					levelOneList: levelOneList,
					levelTwoList: levelTwoList,
					levelThree: levelThree,
					columNum: levelOneListItem.children.length, // 既三级字段个数
					SearchPanelBtn: false,
					AddBtn: false,
					tabsLoading: false, // 切换标签的loading
					dateFormatReg: /^\d{2,4}\/\d{2}\/\d{2}\s\d{2}\:\d{2}\:\d{2}/, // 匹配时间格式： yyyy/MM/dd HH:mm:ss
					tabsLoadingTxt: 'loading...',// 使用切换标签loading时候的文字提示
					tableLoading: false, // 数据表格面板loading
					l2_to_l3_allFiled: l2_to_l3_allFiled,// 1~3级字段所有数据
					formJson: formJson,
					formAddJson: JSON.parse(JSON.stringify(l2_to_l3_allFiled)),//由于js本身的拷贝机制，导致如果直接给this.formAddJson赋值formJson会使得this.formJson与this.formAddJson底层数据相互影响，因此这里用深拷贝的方式将数据拷贝一份
					// DateTimePicker 日期时间选择器数据
					// 单个时间
					pickerOptions: {
						shortcuts: [{
							text: '今天',
							onClick(picker) {
							picker.$emit('pick', new Date());
							}
						}, {
							text: '昨天',
							onClick(picker) {
							const date = new Date();
							date.setTime(date.getTime() - 3600 * 1000 * 24);
							picker.$emit('pick', date);
							}
						}, {
							text: '一周前',
							onClick(picker) {
							const date = new Date();
							date.setTime(date.getTime() - 3600 * 1000 * 24 * 7);
							picker.$emit('pick', date);
							}
						}]
					},
					// 时间范围
					pickerOptionsRange: {
						shortcuts: [{
							text: '最近一周',
							onClick(picker) {
								const end = new Date();
								const start = new Date();
								start.setTime(start.getTime() - 3600 * 1000 * 24 * 7);
								picker.$emit('pick', [start, end]);
							}
						}, {
							text: '最近一个月',
							onClick(picker) {
								const end = new Date();
								const start = new Date();
								start.setTime(start.getTime() - 3600 * 1000 * 24 * 30);
								picker.$emit('pick', [start, end]);
							}
						}, {
							text: '最近三个月',
							onClick(picker) {
								const end = new Date();
								const start = new Date();
								start.setTime(start.getTime() - 3600 * 1000 * 24 * 90);
								picker.$emit('pick', [start, end]);
							}
						}]
					},
					// 字段校验规则的错误信息
					errFieldMsg: errFieldMsg,
					tableKey: tableKey,
					tableData: tableData,
					// 用于search()方法
					searchKeyWords: {
						label: '多个关键词请用“@”符号隔开，如：张三@广西，无需考虑顺序',
						tips: '关键词搜索会对全表进行全量搜索，无需区分字段',
						key: 'searchKeyWords',
						value: ''// 搜索关键词字符串
					}, 
					dataCreate:{
						key: 'create_time',
						value: ''
					},
					dataUpdate:{
						key: 'update_time',
						value: ''
					},
					levelOneList_index: 0,// 当前显示数据的一级表数据索引
					levelTwoList_index: 0,// 当前显示数据的二级表数据索引
					now_ctrr_rsrm_id_l2: levelOneListItem.ctrr_rsrm_id,// 当前显示数据的二级表id
					pagination: pagination,
					
					lastTableData:JSON.parse(JSON.stringify(lastTableData)),//保留上一次table数据，用于冲突检测
					// 临时保存用户最近一次编辑的数据，一般用于在冲突检测发生冲突之后，将用户数据保存在一个临时容器中
					tempDataShow: false,
					tempData: '', 
					treeForImportData: treeForImportData, // 树形组件数据
					cascaderData: treeForImportData, // 级联组件数据
					cascaderDataDefault: [treeForImportData[0].index, treeForImportData[0].children[0].index], // 级联组件数据第一次加载时的默认值
					defaultImportTreeProps: { // 树形组件属性自定义
						// children: 'children',
						label: 'ctrr_rsrm_name',
						disabled: 'disableTreeCheckout'
					},
					defaultCascaderProps: { // 级联组件属性自定义
						// children: 'children',
						label: 'ctrr_rsrm_name',
						value: 'index'
					},
					keyForImport:[], //保存导入excel的key

					// 用于生成大值班
					dutySummaryTimeRange:'', // 大值班总结时间范围搜索条件
					dutySummary:{
						head:'', // 总结信息
						incompletedData:'', // 待跟进故障
						completedData:'', // 已消除故障
					}, 
					// 大值班总结数据
					// 错误报告——初步设计为仅含不可忽略错误
					errorReport: {},
					isShowErrorReportDrawer: false, // 错误报告抽屉显示
				}
			},
			methods: {
				// 切换级联菜单时触发加载数据
				handleCascaderChange(indexArr){
					const _this = this
					_this.levelOneList_index = indexArr[0]
					_this.levelTwoList_index = indexArr[1]	
					// 切换页面的时候要将原搜索数据置空
					_this.resetSearch(_this.now_ctrr_rsrm_id_l2)
					_this.now_ctrr_rsrm_id_l2 = levelOneList[indexArr[0]].children[indexArr[1]].ctrr_rsrm_id
					_this.search()
				},
				search() {
					const _this = this
					_this.tabsLoading = true;
					// 深拷贝
					let searchFormPre = JSON.parse(JSON.stringify(_this.formJson[_this.now_ctrr_rsrm_id_l2]));

					let searchKeyWordsJson = {
						// 'AND'  用于交集搜索
						// 'OR'   用于并集搜索（目前不仅适用于其他的搜索内容还可以用于解决ctrr_rsrmD_data字段的时间范围搜索的问题）
						// 'other'   用于搜索 create_time 与 update_time
					}
					searchKeyWordsJson.ADN = _this.searchKeyWords.value.split('@')
					searchKeyWordsJson.OR = []
					searchKeyWordsJson.other = {
						create_time: _this.dataCreate.value,
						update_time: _this.dataUpdate.value
					}
					// 删除数组中的空元素
					for(let i = 0; i < searchKeyWordsJson.ADN.length; i++){
						if(searchKeyWordsJson.ADN[i] == ''){
							searchKeyWordsJson.ADN.splice(i, 1)
							i--;
						}
					}

					for(let key in searchFormPre){
						if(searchFormPre[key].value != '' && searchFormPre[key].value != undefined){
							if(searchFormPre[key].ctrr_rsrm_type == 6){
								/*  
									对时间类型字段进行进一步处理
									date-picker 中已将value-format格式设置为"yyyy/M/d/H/m/s"
									因此，处理该字符串变得十分简单，规则为：
									1.由于数据表的数据结构特殊因此无法用常规的时间比对方式进行时间条件搜索，因此只能将时间范围按年、月、天、时、分秒拆开进行一个个的模糊搜索
									2.数据格式规定为2020/6/1 
									注：十年之内的搜索条件最多不会超过225个
								*/
								let arr = _this.hangdleStart_end_time(searchFormPre[key].value[0], searchFormPre[key].value[1], searchFormPre[key].ctrr_rsrm_id)
								searchKeyWordsJson.OR = searchKeyWordsJson.OR.concat(arr)
							}else{
								searchKeyWordsJson.ADN.push(searchFormPre[key].ctrr_rsrm_id+'":"'+ searchFormPre[key].value)
							}
						}
					}
					const data = {
						ctrr_rsrm_id_l2: _this.now_ctrr_rsrm_id_l2,
						getNextLevelData: 1,
						searchKeyWordsJson: searchKeyWordsJson,
						pagination: _this.pagination
						// get有长度限制，所以下面用post请求，有趣的是居然可以接收多级json的请求参数
					}
					$.ajax({
						type:'POST'
						,data:data
						,url:'cmccFaultPanel'
						,success:function(res){
							// 搜索成功
							_this.tabsLoading = false;
							let tableData = res.tableData;
							_this.pagination = res.pagination;
							// 将返回数据处理成tableData所需的数据格式
							_this.tableData = []
							_this.errFieldMsg = {}
							// 加载table
							const levelThreeList = levelOneList[_this.levelOneList_index].children[_this.levelTwoList_index].children
							_this.lastTableData = []
							for(let i = 0; i < tableData.length; i++){
								// JSON.parse 解析json字符串时，遇换行符报错用.replace(/\n/g,"\\\\n").replace(/\r/g,"\\r")将换行符替代掉
								_this.tableData.push(JSON.parse(tableData[i].ctrr_rsrmD_data.replace(/\n/g,"\\\\n").replace(/\r/g,"\\r")))
								// 刷新用于冲突检测的 lasttabledata 数据
								_this.lastTableData.push(JSON.parse(tableData[i].ctrr_rsrmD_data.replace(/\n/g,"\\\\n").replace(/\r/g,"\\r")))
								// 补充缺失的三级字段
								// 将缺失的三级字段补充回去
								let levelOneList = _this.levelOneList
								for(let j = 0; j < levelThreeList.length; j++){
									const ctrr_rsrm_idForKey = levelThreeList[j].ctrr_rsrm_id
									if(!_this.tableData[i].hasOwnProperty(ctrr_rsrm_idForKey)){
										// 重设tableData数组响应式
										_this.$set(_this.tableData[i], ctrr_rsrm_idForKey, '')
									}
									// 重设errFieldMsg对象响应式
									_this.$set(_this.errFieldMsg, i + '_' + ctrr_rsrm_idForKey, '')
								}
								_this.tableData[i]['ctrr_rsrmD_id'] = tableData[i].ctrr_rsrmD_id
								_this.tableData[i]['star_state'] = tableData[i].star_state
								_this.tableData[i]['flag_state'] = tableData[i].flag_state
							}
							
							// _this.$refs.multipleTable.doLayout();
							// 加载tableKey，用于构造table表格列的结构
							let tableKey = []
							let levelTwoList = levelOneList[_this.levelOneList_index].children[_this.levelTwoList_index].children

							for(let i = 0; i < levelTwoList.length; i++){
								tableKey.push({
									key:levelTwoList[i].ctrr_rsrm_id.toString(),
									label:levelTwoList[i].ctrr_rsrm_name,
									ctrr_rsrm_tips:levelTwoList[i].ctrr_rsrm_tips,
									ctrr_rsrm_is_needed:levelTwoList[i].ctrr_rsrm_is_needed,
									ctrr_rsrm_is_key: levelTwoList[i].ctrr_rsrm_is_key
								})
							}
							// 列数不足时会报错，这里做一下处理，列数不足初始设计时，将列数等于所获取的数据的列数
							(_this.columNum <= tableKey.length) || (_this.columNum = tableKey.length)
							_this.tableKey = tableKey
							if(tableData.length === 0){
								// 此处才判断是否存在数据的原因是希望无论是否有无数据都至少把table的表格model先加载出来
								// 这样在第一次新增数据的时候才能正常实现数据响应式
								showTs(1,'暂无数据',500)
							} else {
								showTs(1,'加载成功',500)
							}
						},
						error:function(e){
							showTs(0, '服务器错误，请联系管理查看控制台报错信息', 5000)
							console.log('【服务器错误】：' + e)
						}
					})
				},
				// 快捷搜索，获取最近新增数据
				handleGetLatelyAdd(timeRange){
					const _this = this
					const end = new Date();
					const start = new Date();
					switch(timeRange){
						case 'today':
							start.setTime(start.getTime() - 3600 * 1000 * 24 );
							break
						case 'thisWeek':
							start.setTime(start.getTime() - 3600 * 1000 * 24 * 7);
							break
						case 'thisMonth':
							start.setTime(start.getTime() - 3600 * 1000 * 24 * 30);
							break
						default:
							break
					}
					let sy = start.getFullYear()
					let sm = ( start.getMonth() + 1 > 9 ? start.getMonth() + 1 : '0' + (start.getMonth() + 1) )
					let sd = ( start.getDate()  > 9 ? start.getDate()  : '0' + (start.getDate() ) )
					let sh = ( start.getHours()  > 9 ? start.getHours()  : '0' + (start.getHours() ) )
					let smin = ( start.getMinutes()  > 9 ? start.getMinutes()  : '0' + (start.getMinutes() ) )
					let ss =  ( start.getSeconds()  > 9 ? start.getSeconds()  : '0' + (start.getSeconds() ) )
					let startStr = sy + '-' + sm + '-' + sd + ' ' + sh + ':' + smin + ':' + ss
					let ey = end.getFullYear()
					let em = ( end.getMonth() + 1 > 9 ? end.getMonth() + 1 : '0' + (end.getMonth() + 1) )
					let ed = ( end.getDate()  > 9 ? end.getDate()  : '0' + (end.getDate() ) )
					let eh = ( end.getHours()  > 9 ? end.getHours()  : '0' + (end.getHours() ) )
					let emin = ( end.getMinutes()  > 9 ? end.getMinutes()  : '0' + (end.getMinutes() ) )
					let es =  ( end.getSeconds()  > 9 ? end.getSeconds()  : '0' + (end.getSeconds() ) )
					let endStr = ey + '-' + em + '-' + ed + ' ' + eh + ':' + emin + ':' + es
					_this.dataCreate.value = [startStr, endStr]
					_this.search()
				},
				resetSearch(ctrr_rsrm_id_l2){
					const _this = this;
					// 重置formJson
					for(let key in _this.formJson[ctrr_rsrm_id_l2]){
						_this.formJson[ctrr_rsrm_id_l2][key].value = ''
					}
					// 重置searchKeyWords
					_this.searchKeyWords.value = '';
					// 重置dataCreate
					_this.dataCreate.value = '';
					// 重置dataUpdate
					_this.dataUpdate.value = '';
				},
				handleEdit(props, fieldConstructure, fieldVal){
					
					// fieldConstructure 字段结构
					// fieldVal 字段值
					const _this = this;
					const row = JSON.parse(JSON.stringify(props.row)) // 行数据 如果这里不深拷贝一下，下面【去掉空格】的处理将会影响表格的数据响应式效果
					const index = props.$index // 行数据索引
					let keyData = ''
					let star_state = ''
					let flag_state = ''
					let data = {}
					let isNeededKey; // 保存必填字段的id
					let jsonData = JSON.parse(JSON.stringify(row)) // 暂存行数据
					if (fieldConstructure !== 'star_state' && fieldConstructure !== 'flag_state') {
						this.errFieldMsg[index + '_' + fieldConstructure.key] = ""
						// 检测用户是否还存在未处理的错误字段
						for (const k in this.errFieldMsg) {
							if (this.errFieldMsg[k] !== '') {
								app.$notify({
									title: '操作失败',
									message: '请先修改已存在的错误提示',
									type: 'error',
									duration: 3000
								})
								return
							}
						}

						// 禁止字段传入特殊值
						if (fieldVal === false 
							|| (typeof(fieldVal) === "number" && isNaN(fieldVal))) {
							this.errFieldMsg[index + '_' + fieldConstructure.key] = "请勿输入特殊值字符！"
							showTs(0, '请勿输入特殊值字符', 3000)
							return
						}
						// 传入值与null/undefined有关系的时候
						if (
							fieldVal === undefined || fieldVal === null ||
							// 输入字符串时候，判断字符串中是否包含特殊字段
							(typeof(fieldVal) === "string" && 
							(fieldVal.indexOf('undefined') !== -1 || fieldVal.indexOf('null') !== -1))
						) 
						{
							/** 数据响应 **/
							fieldVal = ''
							props.row[fieldConstructure.key] = fieldVal
							row[fieldConstructure.key] = fieldVal
							/** 数据响应 **/
							this.errFieldMsg[index + '_' + fieldConstructure.key] = "undefined与null被转化为空值"
							showTs(0, 'undefined与null被转化为空值', 3000)
						}
						// 校验必填字段规则：trim()函数用于去掉字符串的头尾空格，除了可以判断一个空值的情况，还可用于判断多个纯空格的情况
						if (fieldVal.trim() === '' && fieldConstructure.ctrr_rsrm_is_needed) {
							showTs(0, '['+fieldConstructure.label + ']为必填字段，请重新编辑', 3000)
							this.errFieldMsg[index + '_' + fieldConstructure.key] = "必填字段不能为空"
							return
						}
						// 构造主键字段数据
						if (fieldConstructure.ctrr_rsrm_is_key !== 1) {
							// 如果当前编辑的不是主键字段，则遍历检测出数据中的主键字段
							for (let i = 0; i < _this.tableKey.length; i++) {
								if (_this.tableKey[i].ctrr_rsrm_is_key === 1) {
									isNeededKey = _this.tableKey[i].key
									if ( row[_this.tableKey[i].key] !== '' ) {
										keyData = '"'+ _this.tableKey[i].key+'":"' + row[_this.tableKey[i].key] + '"'
									}
									break //主键只有一个，if进入一次即可跳出整个循环
								}
							}
						} else if (fieldVal !== '') {
							// 如果当前编辑的就是主键字段且不为空，则直接构造参数
							isNeededKey = fieldConstructure.key
							keyData = '"'+fieldConstructure.key+'":"' + fieldVal + '"'
						}
						// 去掉所有空值
						for(let key in row){
							if(row[key] === ''){
								delete row[key]
							}
						}
						star_state = jsonData.star_state
						flag_state = jsonData.flag_state
					} else {
						if (fieldConstructure === 'star_state') {
							star_state = fieldVal
							props.row.star_state = star_state
							flag_state = props.row.flag_state
						} else if (fieldConstructure === 'flag_state') {
							flag_state = fieldVal
							props.row.flag_state = flag_state
							star_state = props.row.star_state
						}
					}
					
					const ctrr_rsrmD_id = jsonData.ctrr_rsrmD_id 
					//删掉ctrr_rsrmD_id，并构造json字符串用于数据库保存
					delete jsonData.ctrr_rsrmD_id;
					const ctrr_rsrmD_data = JSON.stringify(jsonData)
					//删掉ctrr_rsrmD_id，并构造json字符串用于冲突检测
					let jsonLastData = JSON.parse(JSON.stringify(_this.lastTableData[index])) // 暂存行数据
					// 临时保存用户最近一次编辑的数据
					_this.tempData = JSON.parse(ctrr_rsrmD_data)
					delete jsonLastData.ctrr_rsrmD_id;
					const last_ctrr_rsrmD_data = JSON.stringify(jsonLastData)
					data = {
						ctrr_rsrmD_id: ctrr_rsrmD_id,
						ctrr_rsrmD_data: ctrr_rsrmD_data,
						star_state: star_state,
						flag_state: flag_state,
						last_ctrr_rsrmD_data: last_ctrr_rsrmD_data,
						// 主键字段
						keyData: keyData
					}
					$.ajax({
						type:"POST"
						,data: data
						,url:'editRotaSituationRecord'
						,success:function(res){
							const code = res.code
							const msg = res.msg
							if(code === 1){
								_this.$notify({
									title: '操作成功',
									message: msg,
									type: 'success',
									duration: 500
								})
								_this.lastTableData[index] = JSON.parse(JSON.stringify(row))
								_this.tempDataShow = false;
							} else if(code === -1){
								// 主键检测发现重复
								_this.$notify({
									title: '操作失败',
									message: msg,
									type: 'error'
								})
								_this.errFieldMsg[index + '_' + isNeededKey] = msg
							} else if(code === 0){
								_this.$notify({
									title: '操作失败，请刷新页面',
									message: msg,
									type: 'error'
								})
							} else{
								_this.$notify({
									title: '操作失败',
									message: '发生未知错误，请联系管理员',
									type: 'error',
									duration: 0
								})
								_this.tempDataShow = false;
							}
						}
					})
				},
				getTreeCheckedNodes(){
					const _this = this
					let keyForImport = []  // 导入excel时所需的key，分为两级第一级表名（对应excel中的sheet），第二级字段
					const checkedNodes = _this.$refs.treeForImportExcel.getCheckedNodes(true) // 选中的表格
					for(let i = 0; i < checkedNodes.length; i++){
						checkedNodes[i].children = _this.l2_to_l3_allFiled[checkedNodes[i].ctrr_rsrm_id]
						keyForImport.push(checkedNodes[i])
					}
					return keyForImport;
				},
				handlExportFile(tableData){
					// 导出excel
					const _this = this
					const excelKey = []
					const excelData = []
					for(let i = 0; i < _this.tableKey.length; i++ ){
						excelKey.push(_this.tableKey[i].label)
					}
					for(let i = 0; i < _this.tableData.length; i++ ){
						let arr = []
						for(let j = 0; j < _this.tableKey.length; j++ ){
							arr.push(_this.tableData[i][_this.tableKey[j].key] || '')
						}
						excelData.push(arr)
					}
					layui.use(['table'], function(){
						const table = layui.table
						let name = new Date()
						table.exportFile(excelKey, excelData, 'xls', name.toDateString()); //默认导出 xls
					})
				},
				handlImportFile(){
					const _this = this
					_this.$confirm('即将开始导入，请确保导入文件 < 1M 且数据不要与现有数据重复，数据比较多时，处理时间会比较久', '提示', {
						confirmButtonText: '确定',
						cancelButtonText: '取消',
						type: 'warning'
					}).then(() => {
						const keyForImport = _this.getTreeCheckedNodes()
						if(keyForImport.length === 0){
							showTs(0, '请选择需要导入的表格', 1000)
							return
						}
						_this.keyForImport = keyForImport
						$('#importdOneExcel').click()					
					}).catch(() => {
						showTs(1,'已取消',500)
					});
				},
				// 我要待跟进数据
				handlGetincompletedData(){
					const _this = this;
					_this.resetSearch(_this.now_ctrr_rsrm_id_l2)
					_this.search()
				},
				// 切换页签时
				handleSizeChange(pageSize) {
					const _this = this
					_this.pagination.pageSize = pageSize
					_this.search()
				},
				handleCurrentChange(currentPage) {
					const _this = this
					_this.pagination.currentPage = currentPage
					_this.search()
				},
				// 将开始时间和结束时间进行切割用于区间搜索
				hangdleStart_end_time(startdate, enddate, ctrr_rsrm_id=''){
					// startdate yyyy/M/d/H/m/s
					// enddate yyyy/M/d/H/m/s
					// ctrr_rsrm_id 字段id
					let arr = []
					startdate = startdate.split('/')
					enddate = enddate.split('/')

					// startdateStr,enddateStr用于拼接字符串
					let startdateStr = []
					let enddateStr = []
					// 字符串转数字类型
					for(let i = 0; i < startdate.length; i++){
						startdate[i] = Number(startdate[i])
						enddate[i] = Number(enddate[i])
						startdateStr[i] = startdate[i]
						enddateStr[i] = enddate[i]
						startdateStr[i] = startdate[i] > 9 ? startdate[i] : '0' + startdate[i]
						enddateStr[i] = enddate[i] > 9 ? enddate[i] : '0' + enddate[i]
					}
					function getYRange(startdate, enddate){
						if(startdate[0] != enddate[0]){
							for(let i = (startdate[0] + 1) ; i < enddate[0]; i++){
								arr.push(i)
							}
						}
					}
					function getMRange(startdate, enddate){
						if(startdate[0] == enddate[0]){
							for(let i = (startdate[1] + 1) ; i < enddate[1]; i++){
								const M = i > 9 ? i : '0' + i
								arr.push(ctrr_rsrm_id + '":"' + startdateStr[0] + '/' + M)
							}
						}else{
							for( let i = (startdate[1] + 1) ; i <= 12; i++ ){
								const M = i > 9 ? i : '0' + i
								arr.push(ctrr_rsrm_id + '":"' + startdateStr[0] + '/' + M)
							}
							for(let i = (enddate[1] - 1); i >= 1; i--){
								const M = i > 9 ? i : '0' + i
								arr.push(ctrr_rsrm_id + '":"' + enddateStr[0] + '/' + M)
							}
						}
					}
					function getDRange(startdate, enddate){
						if(startdate[0] == enddate[0] && startdate[1] == enddate[1]){
							for(let i = (startdate[2] + 1); i < enddate[2]; i++){
								const D = i > 9 ? i : '0' + i
								arr.push(ctrr_rsrm_id + '":"' + startdateStr[0] + '/' + startdateStr[1] + '/' + D)
							}
						}else{
							for(let i = (startdate[2]+1); i <= 31; i++){
								const D = i > 9 ? i : '0' + i
								arr.push(ctrr_rsrm_id + '":"' + startdateStr[0] + '/' + startdateStr[1] + '/' + D)
							}
							for(let i = 1; i < enddate[2]; i++){
								const D = i > 9 ? i : '0' + i
								arr.push(ctrr_rsrm_id + '":"' + enddateStr[0] + '/' + enddateStr[1] + '/' + D)
							}
						}
					}
					function getHRange(startdate, enddate){
						if(startdate[0] == enddate[0] && startdate[1] == enddate[1] && startdate[2] == enddate[2]){
							for(let i = (startdate[3] + 1); i < enddate[3]; i++){
								let H = i > 9 ? i : '0' + i.toString();
								arr.push(ctrr_rsrm_id + '":"' + startdateStr[0] + '/' + startdateStr[1] + '/' + startdateStr[2] + ' ' + H)
							}
						}else{
							for(let i = (startdate[3]+1); i <= 24; i++){
								let H = i > 9 ? i : '0' + i.toString();
								arr.push(ctrr_rsrm_id + '":"' + startdateStr[0] + '/' + startdateStr[1] + '/' + startdateStr[2] + ' ' + H)
							}
							for(let i = 1; i < enddate[3]; i++){
								let H = i > 9 ? i : '0' + i.toString();
								arr.push(ctrr_rsrm_id + '":"' + enddateStr[0] + '/' + enddateStr[1] + '/' + enddateStr[2] + ' ' + H)
							}
						}
					}
					function getminRange(startdate, enddate){
						if(startdate[0] == enddate[0] && startdate[1] == enddate[1] && startdate[2] == enddate[2] && startdate[3] == enddate[3]){
							for(let i = (startdate[4] + 1); i < enddate[4]; i++){
								let min = i > 9 ? i : '0' + i;
								arr.push(ctrr_rsrm_id + '":"' + startdateStr[0] + '/' + startdateStr[1] + '/' + startdateStr[2] + ' ' + startdateStr[3] + ':' + min)
							}
						}else{
							for(let i = (startdate[4]+1); i < 60; i++){
								let min = i > 9 ? i : '0' + i;
								arr.push(ctrr_rsrm_id + '":"' + startdateStr[0] + '/' + startdateStr[1] + '/' + startdateStr[2] + ' ' + startdateStr[3] + ':' + min)
							}
							for(let i = 1; i < enddate[4]; i++){
								let min = i > 9 ? i : '0' + i;
								arr.push(ctrr_rsrm_id + '":"' + enddateStr[0] + '/' + enddateStr[1] + '/' + enddateStr[2] + ' ' + enddateStr[3] + ':' + min)
							}
							
						}
					}
					function getSRange(startdate, enddate){
						if(startdate[0] == enddate[0] && startdate[1] == enddate[1] && startdate[2] == enddate[2] && startdate[3] == enddate[3] && startdate[4] == enddate[4]){
							for(let i = (startdate[5] + 1); i < enddate[5]; i++){
								let S = i > 9 ? i : '0' + i;
								arr.push(ctrr_rsrm_id + '":"' + startdateStr[0] + '/' + startdateStr[1] + '/' + startdateStr[2] + ' ' + startdateStr[3] + ':' + startdateStr[4] + ':' + S)
							}
						}else{
							for(let i = (startdate[5]+1); i < 60; i++){
								let S = i > 9 ? i : '0' + i;
								arr.push(ctrr_rsrm_id + '":"' + startdateStr[0] + '/' + startdateStr[1] + '/' + startdateStr[2] + ' ' + startdateStr[3] + ':' + startdateStr[4] + ':' + S)
							}
							for(let i = 1; i < enddate[5]; i++){
								let S = i > 9 ? i : '0' + i;
								arr.push(ctrr_rsrm_id + '":"' + enddateStr[0] + '/' + enddateStr[1] + '/' + enddateStr[2] + ' ' + enddateStr[3] + ':' + enddateStr[4] + ':' + S)
							}
							
						}
					}
					// 构造年份
					getYRange(startdate, enddate)
					// 构造月份
					getMRange(startdate, enddate)
					// 构造日份
					getDRange(startdate, enddate)
					// 构造小时
					getHRange(startdate, enddate)
					// 构造分钟
					getminRange(startdate, enddate)
					// 构造秒钟
					getSRange(startdate, enddate)
					// 最后包括区间的两端点
					arr.push(ctrr_rsrm_id + '":"' + startdateStr[0] + '/' + startdateStr[1] + '/' + startdateStr[2] + ' ' + startdateStr[3] + ':' + startdateStr[4] + ':' + startdateStr[5])
					arr.push(ctrr_rsrm_id + '":"' + enddateStr[0] + '/' + enddateStr[1] + '/' + enddateStr[2] + ' ' + enddateStr[3] + ':' + enddateStr[4] + ':' + enddateStr[5])
					return arr;
				},
				// 不可关闭错误报告
				handleCloseDrawer(){
					// 不用写任何代码，当drawer调用这个函数的时候，只要不做任何处理，就不会关闭drawer
					const _this = this
					_this.$notify({
						title: "提示",
						type: 'warning',
						message: '请按错误报告内容修改并刷新页面缓存后，重新提交',
						position: 'bottom-right',
						duration: 2000
					})
				}
			},
			computed: {
				// 对于任何复杂逻辑，你都应当使用计算属性
			},
			// 不要在选项 property 或回调上使用箭头函数，
			// 比如 created: () => console.log(this.a) 或 vm.$watch('a', newValue => this.myMethod())。
			// 因为箭头函数并没有 this，this 会作为变量一直向上级词法作用域查找，直至找到为止，
			// 经常导致 
			// Uncaught TypeError: Cannot read property of undefined 
			// 或 Uncaught TypeError: this.myMethod is not a function 之类的错误。
			beforeCreate:function(){
				// 初始化：事件&生命周期
			},
			created:function(){
				// 初始化：注入&校验
				const _this = this;
			},
			beforeMount:function(){
			},
			mounted:function(){
				// 创建vm.$el 并用其替换"el" 
				// 挂载完毕
				const _this = this;
			},
			beforeUpdate:function(){
				// 当data被修改时
			},
			updated: function () {
				// 虚拟dom重新渲染并应用更新
				const _this = this;
			},
			beforeDestroy:function(){
				// 当调用vm.$destroy()函数时
			},
			destroy:function(){
				// 解除绑定销毁子组件以及事件监听器
				// 销毁完毕 
			}
		})

		// 加载级联组件第一级的第五张表，既【政企光缆故障】
		app.handleCascaderChange([0,3])
		function exportRaw(name, excelKey, excelData) {
			// excelData -> array
			layui.use(['table'], function(){
				const table = layui.table
				table.exportFile(excelKey, excelData, 'xls', name); //默认导出 xls
			})
		}
		/**
		 * 管理内存 —— （手工）解除引用
		 * 确保占用最少的内存可以让页面获得更好的性能
		 * 而优化内存占用的最佳方式，就是为执行中的代码只保存必要的数据，
		 * 一旦数据不再有用，最好通过将其值设置为null来释放其引用 —— 这个做法叫做接触引用
		 * 不过解除引用并不意味着自动回收该值所占用的内存。
		 * 解除引用的真正作用是让值脱离执行环境，以便垃圾收集器下次运行时将其回收
		 * 不过下面有一些还是会继续用到，比如换页的时候还会用到一些变量，所以暂时就不用接触引用了
		 */
		// levelOneList = null
		// tableDataBySQL = null
		// pagination = null
		// levelThree = null
		// tableData = null
		// lastTableData = null
		// treeForImportData = null
		// l2_to_l3_allFiled = null
		// formJson = null
		// tableKey = null
		// app = null
	}
</script>

<script>
	{
		/**
		 * 政企其他故障
		**/
		// 对于已经创建的实例，Vue 不允许动态添加根级别的响应式 property。
		// 所以所有响应式的数据最好是提前加载出来，否则后面要新增一个相应级别的数据会有点麻烦
		let levelOneList = {:json_encode($levelOneList)}; // 构造1级分类json数据
		// 本次即将获得处理的初始表格
		let levelOneListItem = levelOneList[0].children[4]
		let levelTwoList = {}; // 构造2级表格json数据
		let levelThree = {} // 构造3级字段json数据
		let tableDataBySQL = {:json_encode($tableDataBySQL)};
		let pagination = {:json_encode($pagination)};
		for(let i=0; i<levelOneList.length; i++){
			for(let j=0; j<levelOneList[i].children.length; j++){
				levelTwoList[levelOneList[i].children[j].ctrr_rsrm_id] = levelOneList[i].children[j]
				for(let z=0; z<levelOneList[i].children[j].children.length; z++){
					levelThree[levelOneList[i].children[j].children[z].ctrr_rsrm_id] = levelOneList[i].children[j].children[z]
				}
			}
		}
		// 初始化tableData数据
		// 默认加载第一张二级表的数据
		// lastTableData 保存上一次table数据，用于冲突检测
		// errFieldMsg 构造字段检测错误信息，用于返回字段校验信息
		let tableData = []
		let lastTableData = []
		let errFieldMsg = {}
		for(let i = 0; i < tableDataBySQL.length; i++){
			tableDataBySQL[i].ctrr_rsrmD_data = tableDataBySQL[i].ctrr_rsrmD_data.replace(/\n/g,"\\\\n").replace(/\r/g,"\\r")
			tableData.push(JSON.parse(tableDataBySQL[i].ctrr_rsrmD_data))
			lastTableData.push(JSON.parse(tableDataBySQL[i].ctrr_rsrmD_data))
			// 将缺失的三级字段补充回去
			for(let j = 0; j < levelOneListItem.children.length; j++){
				let ctrr_rsrm_idForKey = levelOneListItem.children[j].ctrr_rsrm_id
				if(!tableData[i].hasOwnProperty(ctrr_rsrm_idForKey)){
					tableData[i][ctrr_rsrm_idForKey] = ''
				}
				// 格式为：i：数据处于第几行  ctrr_rsrm_idForKey：字段id
				errFieldMsg[i + '_' + ctrr_rsrm_idForKey] = ''
			}
			tableData[i]['ctrr_rsrmD_id'] = tableDataBySQL[i].ctrr_rsrmD_id
			tableData[i]['star_state'] = tableDataBySQL[i].star_state
			tableData[i]['flag_state'] = tableDataBySQL[i].flag_state
		}
		let treeForImportData = [] // 导入excel的树形组件选择器
		// 初始化动态加载每一张二级表用于搜索的form数据
		// 注：为了减少http请求，table表格中的字段是根据formJson进行动态加载的，
		// 因此如果后续要减少搜索项，只需要在显示的时候隐藏搜索项即可，以避免影响table表格的价值
		let l2_to_l3_allFiled = {}//保存1~3级所有字段数据
		let formJson = {
						// 格式
						// L2的ctrr_rsrm_id:{
						// 	L3的ctrr_rsrm_id: L3字段的value
						// }
					}
		// 构造 l2_to_l3_allFiled 与 formJson 
		for(let i = 0; i < levelOneList.length; i++){
			const levelTwoList = levelOneList[i].children;
			const treeForImportData_item = {
				ctrr_rsrm_id: levelOneList[i].ctrr_rsrm_id,
				ctrr_rsrm_name: levelOneList[i].ctrr_rsrm_name,
				children:[],
				index:i
			}
			for(let j = 0; j < levelTwoList.length; j++){
				const levelThreeList = levelTwoList[j].children;
				let l2_to_l3_allFiled_item = {}
				let formJson_item = {}
				const treeForImportData_item_item = {
					ctrr_rsrm_id: levelTwoList[j].ctrr_rsrm_id,
					ctrr_rsrm_name: levelTwoList[j].ctrr_rsrm_name,
					index:j
				}
				treeForImportData_item['children'].push(treeForImportData_item_item)
				for(let z = 0; z < levelThreeList.length; z++){
					if(levelThreeList[z].ctrr_rsrm_type !== 1){
						formJson_item[levelThreeList[z].ctrr_rsrm_id] = levelThreeList[z]
						formJson_item[levelThreeList[z].ctrr_rsrm_id]['value'] = ''
					}
					l2_to_l3_allFiled_item[levelThreeList[z].ctrr_rsrm_id] = levelThreeList[z]
					l2_to_l3_allFiled_item[levelThreeList[z].ctrr_rsrm_id]['value'] = ''
					l2_to_l3_allFiled_item[levelThreeList[z].ctrr_rsrm_id]['errMsg'] = '' // 字段错误提示
				}
				l2_to_l3_allFiled[levelTwoList[j].ctrr_rsrm_id] = l2_to_l3_allFiled_item
				formJson[levelTwoList[j].ctrr_rsrm_id] = formJson_item
				// formJson[levelTwoList[j].ctrr_rsrm_id]['searchKeyWords'] = ''
			}
			treeForImportData.push(treeForImportData_item)
		}
		// 初始化加载tableKey，用于构造table表格列的结构
		let tableKey = []
		for(let i = 0; i < levelOneListItem.children.length; i++){
			tableKey.push({
				key:levelOneListItem.children[i].ctrr_rsrm_id.toString(),
				label:levelOneListItem.children[i].ctrr_rsrm_name,
				ctrr_rsrm_tips:levelOneListItem.children[i].ctrr_rsrm_tips,
				ctrr_rsrm_is_needed:levelOneListItem.children[i].ctrr_rsrm_is_needed,
				ctrr_rsrm_is_key: levelOneListItem.children[i].ctrr_rsrm_is_key
			})
		}
		let app = new Vue({
			el: '#app3',
			data() {
				return {
					/**
					 * 为便于快速开发以及后期维护，本模块直接采用连续复刻值班信息模块的方式实现，
					 * 既将值班信息模块复制四次，所有代码尽量保留，前端不要的功能只需隐藏，不做过多变动
					 **/
					isShowThisPage: false, 
					levelOneList: levelOneList,
					levelTwoList: levelTwoList,
					levelThree: levelThree,
					columNum: levelOneListItem.children.length, // 既三级字段个数
					SearchPanelBtn: false,
					AddBtn: false,
					tabsLoading: false, // 切换标签的loading
					dateFormatReg: /^\d{2,4}\/\d{2}\/\d{2}\s\d{2}\:\d{2}\:\d{2}/, // 匹配时间格式： yyyy/MM/dd HH:mm:ss
					tabsLoadingTxt: 'loading...',// 使用切换标签loading时候的文字提示
					tableLoading: false, // 数据表格面板loading
					l2_to_l3_allFiled: l2_to_l3_allFiled,// 1~3级字段所有数据
					formJson: formJson,
					formAddJson: JSON.parse(JSON.stringify(l2_to_l3_allFiled)),//由于js本身的拷贝机制，导致如果直接给this.formAddJson赋值formJson会使得this.formJson与this.formAddJson底层数据相互影响，因此这里用深拷贝的方式将数据拷贝一份
					// DateTimePicker 日期时间选择器数据
					// 单个时间
					pickerOptions: {
						shortcuts: [{
							text: '今天',
							onClick(picker) {
							picker.$emit('pick', new Date());
							}
						}, {
							text: '昨天',
							onClick(picker) {
							const date = new Date();
							date.setTime(date.getTime() - 3600 * 1000 * 24);
							picker.$emit('pick', date);
							}
						}, {
							text: '一周前',
							onClick(picker) {
							const date = new Date();
							date.setTime(date.getTime() - 3600 * 1000 * 24 * 7);
							picker.$emit('pick', date);
							}
						}]
					},
					// 时间范围
					pickerOptionsRange: {
						shortcuts: [{
							text: '最近一周',
							onClick(picker) {
								const end = new Date();
								const start = new Date();
								start.setTime(start.getTime() - 3600 * 1000 * 24 * 7);
								picker.$emit('pick', [start, end]);
							}
						}, {
							text: '最近一个月',
							onClick(picker) {
								const end = new Date();
								const start = new Date();
								start.setTime(start.getTime() - 3600 * 1000 * 24 * 30);
								picker.$emit('pick', [start, end]);
							}
						}, {
							text: '最近三个月',
							onClick(picker) {
								const end = new Date();
								const start = new Date();
								start.setTime(start.getTime() - 3600 * 1000 * 24 * 90);
								picker.$emit('pick', [start, end]);
							}
						}]
					},
					// 字段校验规则的错误信息
					errFieldMsg: errFieldMsg,
					tableKey: tableKey,
					tableData: tableData,
					// 用于search()方法
					searchKeyWords: {
						label: '多个关键词请用“@”符号隔开，如：张三@广西，无需考虑顺序',
						tips: '关键词搜索会对全表进行全量搜索，无需区分字段',
						key: 'searchKeyWords',
						value: ''// 搜索关键词字符串
					}, 
					dataCreate:{
						key: 'create_time',
						value: ''
					},
					dataUpdate:{
						key: 'update_time',
						value: ''
					},
					levelOneList_index: 0,// 当前显示数据的一级表数据索引
					levelTwoList_index: 0,// 当前显示数据的二级表数据索引
					now_ctrr_rsrm_id_l2: levelOneList[0].children[5].ctrr_rsrm_id,// 当前显示数据的二级表id
					pagination: pagination,
					
					lastTableData:JSON.parse(JSON.stringify(lastTableData)),//保留上一次table数据，用于冲突检测
					// 临时保存用户最近一次编辑的数据，一般用于在冲突检测发生冲突之后，将用户数据保存在一个临时容器中
					tempDataShow: false,
					tempData: '', 
					treeForImportData: treeForImportData, // 树形组件数据
					cascaderData: treeForImportData, // 级联组件数据
					cascaderDataDefault: [treeForImportData[0].index, treeForImportData[0].children[0].index], // 级联组件数据第一次加载时的默认值
					defaultImportTreeProps: { // 树形组件属性自定义
						// children: 'children',
						label: 'ctrr_rsrm_name',
						disabled: 'disableTreeCheckout'
					},
					defaultCascaderProps: { // 级联组件属性自定义
						// children: 'children',
						label: 'ctrr_rsrm_name',
						value: 'index'
					},
					keyForImport:[], //保存导入excel的key

					// 用于生成大值班
					dutySummaryTimeRange:'', // 大值班总结时间范围搜索条件
					dutySummary:{
						head:'', // 总结信息
						incompletedData:'', // 待跟进故障
						completedData:'', // 已消除故障
					}, 
					// 大值班总结数据
					// 错误报告——初步设计为仅含不可忽略错误
					errorReport: {},
					isShowErrorReportDrawer: false, // 错误报告抽屉显示
				}
			},
			methods: {
				// 切换级联菜单时触发加载数据
				handleCascaderChange(indexArr){
					const _this = this
					_this.levelOneList_index = indexArr[0]
					_this.levelTwoList_index = indexArr[1]	
					// 切换页面的时候要将原搜索数据置空
					_this.resetSearch(_this.now_ctrr_rsrm_id_l2)
					_this.now_ctrr_rsrm_id_l2 = levelOneList[indexArr[0]].children[indexArr[1]].ctrr_rsrm_id
					_this.search()
				},
				search() {
					const _this = this
					_this.tabsLoading = true;
					// 深拷贝
					let searchFormPre = JSON.parse(JSON.stringify(_this.formJson[_this.now_ctrr_rsrm_id_l2]));

					let searchKeyWordsJson = {
						// 'AND'  用于交集搜索
						// 'OR'   用于并集搜索（目前不仅适用于其他的搜索内容还可以用于解决ctrr_rsrmD_data字段的时间范围搜索的问题）
						// 'other'   用于搜索 create_time 与 update_time
					}
					searchKeyWordsJson.ADN = _this.searchKeyWords.value.split('@')
					searchKeyWordsJson.OR = []
					searchKeyWordsJson.other = {
						create_time: _this.dataCreate.value,
						update_time: _this.dataUpdate.value
					}
					// 删除数组中的空元素
					for(let i = 0; i < searchKeyWordsJson.ADN.length; i++){
						if(searchKeyWordsJson.ADN[i] == ''){
							searchKeyWordsJson.ADN.splice(i, 1)
							i--;
						}
					}

					for(let key in searchFormPre){
						if(searchFormPre[key].value != '' && searchFormPre[key].value != undefined){
							if(searchFormPre[key].ctrr_rsrm_type == 6){
								/*  
									对时间类型字段进行进一步处理
									date-picker 中已将value-format格式设置为"yyyy/M/d/H/m/s"
									因此，处理该字符串变得十分简单，规则为：
									1.由于数据表的数据结构特殊因此无法用常规的时间比对方式进行时间条件搜索，因此只能将时间范围按年、月、天、时、分秒拆开进行一个个的模糊搜索
									2.数据格式规定为2020/6/1 
									注：十年之内的搜索条件最多不会超过225个
								*/
								let arr = _this.hangdleStart_end_time(searchFormPre[key].value[0], searchFormPre[key].value[1], searchFormPre[key].ctrr_rsrm_id)
								searchKeyWordsJson.OR = searchKeyWordsJson.OR.concat(arr)
							}else{
								searchKeyWordsJson.ADN.push(searchFormPre[key].ctrr_rsrm_id+'":"'+ searchFormPre[key].value)
							}
						}
					}
					const data = {
						ctrr_rsrm_id_l2: _this.now_ctrr_rsrm_id_l2,
						getNextLevelData: 1,
						searchKeyWordsJson: searchKeyWordsJson,
						pagination: _this.pagination
						// get有长度限制，所以下面用post请求，有趣的是居然可以接收多级json的请求参数
					}
					$.ajax({
						type:'POST'
						,data:data
						,url:'cmccFaultPanel'
						,success:function(res){
							// 搜索成功
							_this.tabsLoading = false;
							let tableData = res.tableData;
							_this.pagination = res.pagination;
							// 将返回数据处理成tableData所需的数据格式
							_this.tableData = []
							_this.errFieldMsg = {}
							// 加载table
							const levelThreeList = levelOneList[_this.levelOneList_index].children[_this.levelTwoList_index].children
							_this.lastTableData = []
							for(let i = 0; i < tableData.length; i++){
								// JSON.parse 解析json字符串时，遇换行符报错用.replace(/\n/g,"\\\\n").replace(/\r/g,"\\r")将换行符替代掉
								_this.tableData.push(JSON.parse(tableData[i].ctrr_rsrmD_data.replace(/\n/g,"\\\\n").replace(/\r/g,"\\r")))
								// 刷新用于冲突检测的 lasttabledata 数据
								_this.lastTableData.push(JSON.parse(tableData[i].ctrr_rsrmD_data.replace(/\n/g,"\\\\n").replace(/\r/g,"\\r")))
								// 补充缺失的三级字段
								// 将缺失的三级字段补充回去
								let levelOneList = _this.levelOneList
								for(let j = 0; j < levelThreeList.length; j++){
									const ctrr_rsrm_idForKey = levelThreeList[j].ctrr_rsrm_id
									if(!_this.tableData[i].hasOwnProperty(ctrr_rsrm_idForKey)){
										// 重设tableData数组响应式
										_this.$set(_this.tableData[i], ctrr_rsrm_idForKey, '')
									}
									// 重设errFieldMsg对象响应式
									_this.$set(_this.errFieldMsg, i + '_' + ctrr_rsrm_idForKey, '')
								}
								_this.tableData[i]['ctrr_rsrmD_id'] = tableData[i].ctrr_rsrmD_id
								_this.tableData[i]['star_state'] = tableData[i].star_state
								_this.tableData[i]['flag_state'] = tableData[i].flag_state
							}
							
							// _this.$refs.multipleTable.doLayout();
							// 加载tableKey，用于构造table表格列的结构
							let tableKey = []
							let levelTwoList = levelOneList[_this.levelOneList_index].children[_this.levelTwoList_index].children

							for(let i = 0; i < levelTwoList.length; i++){
								tableKey.push({
									key:levelTwoList[i].ctrr_rsrm_id.toString(),
									label:levelTwoList[i].ctrr_rsrm_name,
									ctrr_rsrm_tips:levelTwoList[i].ctrr_rsrm_tips,
									ctrr_rsrm_is_needed:levelTwoList[i].ctrr_rsrm_is_needed,
									ctrr_rsrm_is_key: levelTwoList[i].ctrr_rsrm_is_key
								})
							}
							// 列数不足时会报错，这里做一下处理，列数不足初始设计时，将列数等于所获取的数据的列数
							(_this.columNum <= tableKey.length) || (_this.columNum = tableKey.length)
							_this.tableKey = tableKey
							if(tableData.length === 0){
								// 此处才判断是否存在数据的原因是希望无论是否有无数据都至少把table的表格model先加载出来
								// 这样在第一次新增数据的时候才能正常实现数据响应式
								showTs(1,'暂无数据',500)
							} else {
								showTs(1,'加载成功',500)
							}
						},
						error:function(e){
							showTs(0, '服务器错误，请联系管理查看控制台报错信息', 5000)
							console.log('【服务器错误】：' + e)
						}
					})
				},
				// 快捷搜索，获取最近新增数据
				handleGetLatelyAdd(timeRange){
					const _this = this
					const end = new Date();
					const start = new Date();
					switch(timeRange){
						case 'today':
							start.setTime(start.getTime() - 3600 * 1000 * 24 );
							break
						case 'thisWeek':
							start.setTime(start.getTime() - 3600 * 1000 * 24 * 7);
							break
						case 'thisMonth':
							start.setTime(start.getTime() - 3600 * 1000 * 24 * 30);
							break
						default:
							break
					}
					let sy = start.getFullYear()
					let sm = ( start.getMonth() + 1 > 9 ? start.getMonth() + 1 : '0' + (start.getMonth() + 1) )
					let sd = ( start.getDate()  > 9 ? start.getDate()  : '0' + (start.getDate() ) )
					let sh = ( start.getHours()  > 9 ? start.getHours()  : '0' + (start.getHours() ) )
					let smin = ( start.getMinutes()  > 9 ? start.getMinutes()  : '0' + (start.getMinutes() ) )
					let ss =  ( start.getSeconds()  > 9 ? start.getSeconds()  : '0' + (start.getSeconds() ) )
					let startStr = sy + '-' + sm + '-' + sd + ' ' + sh + ':' + smin + ':' + ss
					let ey = end.getFullYear()
					let em = ( end.getMonth() + 1 > 9 ? end.getMonth() + 1 : '0' + (end.getMonth() + 1) )
					let ed = ( end.getDate()  > 9 ? end.getDate()  : '0' + (end.getDate() ) )
					let eh = ( end.getHours()  > 9 ? end.getHours()  : '0' + (end.getHours() ) )
					let emin = ( end.getMinutes()  > 9 ? end.getMinutes()  : '0' + (end.getMinutes() ) )
					let es =  ( end.getSeconds()  > 9 ? end.getSeconds()  : '0' + (end.getSeconds() ) )
					let endStr = ey + '-' + em + '-' + ed + ' ' + eh + ':' + emin + ':' + es
					_this.dataCreate.value = [startStr, endStr]
					_this.search()
				},
				resetSearch(ctrr_rsrm_id_l2){
					const _this = this;
					// 重置formJson
					for(let key in _this.formJson[ctrr_rsrm_id_l2]){
						_this.formJson[ctrr_rsrm_id_l2][key].value = ''
					}
					// 重置searchKeyWords
					_this.searchKeyWords.value = '';
					// 重置dataCreate
					_this.dataCreate.value = '';
					// 重置dataUpdate
					_this.dataUpdate.value = '';
				},
				handleEdit(props, fieldConstructure, fieldVal){
					
					// fieldConstructure 字段结构
					// fieldVal 字段值
					const _this = this;
					const row = JSON.parse(JSON.stringify(props.row)) // 行数据 如果这里不深拷贝一下，下面【去掉空格】的处理将会影响表格的数据响应式效果
					const index = props.$index // 行数据索引
					let keyData = ''
					let star_state = ''
					let flag_state = ''
					let data = {}
					let isNeededKey; // 保存必填字段的id
					let jsonData = JSON.parse(JSON.stringify(row)) // 暂存行数据
					if (fieldConstructure !== 'star_state' && fieldConstructure !== 'flag_state') {
						this.errFieldMsg[index + '_' + fieldConstructure.key] = ""
						// 检测用户是否还存在未处理的错误字段
						for (const k in this.errFieldMsg) {
							if (this.errFieldMsg[k] !== '') {
								app.$notify({
									title: '操作失败',
									message: '请先修改已存在的错误提示',
									type: 'error',
									duration: 3000
								})
								return
							}
						}

						// 禁止字段传入特殊值
						if (fieldVal === false 
							|| (typeof(fieldVal) === "number" && isNaN(fieldVal))) {
							this.errFieldMsg[index + '_' + fieldConstructure.key] = "请勿输入特殊值字符！"
							showTs(0, '请勿输入特殊值字符', 3000)
							return
						}
						// 传入值与null/undefined有关系的时候
						if (
							fieldVal === undefined || fieldVal === null ||
							// 输入字符串时候，判断字符串中是否包含特殊字段
							(typeof(fieldVal) === "string" && 
							(fieldVal.indexOf('undefined') !== -1 || fieldVal.indexOf('null') !== -1))
						) 
						{
							/** 数据响应 **/
							fieldVal = ''
							props.row[fieldConstructure.key] = fieldVal
							row[fieldConstructure.key] = fieldVal
							/** 数据响应 **/
							this.errFieldMsg[index + '_' + fieldConstructure.key] = "undefined与null被转化为空值"
							showTs(0, 'undefined与null被转化为空值', 3000)
						}
						// 校验必填字段规则：trim()函数用于去掉字符串的头尾空格，除了可以判断一个空值的情况，还可用于判断多个纯空格的情况
						if (fieldVal.trim() === '' && fieldConstructure.ctrr_rsrm_is_needed) {
							showTs(0, '['+fieldConstructure.label + ']为必填字段，请重新编辑', 3000)
							this.errFieldMsg[index + '_' + fieldConstructure.key] = "必填字段不能为空"
							return
						}
						// 构造主键字段数据
						if (fieldConstructure.ctrr_rsrm_is_key !== 1) {
							// 如果当前编辑的不是主键字段，则遍历检测出数据中的主键字段
							for (let i = 0; i < _this.tableKey.length; i++) {
								if (_this.tableKey[i].ctrr_rsrm_is_key === 1) {
									isNeededKey = _this.tableKey[i].key
									if ( row[_this.tableKey[i].key] !== '' ) {
										keyData = '"'+ _this.tableKey[i].key+'":"' + row[_this.tableKey[i].key] + '"'
									}
									break //主键只有一个，if进入一次即可跳出整个循环
								}
							}
						} else if (fieldVal !== '') {
							// 如果当前编辑的就是主键字段且不为空，则直接构造参数
							isNeededKey = fieldConstructure.key
							keyData = '"'+fieldConstructure.key+'":"' + fieldVal + '"'
						}
						// 去掉所有空值
						for(let key in row){
							if(row[key] === ''){
								delete row[key]
							}
						}
						star_state = jsonData.star_state
						flag_state = jsonData.flag_state
					} else {
						if (fieldConstructure === 'star_state') {
							star_state = fieldVal
							props.row.star_state = star_state
							flag_state = props.row.flag_state
						} else if (fieldConstructure === 'flag_state') {
							flag_state = fieldVal
							props.row.flag_state = flag_state
							star_state = props.row.star_state
						}
					}
					
					const ctrr_rsrmD_id = jsonData.ctrr_rsrmD_id 
					//删掉ctrr_rsrmD_id，并构造json字符串用于数据库保存
					delete jsonData.ctrr_rsrmD_id;
					const ctrr_rsrmD_data = JSON.stringify(jsonData)
					//删掉ctrr_rsrmD_id，并构造json字符串用于冲突检测
					let jsonLastData = JSON.parse(JSON.stringify(_this.lastTableData[index])) // 暂存行数据
					// 临时保存用户最近一次编辑的数据
					_this.tempData = JSON.parse(ctrr_rsrmD_data)
					delete jsonLastData.ctrr_rsrmD_id;
					const last_ctrr_rsrmD_data = JSON.stringify(jsonLastData)
					data = {
						ctrr_rsrmD_id: ctrr_rsrmD_id,
						ctrr_rsrmD_data: ctrr_rsrmD_data,
						star_state: star_state,
						flag_state: flag_state,
						last_ctrr_rsrmD_data: last_ctrr_rsrmD_data,
						// 主键字段
						keyData: keyData
					}
					$.ajax({
						type:"POST"
						,data: data
						,url:'editRotaSituationRecord'
						,success:function(res){
							const code = res.code
							const msg = res.msg
							if(code === 1){
								_this.$notify({
									title: '操作成功',
									message: msg,
									type: 'success',
									duration: 500
								})
								_this.lastTableData[index] = JSON.parse(JSON.stringify(row))
								_this.tempDataShow = false;
							} else if(code === -1){
								// 主键检测发现重复
								_this.$notify({
									title: '操作失败',
									message: msg,
									type: 'error'
								})
								_this.errFieldMsg[index + '_' + isNeededKey] = msg
							} else if(code === 0){
								_this.$notify({
									title: '操作失败，请刷新页面',
									message: msg,
									type: 'error'
								})
							} else{
								_this.$notify({
									title: '操作失败',
									message: '发生未知错误，请联系管理员',
									type: 'error',
									duration: 0
								})
								_this.tempDataShow = false;
							}
						}
					})
				},
				getTreeCheckedNodes(){
					const _this = this
					let keyForImport = []  // 导入excel时所需的key，分为两级第一级表名（对应excel中的sheet），第二级字段
					const checkedNodes = _this.$refs.treeForImportExcel.getCheckedNodes(true) // 选中的表格
					for(let i = 0; i < checkedNodes.length; i++){
						checkedNodes[i].children = _this.l2_to_l3_allFiled[checkedNodes[i].ctrr_rsrm_id]
						keyForImport.push(checkedNodes[i])
					}
					return keyForImport;
				},
				handlExportFile(tableData){
					// 导出excel
					const _this = this
					const excelKey = []
					const excelData = []
					for(let i = 0; i < _this.tableKey.length; i++ ){
						excelKey.push(_this.tableKey[i].label)
					}
					for(let i = 0; i < _this.tableData.length; i++ ){
						let arr = []
						for(let j = 0; j < _this.tableKey.length; j++ ){
							arr.push(_this.tableData[i][_this.tableKey[j].key] || '')
						}
						excelData.push(arr)
					}
					layui.use(['table'], function(){
						const table = layui.table
						let name = new Date()
						table.exportFile(excelKey, excelData, 'xls', name.toDateString()); //默认导出 xls
					})
				},
				handlImportFile(){
					const _this = this
					_this.$confirm('即将开始导入，请确保导入文件 < 1M 且数据不要与现有数据重复，数据比较多时，处理时间会比较久', '提示', {
						confirmButtonText: '确定',
						cancelButtonText: '取消',
						type: 'warning'
					}).then(() => {
						const keyForImport = _this.getTreeCheckedNodes()
						if(keyForImport.length === 0){
							showTs(0, '请选择需要导入的表格', 1000)
							return
						}
						_this.keyForImport = keyForImport
						$('#importdOneExcel').click()					
					}).catch(() => {
						showTs(1,'已取消',500)
					});
				},
				// 我要待跟进数据
				handlGetincompletedData(){
					const _this = this;
					_this.resetSearch(_this.now_ctrr_rsrm_id_l2)
					_this.search()
				},
				// 切换页签时
				handleSizeChange(pageSize) {
					const _this = this
					_this.pagination.pageSize = pageSize
					_this.search()
				},
				handleCurrentChange(currentPage) {
					const _this = this
					_this.pagination.currentPage = currentPage
					_this.search()
				},
				// 将开始时间和结束时间进行切割用于区间搜索
				hangdleStart_end_time(startdate, enddate, ctrr_rsrm_id=''){
					// startdate yyyy/M/d/H/m/s
					// enddate yyyy/M/d/H/m/s
					// ctrr_rsrm_id 字段id
					let arr = []
					startdate = startdate.split('/')
					enddate = enddate.split('/')

					// startdateStr,enddateStr用于拼接字符串
					let startdateStr = []
					let enddateStr = []
					// 字符串转数字类型
					for(let i = 0; i < startdate.length; i++){
						startdate[i] = Number(startdate[i])
						enddate[i] = Number(enddate[i])
						startdateStr[i] = startdate[i]
						enddateStr[i] = enddate[i]
						startdateStr[i] = startdate[i] > 9 ? startdate[i] : '0' + startdate[i]
						enddateStr[i] = enddate[i] > 9 ? enddate[i] : '0' + enddate[i]
					}
					function getYRange(startdate, enddate){
						if(startdate[0] != enddate[0]){
							for(let i = (startdate[0] + 1) ; i < enddate[0]; i++){
								arr.push(i)
							}
						}
					}
					function getMRange(startdate, enddate){
						if(startdate[0] == enddate[0]){
							for(let i = (startdate[1] + 1) ; i < enddate[1]; i++){
								const M = i > 9 ? i : '0' + i
								arr.push(ctrr_rsrm_id + '":"' + startdateStr[0] + '/' + M)
							}
						}else{
							for( let i = (startdate[1] + 1) ; i <= 12; i++ ){
								const M = i > 9 ? i : '0' + i
								arr.push(ctrr_rsrm_id + '":"' + startdateStr[0] + '/' + M)
							}
							for(let i = (enddate[1] - 1); i >= 1; i--){
								const M = i > 9 ? i : '0' + i
								arr.push(ctrr_rsrm_id + '":"' + enddateStr[0] + '/' + M)
							}
						}
					}
					function getDRange(startdate, enddate){
						if(startdate[0] == enddate[0] && startdate[1] == enddate[1]){
							for(let i = (startdate[2] + 1); i < enddate[2]; i++){
								const D = i > 9 ? i : '0' + i
								arr.push(ctrr_rsrm_id + '":"' + startdateStr[0] + '/' + startdateStr[1] + '/' + D)
							}
						}else{
							for(let i = (startdate[2]+1); i <= 31; i++){
								const D = i > 9 ? i : '0' + i
								arr.push(ctrr_rsrm_id + '":"' + startdateStr[0] + '/' + startdateStr[1] + '/' + D)
							}
							for(let i = 1; i < enddate[2]; i++){
								const D = i > 9 ? i : '0' + i
								arr.push(ctrr_rsrm_id + '":"' + enddateStr[0] + '/' + enddateStr[1] + '/' + D)
							}
						}
					}
					function getHRange(startdate, enddate){
						if(startdate[0] == enddate[0] && startdate[1] == enddate[1] && startdate[2] == enddate[2]){
							for(let i = (startdate[3] + 1); i < enddate[3]; i++){
								let H = i > 9 ? i : '0' + i.toString();
								arr.push(ctrr_rsrm_id + '":"' + startdateStr[0] + '/' + startdateStr[1] + '/' + startdateStr[2] + ' ' + H)
							}
						}else{
							for(let i = (startdate[3]+1); i <= 24; i++){
								let H = i > 9 ? i : '0' + i.toString();
								arr.push(ctrr_rsrm_id + '":"' + startdateStr[0] + '/' + startdateStr[1] + '/' + startdateStr[2] + ' ' + H)
							}
							for(let i = 1; i < enddate[3]; i++){
								let H = i > 9 ? i : '0' + i.toString();
								arr.push(ctrr_rsrm_id + '":"' + enddateStr[0] + '/' + enddateStr[1] + '/' + enddateStr[2] + ' ' + H)
							}
						}
					}
					function getminRange(startdate, enddate){
						if(startdate[0] == enddate[0] && startdate[1] == enddate[1] && startdate[2] == enddate[2] && startdate[3] == enddate[3]){
							for(let i = (startdate[4] + 1); i < enddate[4]; i++){
								let min = i > 9 ? i : '0' + i;
								arr.push(ctrr_rsrm_id + '":"' + startdateStr[0] + '/' + startdateStr[1] + '/' + startdateStr[2] + ' ' + startdateStr[3] + ':' + min)
							}
						}else{
							for(let i = (startdate[4]+1); i < 60; i++){
								let min = i > 9 ? i : '0' + i;
								arr.push(ctrr_rsrm_id + '":"' + startdateStr[0] + '/' + startdateStr[1] + '/' + startdateStr[2] + ' ' + startdateStr[3] + ':' + min)
							}
							for(let i = 1; i < enddate[4]; i++){
								let min = i > 9 ? i : '0' + i;
								arr.push(ctrr_rsrm_id + '":"' + enddateStr[0] + '/' + enddateStr[1] + '/' + enddateStr[2] + ' ' + enddateStr[3] + ':' + min)
							}
							
						}
					}
					function getSRange(startdate, enddate){
						if(startdate[0] == enddate[0] && startdate[1] == enddate[1] && startdate[2] == enddate[2] && startdate[3] == enddate[3] && startdate[4] == enddate[4]){
							for(let i = (startdate[5] + 1); i < enddate[5]; i++){
								let S = i > 9 ? i : '0' + i;
								arr.push(ctrr_rsrm_id + '":"' + startdateStr[0] + '/' + startdateStr[1] + '/' + startdateStr[2] + ' ' + startdateStr[3] + ':' + startdateStr[4] + ':' + S)
							}
						}else{
							for(let i = (startdate[5]+1); i < 60; i++){
								let S = i > 9 ? i : '0' + i;
								arr.push(ctrr_rsrm_id + '":"' + startdateStr[0] + '/' + startdateStr[1] + '/' + startdateStr[2] + ' ' + startdateStr[3] + ':' + startdateStr[4] + ':' + S)
							}
							for(let i = 1; i < enddate[5]; i++){
								let S = i > 9 ? i : '0' + i;
								arr.push(ctrr_rsrm_id + '":"' + enddateStr[0] + '/' + enddateStr[1] + '/' + enddateStr[2] + ' ' + enddateStr[3] + ':' + enddateStr[4] + ':' + S)
							}
							
						}
					}
					// 构造年份
					getYRange(startdate, enddate)
					// 构造月份
					getMRange(startdate, enddate)
					// 构造日份
					getDRange(startdate, enddate)
					// 构造小时
					getHRange(startdate, enddate)
					// 构造分钟
					getminRange(startdate, enddate)
					// 构造秒钟
					getSRange(startdate, enddate)
					// 最后包括区间的两端点
					arr.push(ctrr_rsrm_id + '":"' + startdateStr[0] + '/' + startdateStr[1] + '/' + startdateStr[2] + ' ' + startdateStr[3] + ':' + startdateStr[4] + ':' + startdateStr[5])
					arr.push(ctrr_rsrm_id + '":"' + enddateStr[0] + '/' + enddateStr[1] + '/' + enddateStr[2] + ' ' + enddateStr[3] + ':' + enddateStr[4] + ':' + enddateStr[5])
					return arr;
				},
				// 不可关闭错误报告
				handleCloseDrawer(){
					// 不用写任何代码，当drawer调用这个函数的时候，只要不做任何处理，就不会关闭drawer
					const _this = this
					_this.$notify({
						title: "提示",
						type: 'warning',
						message: '请按错误报告内容修改并刷新页面缓存后，重新提交',
						position: 'bottom-right',
						duration: 2000
					})
				}
			},
			computed: {
				// 对于任何复杂逻辑，你都应当使用计算属性
			},
			// 不要在选项 property 或回调上使用箭头函数，
			// 比如 created: () => console.log(this.a) 或 vm.$watch('a', newValue => this.myMethod())。
			// 因为箭头函数并没有 this，this 会作为变量一直向上级词法作用域查找，直至找到为止，
			// 经常导致 
			// Uncaught TypeError: Cannot read property of undefined 
			// 或 Uncaught TypeError: this.myMethod is not a function 之类的错误。
			beforeCreate:function(){
				// 初始化：事件&生命周期
			},
			created:function(){
				// 初始化：注入&校验
				const _this = this;
			},
			beforeMount:function(){
			},
			mounted:function(){
				// 创建vm.$el 并用其替换"el" 
				// 挂载完毕
				const _this = this;
			},
			beforeUpdate:function(){
				// 当data被修改时
			},
			updated: function () {
				// 虚拟dom重新渲染并应用更新
				const _this = this;
			},
			beforeDestroy:function(){
				// 当调用vm.$destroy()函数时
			},
			destroy:function(){
				// 解除绑定销毁子组件以及事件监听器
				// 销毁完毕 
			}
		})

		// 加载级联组件第一级的第六张表，既【政企其他故障】
		app.handleCascaderChange([0,4])
		function exportRaw(name, excelKey, excelData) {
			// excelData -> array
			layui.use(['table'], function(){
				const table = layui.table
				table.exportFile(excelKey, excelData, 'xls', name); //默认导出 xls
			})
		}
		/**
		 * 管理内存 —— （手工）解除引用
		 * 确保占用最少的内存可以让页面获得更好的性能
		 * 而优化内存占用的最佳方式，就是为执行中的代码只保存必要的数据，
		 * 一旦数据不再有用，最好通过将其值设置为null来释放其引用 —— 这个做法叫做接触引用
		 * 不过解除引用并不意味着自动回收该值所占用的内存。
		 * 解除引用的真正作用是让值脱离执行环境，以便垃圾收集器下次运行时将其回收
		 * 不过下面有一些还是会继续用到，比如换页的时候还会用到一些变量，所以暂时就不用接触引用了
		 */
		// levelOneList = null
		// tableDataBySQL = null
		// pagination = null
		// levelThree = null
		// tableData = null
		// lastTableData = null
		// treeForImportData = null
		// l2_to_l3_allFiled = null
		// formJson = null
		// tableKey = null
		// app = null
	}
</script>

<script>
	// 打开本页默认关闭侧边栏
	setTimeout(() => {
		$('.klogo a').click()
	}, 1000);
</script>